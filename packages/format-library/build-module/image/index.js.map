{"version":3,"sources":["@wordpress/format-library/src/image/index.js"],"names":["Path","SVG","TextControl","Popover","IconButton","PositionedAtSelection","__","Component","insertObject","MediaUpload","RichTextToolbarButton","MediaUploadCheck","LEFT","RIGHT","UP","DOWN","BACKSPACE","ENTER","ALLOWED_MEDIA_TYPES","name","stopKeyPropagation","event","stopPropagation","image","title","keywords","object","tagName","className","attributes","style","url","alt","edit","arguments","onChange","bind","onKeyDown","openModal","closeModal","state","modal","width","setState","indexOf","keyCode","props","value","isObjectActive","activeObjectAttributes","key","start","id","type","Math","min","open","newReplacements","replacements","slice","preventDefault","previousStyle","undefined","replace"],"mappings":";;;;;;;;;AAAA;;;AAGA,SAASA,IAAT,EAAeC,GAAf,EAAoBC,WAApB,EAAiCC,OAAjC,EAA0CC,UAA1C,EAAsDC,qBAAtD,QAAmF,uBAAnF;AACA,SAASC,EAAT,QAAmB,iBAAnB;AACA,SAASC,SAAT,QAA0B,oBAA1B;AACA,SAASC,YAAT,QAA6B,sBAA7B;AACA,SAASC,WAAT,EAAsBC,qBAAtB,EAA6CC,gBAA7C,QAAqE,yBAArE;AACA,SAASC,IAAT,EAAeC,KAAf,EAAsBC,EAAtB,EAA0BC,IAA1B,EAAgCC,SAAhC,EAA2CC,KAA3C,QAAwD,qBAAxD;AAEA,IAAMC,mBAAmB,GAAG,CAAE,OAAF,CAA5B;AAEA,IAAMC,IAAI,GAAG,YAAb;;AAEA,IAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,CAAEC,KAAF;AAAA,SAAaA,KAAK,CAACC,eAAN,EAAb;AAAA,CAA3B;;AAEA,OAAO,IAAMC,KAAK,GAAG;AACpBJ,EAAAA,IAAI,EAAJA,IADoB;AAEpBK,EAAAA,KAAK,EAAElB,EAAE,CAAE,OAAF,CAFW;AAGpBmB,EAAAA,QAAQ,EAAE,CAAEnB,EAAE,CAAE,OAAF,CAAJ,EAAiBA,EAAE,CAAE,OAAF,CAAnB,CAHU;AAIpBoB,EAAAA,MAAM,EAAE,IAJY;AAKpBC,EAAAA,OAAO,EAAE,KALW;AAMpBC,EAAAA,SAAS,EAAE,IANS;AAOpBC,EAAAA,UAAU,EAAE;AACXD,IAAAA,SAAS,EAAE,OADA;AAEXE,IAAAA,KAAK,EAAE,OAFI;AAGXC,IAAAA,GAAG,EAAE,KAHM;AAIXC,IAAAA,GAAG,EAAE;AAJM,GAPQ;AAapBC,EAAAA,IAAI;AAAA;AAAA;AAAA;;AACH,yBAAc;AAAA;;AAAA;;AACb,sFAAUC,SAAV;AACA,YAAKC,QAAL,GAAgB,MAAKA,QAAL,CAAcC,IAAd,uDAAhB;AACA,YAAKC,SAAL,GAAiB,MAAKA,SAAL,CAAeD,IAAf,uDAAjB;AACA,YAAKE,SAAL,GAAiB,MAAKA,SAAL,CAAeF,IAAf,uDAAjB;AACA,YAAKG,UAAL,GAAkB,MAAKA,UAAL,CAAgBH,IAAhB,uDAAlB;AACA,YAAKI,KAAL,GAAa;AACZC,QAAAA,KAAK,EAAE;AADK,OAAb;AANa;AASb;;AAVE;AAAA;AAAA,+BAgCOC,KAhCP,EAgCe;AACjB,aAAKC,QAAL,CAAe;AAAED,UAAAA,KAAK,EAALA;AAAF,SAAf;AACA;AAlCE;AAAA;AAAA,gCAoCQrB,KApCR,EAoCgB;AAClB,YAAK,CAAET,IAAF,EAAQG,IAAR,EAAcF,KAAd,EAAqBC,EAArB,EAAyBE,SAAzB,EAAoCC,KAApC,EAA4C2B,OAA5C,CAAqDvB,KAAK,CAACwB,OAA3D,IAAuE,CAAC,CAA7E,EAAiF;AAChF;AACAxB,UAAAA,KAAK,CAACC,eAAN;AACA;AACD;AAzCE;AAAA;AAAA,kCA2CS;AACX,aAAKqB,QAAL,CAAe;AAAEF,UAAAA,KAAK,EAAE;AAAT,SAAf;AACA;AA7CE;AAAA;AAAA,mCA+CU;AACZ,aAAKE,QAAL,CAAe;AAAEF,UAAAA,KAAK,EAAE;AAAT,SAAf;AACA;AAjDE;AAAA;AAAA,+BAmDM;AAAA;;AAAA,0BAC4D,KAAKK,KADjE;AAAA,YACAC,KADA,eACAA,KADA;AAAA,YACOZ,QADP,eACOA,QADP;AAAA,YACiBa,cADjB,eACiBA,cADjB;AAAA,YACiCC,sBADjC,eACiCA,sBADjC;AAAA,YAEAnB,KAFA,GAEUmB,sBAFV,CAEAnB,KAFA,EAGR;AACA;;AACA,YAAMoB,GAAG,GAAGH,KAAK,CAACI,KAAN,GAAcrB,KAA1B;AAEA,eACC,cAAC,gBAAD,QACC,cAAC,qBAAD;AACC,UAAA,IAAI,EAAG,cAAC,GAAD;AAAK,YAAA,KAAK,EAAC,4BAAX;AAAwC,YAAA,OAAO,EAAC;AAAhD,aAA4D,cAAC,IAAD;AAAM,YAAA,CAAC,EAAC;AAAR,YAA5D,CADR;AAEC,UAAA,KAAK,EAAGxB,EAAE,CAAE,cAAF,CAFX;AAGC,UAAA,OAAO,EAAG,KAAKgC,SAHhB;AAIC,UAAA,QAAQ,EAAGU;AAJZ,UADD,EAOG,KAAKR,KAAL,CAAWC,KAAX,IAAoB,cAAC,WAAD;AACrB,UAAA,YAAY,EAAGvB,mBADM;AAErB,UAAA,QAAQ,EAAG,wBAA+B;AAAA,gBAA3BkC,EAA2B,QAA3BA,EAA2B;AAAA,gBAAvBrB,GAAuB,QAAvBA,GAAuB;AAAA,gBAAlBC,GAAkB,QAAlBA,GAAkB;AAAA,gBAAbU,KAAa,QAAbA,KAAa;;AACzC,YAAA,MAAI,CAACH,UAAL;;AACAJ,YAAAA,QAAQ,CAAE3B,YAAY,CAAEuC,KAAF,EAAS;AAC9BM,cAAAA,IAAI,EAAElC,IADwB;AAE9BU,cAAAA,UAAU,EAAE;AACXD,gBAAAA,SAAS,qBAAewB,EAAf,CADE;AAEXtB,gBAAAA,KAAK,mBAAawB,IAAI,CAACC,GAAL,CAAUb,KAAV,EAAiB,GAAjB,CAAb,QAFM;AAGXX,gBAAAA,GAAG,EAAHA,GAHW;AAIXC,gBAAAA,GAAG,EAAHA;AAJW;AAFkB,aAAT,CAAd,CAAR;AASA,WAboB;AAcrB,UAAA,OAAO,EAAG,KAAKO,UAdM;AAerB,UAAA,MAAM,EAAG,uBAAgB;AAAA,gBAAZiB,IAAY,SAAZA,IAAY;AACxBA,YAAAA,IAAI;AACJ,mBAAO,IAAP;AACA;AAlBoB,UAPvB,EA2BGR,cAAc,IAAI,cAAC,qBAAD;AAAuB,UAAA,GAAG,EAAGE;AAA7B,WACnB,cAAC,OAAD;AACC,UAAA,QAAQ,EAAC,eADV;AAEC,UAAA,YAAY,EAAG;AAFhB,WAMC;AACC,UAAA,SAAS,EAAC,qGADX;AAEC,UAAA,UAAU,EAAG9B,kBAFd;AAGC,UAAA,SAAS,EAAG,KAAKiB,SAHlB;AAIC,UAAA,QAAQ,EAAG,kBAAEhB,KAAF,EAAa;AACvB,gBAAMoC,eAAe,GAAGV,KAAK,CAACW,YAAN,CAAmBC,KAAnB,EAAxB;AAEAF,YAAAA,eAAe,CAAEV,KAAK,CAACI,KAAR,CAAf,GAAiC;AAChCE,cAAAA,IAAI,EAAElC,IAD0B;AAEhCU,cAAAA,UAAU,oBACNoB,sBADM;AAETnB,gBAAAA,KAAK,mBAAa,MAAI,CAACU,KAAL,CAAWE,KAAxB;AAFI;AAFsB,aAAjC;AAQAP,YAAAA,QAAQ,mBACJY,KADI;AAEPW,cAAAA,YAAY,EAAED;AAFP,eAAR;AAKApC,YAAAA,KAAK,CAACuC,cAAN;AACA;AArBF,WAuBC,cAAC,WAAD;AACC,UAAA,SAAS,EAAC,iGADX;AAEC,UAAA,IAAI,EAAC,QAFN;AAGC,UAAA,KAAK,EAAGtD,EAAE,CAAE,OAAF,CAHX;AAIC,UAAA,KAAK,EAAG,KAAKkC,KAAL,CAAWE,KAJpB;AAKC,UAAA,GAAG,EAAG,CALP;AAMC,UAAA,QAAQ,EAAG,KAAKP;AANjB,UAvBD,EA+BC,cAAC,UAAD;AAAY,UAAA,IAAI,EAAC,cAAjB;AAAgC,UAAA,KAAK,EAAG7B,EAAE,CAAE,OAAF,CAA1C;AAAwD,UAAA,IAAI,EAAC;AAA7D,UA/BD,CAND,CADmB,CA3BrB,CADD;AAyEA;AAnIE;AAAA;AAAA,+CAY8BwC,KAZ9B,EAYqCN,KAZrC,EAY6C;AAAA,YACbV,KADa,GACDgB,KADC,CACvCG,sBADuC,CACbnB,KADa;;AAG/C,YAAKA,KAAK,KAAKU,KAAK,CAACqB,aAArB,EAAqC;AACpC,iBAAO,IAAP;AACA;;AAED,YAAK,CAAE/B,KAAP,EAAe;AACd,iBAAO;AACNY,YAAAA,KAAK,EAAEoB,SADD;AAEND,YAAAA,aAAa,EAAE/B;AAFT,WAAP;AAIA;;AAED,eAAO;AACNY,UAAAA,KAAK,EAAEZ,KAAK,CAACiC,OAAN,CAAe,KAAf,EAAsB,EAAtB,CADD;AAENF,UAAAA,aAAa,EAAE/B;AAFT,SAAP;AAIA;AA9BE;;AAAA;AAAA,IAA0BvB,SAA1B;AAbgB,CAAd","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Path, SVG, TextControl, Popover, IconButton, PositionedAtSelection } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport { insertObject } from '@wordpress/rich-text';\nimport { MediaUpload, RichTextToolbarButton, MediaUploadCheck } from '@wordpress/block-editor';\nimport { LEFT, RIGHT, UP, DOWN, BACKSPACE, ENTER } from '@wordpress/keycodes';\n\nconst ALLOWED_MEDIA_TYPES = [ 'image' ];\n\nconst name = 'core/image';\n\nconst stopKeyPropagation = ( event ) => event.stopPropagation();\n\nexport const image = {\n\tname,\n\ttitle: __( 'Image' ),\n\tkeywords: [ __( 'photo' ), __( 'media' ) ],\n\tobject: true,\n\ttagName: 'img',\n\tclassName: null,\n\tattributes: {\n\t\tclassName: 'class',\n\t\tstyle: 'style',\n\t\turl: 'src',\n\t\talt: 'alt',\n\t},\n\tedit: class ImageEdit extends Component {\n\t\tconstructor() {\n\t\t\tsuper( ...arguments );\n\t\t\tthis.onChange = this.onChange.bind( this );\n\t\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\t\tthis.openModal = this.openModal.bind( this );\n\t\t\tthis.closeModal = this.closeModal.bind( this );\n\t\t\tthis.state = {\n\t\t\t\tmodal: false,\n\t\t\t};\n\t\t}\n\n\t\tstatic getDerivedStateFromProps( props, state ) {\n\t\t\tconst { activeObjectAttributes: { style } } = props;\n\n\t\t\tif ( style === state.previousStyle ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif ( ! style ) {\n\t\t\t\treturn {\n\t\t\t\t\twidth: undefined,\n\t\t\t\t\tpreviousStyle: style,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\twidth: style.replace( /\\D/g, '' ),\n\t\t\t\tpreviousStyle: style,\n\t\t\t};\n\t\t}\n\n\t\tonChange( width ) {\n\t\t\tthis.setState( { width } );\n\t\t}\n\n\t\tonKeyDown( event ) {\n\t\t\tif ( [ LEFT, DOWN, RIGHT, UP, BACKSPACE, ENTER ].indexOf( event.keyCode ) > -1 ) {\n\t\t\t\t// Stop the key event from propagating up to ObserveTyping.startTypingInTextField.\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t}\n\n\t\topenModal() {\n\t\t\tthis.setState( { modal: true } );\n\t\t}\n\n\t\tcloseModal() {\n\t\t\tthis.setState( { modal: false } );\n\t\t}\n\n\t\trender() {\n\t\t\tconst { value, onChange, isObjectActive, activeObjectAttributes } = this.props;\n\t\t\tconst { style } = activeObjectAttributes;\n\t\t\t// Rerender PositionedAtSelection when the selection changes or when\n\t\t\t// the width changes.\n\t\t\tconst key = value.start + style;\n\n\t\t\treturn (\n\t\t\t\t<MediaUploadCheck>\n\t\t\t\t\t<RichTextToolbarButton\n\t\t\t\t\t\ticon={ <SVG xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><Path d=\"M4 16h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v9c0 1.1.9 2 2 2zM4 5h10v9H4V5zm14 9v2h4v-2h-4zM2 20h20v-2H2v2zm6.4-8.8L7 9.4 5 12h8l-2.6-3.4-2 2.6z\" /></SVG> }\n\t\t\t\t\t\ttitle={ __( 'Inline Image' ) }\n\t\t\t\t\t\tonClick={ this.openModal }\n\t\t\t\t\t\tisActive={ isObjectActive }\n\t\t\t\t\t/>\n\t\t\t\t\t{ this.state.modal && <MediaUpload\n\t\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\t\tonSelect={ ( { id, url, alt, width } ) => {\n\t\t\t\t\t\t\tthis.closeModal();\n\t\t\t\t\t\t\tonChange( insertObject( value, {\n\t\t\t\t\t\t\t\ttype: name,\n\t\t\t\t\t\t\t\tattributes: {\n\t\t\t\t\t\t\t\t\tclassName: `wp-image-${ id }`,\n\t\t\t\t\t\t\t\t\tstyle: `width: ${ Math.min( width, 150 ) }px;`,\n\t\t\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\t\t\talt,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t} ) );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tonClose={ this.closeModal }\n\t\t\t\t\t\trender={ ( { open } ) => {\n\t\t\t\t\t\t\topen();\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t} }\n\t\t\t\t\t/> }\n\t\t\t\t\t{ isObjectActive && <PositionedAtSelection key={ key }>\n\t\t\t\t\t\t<Popover\n\t\t\t\t\t\t\tposition=\"bottom center\"\n\t\t\t\t\t\t\tfocusOnMount={ false }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ // Disable reason: KeyPress must be suppressed so the block doesn't hide the toolbar\n\t\t\t\t\t\t\t/* eslint-disable jsx-a11y/no-noninteractive-element-interactions */ }\n\t\t\t\t\t\t\t<form\n\t\t\t\t\t\t\t\tclassName=\"editor-format-toolbar__image-container-content block-editor-format-toolbar__image-container-content\"\n\t\t\t\t\t\t\t\tonKeyPress={ stopKeyPropagation }\n\t\t\t\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\t\t\t\tonSubmit={ ( event ) => {\n\t\t\t\t\t\t\t\t\tconst newReplacements = value.replacements.slice();\n\n\t\t\t\t\t\t\t\t\tnewReplacements[ value.start ] = {\n\t\t\t\t\t\t\t\t\t\ttype: name,\n\t\t\t\t\t\t\t\t\t\tattributes: {\n\t\t\t\t\t\t\t\t\t\t\t...activeObjectAttributes,\n\t\t\t\t\t\t\t\t\t\t\tstyle: `width: ${ this.state.width }px;`,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\tonChange( {\n\t\t\t\t\t\t\t\t\t\t...value,\n\t\t\t\t\t\t\t\t\t\treplacements: newReplacements,\n\t\t\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\t\t\tclassName=\"editor-format-toolbar__image-container-value block-editor-format-toolbar__image-container-value\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tlabel={ __( 'Width' ) }\n\t\t\t\t\t\t\t\t\tvalue={ this.state.width }\n\t\t\t\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\t\t\t\tonChange={ this.onChange }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<IconButton icon=\"editor-break\" label={ __( 'Apply' ) } type=\"submit\" />\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t{ /* eslint-enable jsx-a11y/no-noninteractive-element-interactions */ }\n\t\t\t\t\t\t</Popover>\n\t\t\t\t\t</PositionedAtSelection> }\n\t\t\t\t</MediaUploadCheck>\n\t\t\t);\n\t\t}\n\t},\n};\n"]}