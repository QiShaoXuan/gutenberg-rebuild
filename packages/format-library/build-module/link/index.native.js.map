{"version":3,"sources":["@wordpress/format-library/src/link/index.native.js"],"names":["find","__","Component","Fragment","withSpokenMessages","RichTextToolbarButton","applyFormat","getActiveFormat","getTextContent","isCollapsed","removeFormat","slice","isURL","ModalLinkUI","name","link","title","tagName","className","attributes","url","target","edit","arguments","addLink","bind","stopAddingLink","onRemoveFormat","state","addingLink","props","value","onChange","text","type","setState","isActive","startFormat","startIndex","start","endIndex","end","formats","speak","linkSelection","getLinkSelection","activeAttributes"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { find } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Component, Fragment } from '@wordpress/element';\nimport { withSpokenMessages } from '@wordpress/components';\nimport { RichTextToolbarButton } from '@wordpress/block-editor';\nimport {\n\tapplyFormat,\n\tgetActiveFormat,\n\tgetTextContent,\n\tisCollapsed,\n\tremoveFormat,\n\tslice,\n} from '@wordpress/rich-text';\nimport { isURL } from '@wordpress/url';\n\n/**\n * Internal dependencies\n */\nimport ModalLinkUI from './modal';\n\nconst name = 'core/link';\n\nexport const link = {\n\tname,\n\ttitle: __( 'Link' ),\n\ttagName: 'a',\n\tclassName: null,\n\tattributes: {\n\t\turl: 'href',\n\t\ttarget: 'target',\n\t},\n\tedit: withSpokenMessages( class LinkEdit extends Component {\n\t\tconstructor() {\n\t\t\tsuper( ...arguments );\n\n\t\t\tthis.addLink = this.addLink.bind( this );\n\t\t\tthis.stopAddingLink = this.stopAddingLink.bind( this );\n\t\t\tthis.onRemoveFormat = this.onRemoveFormat.bind( this );\n\t\t\tthis.state = {\n\t\t\t\taddingLink: false,\n\t\t\t};\n\t\t}\n\n\t\taddLink() {\n\t\t\tconst { value, onChange } = this.props;\n\t\t\tconst text = getTextContent( slice( value ) );\n\n\t\t\tif ( text && isURL( text ) ) {\n\t\t\t\tonChange( applyFormat( value, { type: name, attributes: { url: text } } ) );\n\t\t\t} else {\n\t\t\t\tthis.setState( { addingLink: true } );\n\t\t\t}\n\t\t}\n\n\t\tstopAddingLink() {\n\t\t\tthis.setState( { addingLink: false } );\n\t\t}\n\n\t\tgetLinkSelection() {\n\t\t\tconst { value, isActive } = this.props;\n\t\t\tconst startFormat = getActiveFormat( value, 'core/link' );\n\n\t\t\t// if the link isn't selected, get the link manually by looking around the cursor\n\t\t\t// TODO: handle partly selected links\n\t\t\tif ( startFormat && isCollapsed( value ) && isActive ) {\n\t\t\t\tlet startIndex = value.start;\n\t\t\t\tlet endIndex = value.end;\n\n\t\t\t\twhile ( find( value.formats[ startIndex ], startFormat ) ) {\n\t\t\t\t\tstartIndex--;\n\t\t\t\t}\n\n\t\t\t\tendIndex++;\n\n\t\t\t\twhile ( find( value.formats[ endIndex ], startFormat ) ) {\n\t\t\t\t\tendIndex++;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\t...value,\n\t\t\t\t\tstart: startIndex + 1,\n\t\t\t\t\tend: endIndex,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tonRemoveFormat() {\n\t\t\tconst { onChange, speak } = this.props;\n\t\t\tconst linkSelection = this.getLinkSelection();\n\n\t\t\tonChange( removeFormat( linkSelection, name ) );\n\t\t\tspeak( __( 'Link removed.' ), 'assertive' );\n\t\t}\n\n\t\trender() {\n\t\t\tconst { isActive, activeAttributes, onChange } = this.props;\n\t\t\tconst linkSelection = this.getLinkSelection();\n\n\t\t\treturn (\n\t\t\t\t<Fragment>\n\t\t\t\t\t<ModalLinkUI\n\t\t\t\t\t\tisVisible={ this.state.addingLink }\n\t\t\t\t\t\tisActive={ isActive }\n\t\t\t\t\t\tactiveAttributes={ activeAttributes }\n\t\t\t\t\t\tonClose={ this.stopAddingLink }\n\t\t\t\t\t\tonChange={ onChange }\n\t\t\t\t\t\tonRemove={ this.onRemoveFormat }\n\t\t\t\t\t\tvalue={ linkSelection }\n\t\t\t\t\t/>\n\t\t\t\t\t<RichTextToolbarButton\n\t\t\t\t\t\tname=\"link\"\n\t\t\t\t\t\ticon=\"admin-links\"\n\t\t\t\t\t\ttitle={ __( 'Link' ) }\n\t\t\t\t\t\tonClick={ this.addLink }\n\t\t\t\t\t\tisActive={ isActive }\n\t\t\t\t\t\tshortcutType=\"primary\"\n\t\t\t\t\t\tshortcutCharacter=\"k\"\n\t\t\t\t\t/>\n\t\t\t\t</Fragment>\n\t\t\t);\n\t\t}\n\t} ),\n};\n"]}