{"version":3,"sources":["@wordpress/format-library/src/link/modal.native.js"],"names":["ModalLinkUI","arguments","submitLink","bind","onChangeInputValue","onChangeText","onChangeOpensInNewWindow","removeLink","onDismiss","state","inputValue","text","opensInNewWindow","oldProps","props","setState","activeAttributes","url","value","isActive","onChange","speak","linkText","format","placeholderFormats","formatPlaceholder","formats","toInsert","length","newAttributes","needsSelectionUpdate","start","end","onClose","onRemove","isVisible","Platform","OS","styles","clearLinkButton","Component"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport React from 'react';\nimport { Switch, Platform } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport { BottomSheet } from '@wordpress/editor';\nimport { prependHTTP } from '@wordpress/url';\nimport {\n\twithSpokenMessages,\n} from '@wordpress/components';\nimport {\n\tcreate,\n\tinsert,\n\tisCollapsed,\n\tapplyFormat,\n\tgetTextContent,\n\tslice,\n} from '@wordpress/rich-text';\n\n/**\n * Internal dependencies\n */\nimport { createLinkFormat, isValidHref } from './utils';\n\nimport styles from './modal.scss';\n\nclass ModalLinkUI extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.submitLink = this.submitLink.bind( this );\n\t\tthis.onChangeInputValue = this.onChangeInputValue.bind( this );\n\t\tthis.onChangeText = this.onChangeText.bind( this );\n\t\tthis.onChangeOpensInNewWindow = this.onChangeOpensInNewWindow.bind( this );\n\t\tthis.removeLink = this.removeLink.bind( this );\n\t\tthis.onDismiss = this.onDismiss.bind( this );\n\n\t\tthis.state = {\n\t\t\tinputValue: '',\n\t\t\ttext: '',\n\t\t\topensInNewWindow: false,\n\t\t};\n\t}\n\n\tcomponentDidUpdate( oldProps ) {\n\t\tif ( oldProps === this.props ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tinputValue: this.props.activeAttributes.url || '',\n\t\t\ttext: getTextContent( slice( this.props.value ) ),\n\t\t\topensInNewWindow: false,\n\t\t} );\n\t}\n\n\tonChangeInputValue( inputValue ) {\n\t\tthis.setState( { inputValue } );\n\t}\n\n\tonChangeText( text ) {\n\t\tthis.setState( { text } );\n\t}\n\n\tonChangeOpensInNewWindow( opensInNewWindow ) {\n\t\tthis.setState( { opensInNewWindow } );\n\t}\n\n\tsubmitLink() {\n\t\tconst { isActive, onChange, speak, value } = this.props;\n\t\tconst { inputValue, opensInNewWindow, text } = this.state;\n\t\tconst url = prependHTTP( inputValue );\n\t\tconst linkText = text || inputValue;\n\t\tconst format = createLinkFormat( {\n\t\t\turl,\n\t\t\topensInNewWindow,\n\t\t\ttext: linkText,\n\t\t} );\n\t\tconst placeholderFormats = ( value.formatPlaceholder && value.formatPlaceholder.formats ) || [];\n\n\t\tif ( isCollapsed( value ) && ! isActive ) { // insert link\n\t\t\tconst toInsert = applyFormat( create( { text: linkText } ), [ ...placeholderFormats, format ], 0, linkText.length );\n\t\t\tconst newAttributes = insert( value, toInsert );\n\t\t\tonChange( { ...newAttributes, needsSelectionUpdate: true } );\n\t\t} else if ( text !== getTextContent( slice( value ) ) ) { // edit text in selected link\n\t\t\tconst toInsert = applyFormat( create( { text } ), [ ...placeholderFormats, format ], 0, text.length );\n\t\t\tconst newAttributes = insert( value, toInsert, value.start, value.end );\n\t\t\tonChange( { ...newAttributes, needsSelectionUpdate: true } );\n\t\t} else { // transform selected text into link\n\t\t\tconst newAttributes = applyFormat( value, [ ...placeholderFormats, format ] );\n\t\t\tonChange( { ...newAttributes, needsSelectionUpdate: true } );\n\t\t}\n\n\t\tif ( ! isValidHref( url ) ) {\n\t\t\tspeak( __( 'Warning: the link has been inserted but may have errors. Please test it.' ), 'assertive' );\n\t\t} else if ( isActive ) {\n\t\t\tspeak( __( 'Link edited.' ), 'assertive' );\n\t\t} else {\n\t\t\tspeak( __( 'Link inserted' ), 'assertive' );\n\t\t}\n\n\t\tthis.props.onClose();\n\t}\n\n\tremoveLink() {\n\t\tthis.props.onRemove();\n\t\tthis.props.onClose();\n\t}\n\n\tonDismiss() {\n\t\tif ( this.state.inputValue === '' ) {\n\t\t\tthis.removeLink();\n\t\t} else {\n\t\t\tthis.submitLink();\n\t\t}\n\t}\n\n\trender() {\n\t\tconst { isVisible } = this.props;\n\n\t\treturn (\n\t\t\t<BottomSheet\n\t\t\t\tisVisible={ isVisible }\n\t\t\t\tonClose={ this.onDismiss }\n\t\t\t\thideHeader\n\t\t\t>\n\t\t\t\t{ /* eslint-disable jsx-a11y/no-autofocus */\n\t\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\t\ticon={ 'admin-links' }\n\t\t\t\t\t\tlabel={ __( 'URL' ) }\n\t\t\t\t\t\tvalue={ this.state.inputValue }\n\t\t\t\t\t\tplaceholder={ __( 'Add URL' ) }\n\t\t\t\t\t\tautoCapitalize=\"none\"\n\t\t\t\t\t\tautoCorrect={ false }\n\t\t\t\t\t\tkeyboardType=\"url\"\n\t\t\t\t\t\tonChangeValue={ this.onChangeInputValue }\n\t\t\t\t\t\tautoFocus={ Platform.OS === 'ios' }\n\t\t\t\t\t/>\n\t\t\t\t/* eslint-enable jsx-a11y/no-autofocus */ }\n\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\ticon={ 'editor-textcolor' }\n\t\t\t\t\tlabel={ __( 'Link Text' ) }\n\t\t\t\t\tvalue={ this.state.text }\n\t\t\t\t\tplaceholder={ __( 'Add Link Text' ) }\n\t\t\t\t\tonChangeValue={ this.onChangeText }\n\t\t\t\t/>\n\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\ticon={ 'external' }\n\t\t\t\t\tlabel={ __( 'Open in New Tab' ) }\n\t\t\t\t\tvalue={ '' }\n\t\t\t\t>\n\t\t\t\t\t<Switch\n\t\t\t\t\t\tvalue={ this.state.opensInNewWindow }\n\t\t\t\t\t\tonValueChange={ this.onChangeOpensInNewWindow }\n\t\t\t\t\t/>\n\t\t\t\t</BottomSheet.Cell>\n\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\tlabel={ __( 'Remove Link' ) }\n\t\t\t\t\tlabelStyle={ styles.clearLinkButton }\n\t\t\t\t\tseparatorType={ 'none' }\n\t\t\t\t\tonPress={ this.removeLink }\n\t\t\t\t/>\n\t\t\t</BottomSheet>\n\t\t);\n\t}\n}\n\nexport default withSpokenMessages( ModalLinkUI );\n"]}