{"version":3,"sources":["@wordpress/block-editor/src/components/url-input/index.js"],"names":["stopEventPropagation","event","stopPropagation","URLInput","autocompleteRef","arguments","onChange","bind","onKeyDown","inputRef","updateSuggestions","suggestionNodes","state","suggestions","showSuggestions","selectedSuggestion","scrollingIntoView","current","onlyScrollIfNeeded","props","setTimeout","suggestionsRequest","index","ref","value","fetchLinkSuggestions","length","test","setState","loading","request","then","debouncedSpeak","catch","inputValue","target","keyCode","UP","selectionStart","preventDefault","setSelectionRange","DOWN","suggestion","previousIndex","nextIndex","TAB","selectLink","speak","ENTER","url","focus","autoFocus","instanceId","className","undefined","map","id","bindSuggestionNode","handleOnClick","title","Component","withSafeTimeout","withSpokenMessages","withInstanceId","select","getSettings","__experimentalFetchLinkSuggestions"],"mappings":";;;;;;;;;AAWA;;;;;;;;;;;;;;AARA;;AACA;;AACA;;AAKA;;AAEA;;AACA;;AACA;;AACA;;AAfA;;;;AAOA;;;AAUA;AACA;AACA;AACA,IAAMA,oBAAoB,GAAG,SAAvBA,oBAAuB,CAAEC,KAAF;AAAA,SAAaA,KAAK,CAACC,eAAN,EAAb;AAAA,CAA7B;;IAEMC,Q;;;;;AACL,0BAAmC;AAAA;;AAAA,QAApBC,eAAoB,QAApBA,eAAoB;AAAA;AAClC,+GAAUC,SAAV;AAEA,UAAKC,QAAL,GAAgB,MAAKA,QAAL,CAAcC,IAAd,mFAAhB;AACA,UAAKC,SAAL,GAAiB,MAAKA,SAAL,CAAeD,IAAf,mFAAjB;AACA,UAAKH,eAAL,GAAuBA,eAAe,IAAI,yBAA1C;AACA,UAAKK,QAAL,GAAgB,yBAAhB;AACA,UAAKC,iBAAL,GAAyB,sBAAU,MAAKA,iBAAL,CAAuBH,IAAvB,mFAAV,EAA+C,GAA/C,CAAzB;AAEA,UAAKI,eAAL,GAAuB,EAAvB;AAEA,UAAKC,KAAL,GAAa;AACZC,MAAAA,WAAW,EAAE,EADD;AAEZC,MAAAA,eAAe,EAAE,KAFL;AAGZC,MAAAA,kBAAkB,EAAE;AAHR,KAAb;AAXkC;AAgBlC;;;;yCAEoB;AAAA;;AAAA,wBAC4B,KAAKH,KADjC;AAAA,UACZE,eADY,eACZA,eADY;AAAA,UACKC,kBADL,eACKA,kBADL,EAEpB;AACA;;AACA,UAAKD,eAAe,IAAIC,kBAAkB,KAAK,IAA1C,IAAkD,CAAE,KAAKC,iBAA9D,EAAkF;AACjF,aAAKA,iBAAL,GAAyB,IAAzB;AACA,wCAAgB,KAAKL,eAAL,CAAsBI,kBAAtB,CAAhB,EAA4D,KAAKX,eAAL,CAAqBa,OAAjF,EAA0F;AACzFC,UAAAA,kBAAkB,EAAE;AADqE,SAA1F;AAIA,aAAKC,KAAL,CAAWC,UAAX,CAAuB,YAAM;AAC5B,UAAA,MAAI,CAACJ,iBAAL,GAAyB,KAAzB;AACA,SAFD,EAEG,GAFH;AAGA;AACD;;;2CAEsB;AACtB,aAAO,KAAKK,kBAAZ;AACA;;;uCAEmBC,K,EAAQ;AAAA;;AAC3B,aAAO,UAAEC,GAAF,EAAW;AACjB,QAAA,MAAI,CAACZ,eAAL,CAAsBW,KAAtB,IAAgCC,GAAhC;AACA,OAFD;AAGA;;;sCAEkBC,K,EAAQ;AAAA;;AAAA,UAClBC,oBADkB,GACO,KAAKN,KADZ,CAClBM,oBADkB;;AAE1B,UAAK,CAAEA,oBAAP,EAA8B;AAC7B;AACA,OAJyB,CAM1B;AACA;;;AACA,UAAKD,KAAK,CAACE,MAAN,GAAe,CAAf,IAAoB,WAAWC,IAAX,CAAiBH,KAAjB,CAAzB,EAAoD;AACnD,aAAKI,QAAL,CAAe;AACdd,UAAAA,eAAe,EAAE,KADH;AAEdC,UAAAA,kBAAkB,EAAE,IAFN;AAGdc,UAAAA,OAAO,EAAE;AAHK,SAAf;AAMA;AACA;;AAED,WAAKD,QAAL,CAAe;AACdd,QAAAA,eAAe,EAAE,IADH;AAEdC,QAAAA,kBAAkB,EAAE,IAFN;AAGdc,QAAAA,OAAO,EAAE;AAHK,OAAf;AAMA,UAAMC,OAAO,GAAGL,oBAAoB,CAAED,KAAF,CAApC;AAEAM,MAAAA,OAAO,CAACC,IAAR,CAAc,UAAElB,WAAF,EAAmB;AAChC;AACA;AACA;AACA,YAAK,MAAI,CAACQ,kBAAL,KAA4BS,OAAjC,EAA2C;AAC1C;AACA;;AAED,QAAA,MAAI,CAACF,QAAL,CAAe;AACdf,UAAAA,WAAW,EAAXA,WADc;AAEdgB,UAAAA,OAAO,EAAE;AAFK,SAAf;;AAKA,YAAK,CAAC,CAAEhB,WAAW,CAACa,MAApB,EAA6B;AAC5B,UAAA,MAAI,CAACP,KAAL,CAAWa,cAAX,CAA2B,mBAAS,cACnC,0DADmC,EAEnC,2DAFmC,EAGnCnB,WAAW,CAACa,MAHuB,CAAT,EAIxBb,WAAW,CAACa,MAJY,CAA3B,EAIyB,WAJzB;AAKA,SAND,MAMO;AACN,UAAA,MAAI,CAACP,KAAL,CAAWa,cAAX,CAA2B,cAAI,aAAJ,CAA3B,EAAgD,WAAhD;AACA;AACD,OAtBD,EAsBIC,KAtBJ,CAsBW,YAAM;AAChB,YAAK,MAAI,CAACZ,kBAAL,KAA4BS,OAAjC,EAA2C;AAC1C,UAAA,MAAI,CAACF,QAAL,CAAe;AACdC,YAAAA,OAAO,EAAE;AADK,WAAf;AAGA;AACD,OA5BD;AA8BA,WAAKR,kBAAL,GAA0BS,OAA1B;AACA;;;6BAES7B,K,EAAQ;AACjB,UAAMiC,UAAU,GAAGjC,KAAK,CAACkC,MAAN,CAAaX,KAAhC;AACA,WAAKL,KAAL,CAAWb,QAAX,CAAqB4B,UAArB;AACA,WAAKxB,iBAAL,CAAwBwB,UAAxB;AACA;;;8BAEUjC,K,EAAQ;AAAA,yBACoD,KAAKW,KADzD;AAAA,UACVE,eADU,gBACVA,eADU;AAAA,UACOC,kBADP,gBACOA,kBADP;AAAA,UAC2BF,WAD3B,gBAC2BA,WAD3B;AAAA,UACwCgB,OADxC,gBACwCA,OADxC,EAElB;AACA;;AACA,UAAK,CAAEf,eAAF,IAAqB,CAAED,WAAW,CAACa,MAAnC,IAA6CG,OAAlD,EAA4D;AAC3D;AACA;AACA;AACA;AACA;AACA,gBAAS5B,KAAK,CAACmC,OAAf;AACC;AACA;AACA,eAAKC,YAAL;AAAS;AACR,kBAAK,MAAMpC,KAAK,CAACkC,MAAN,CAAaG,cAAxB,EAAyC;AACxCrC,gBAAAA,KAAK,CAACC,eAAN;AACAD,gBAAAA,KAAK,CAACsC,cAAN,GAFwC,CAIxC;;AACAtC,gBAAAA,KAAK,CAACkC,MAAN,CAAaK,iBAAb,CAAgC,CAAhC,EAAmC,CAAnC;AACA;;AACD;AACA;AACD;AACA;;AACA,eAAKC,cAAL;AAAW;AACV,kBAAK,KAAKtB,KAAL,CAAWK,KAAX,CAAiBE,MAAjB,KAA4BzB,KAAK,CAACkC,MAAN,CAAaG,cAA9C,EAA+D;AAC9DrC,gBAAAA,KAAK,CAACC,eAAN;AACAD,gBAAAA,KAAK,CAACsC,cAAN,GAF8D,CAI9D;;AACAtC,gBAAAA,KAAK,CAACkC,MAAN,CAAaK,iBAAb,CAAgC,KAAKrB,KAAL,CAAWK,KAAX,CAAiBE,MAAjD,EAAyD,KAAKP,KAAL,CAAWK,KAAX,CAAiBE,MAA1E;AACA;;AACD;AACA;AAxBF;;AA2BA;AACA;;AAED,UAAMgB,UAAU,GAAG,KAAK9B,KAAL,CAAWC,WAAX,CAAwB,KAAKD,KAAL,CAAWG,kBAAnC,CAAnB;;AAEA,cAASd,KAAK,CAACmC,OAAf;AACC,aAAKC,YAAL;AAAS;AACRpC,YAAAA,KAAK,CAACC,eAAN;AACAD,YAAAA,KAAK,CAACsC,cAAN;AACA,gBAAMI,aAAa,GAAG,CAAE5B,kBAAF,GAAuBF,WAAW,CAACa,MAAZ,GAAqB,CAA5C,GAAgDX,kBAAkB,GAAG,CAA3F;AACA,iBAAKa,QAAL,CAAe;AACdb,cAAAA,kBAAkB,EAAE4B;AADN,aAAf;AAGA;AACA;;AACD,aAAKF,cAAL;AAAW;AACVxC,YAAAA,KAAK,CAACC,eAAN;AACAD,YAAAA,KAAK,CAACsC,cAAN;AACA,gBAAMK,SAAS,GAAG7B,kBAAkB,KAAK,IAAvB,IAAiCA,kBAAkB,KAAKF,WAAW,CAACa,MAAZ,GAAqB,CAA7E,GAAmF,CAAnF,GAAuFX,kBAAkB,GAAG,CAA9H;AACA,iBAAKa,QAAL,CAAe;AACdb,cAAAA,kBAAkB,EAAE6B;AADN,aAAf;AAGA;AACA;;AACD,aAAKC,aAAL;AAAU;AACT,gBAAK,KAAKjC,KAAL,CAAWG,kBAAX,KAAkC,IAAvC,EAA8C;AAC7C,mBAAK+B,UAAL,CAAiBJ,UAAjB,EAD6C,CAE7C;;AACA,mBAAKvB,KAAL,CAAW4B,KAAX,CAAkB,cAAI,gBAAJ,CAAlB;AACA;;AACD;AACA;;AACD,aAAKC,eAAL;AAAY;AACX,gBAAK,KAAKpC,KAAL,CAAWG,kBAAX,KAAkC,IAAvC,EAA8C;AAC7Cd,cAAAA,KAAK,CAACC,eAAN;AACA,mBAAK4C,UAAL,CAAiBJ,UAAjB;AACA;;AACD;AACA;AAjCF;AAmCA;;;+BAEWA,U,EAAa;AACxB,WAAKvB,KAAL,CAAWb,QAAX,CAAqBoC,UAAU,CAACO,GAAhC,EAAqCP,UAArC;AACA,WAAKd,QAAL,CAAe;AACdb,QAAAA,kBAAkB,EAAE,IADN;AAEdD,QAAAA,eAAe,EAAE;AAFH,OAAf;AAIA;;;kCAEc4B,U,EAAa;AAC3B,WAAKI,UAAL,CAAiBJ,UAAjB,EAD2B,CAE3B;;AACA,WAAKjC,QAAL,CAAcQ,OAAd,CAAsBiC,KAAtB;AACA;;;6BAEQ;AAAA;;AAAA,wBACwD,KAAK/B,KAD7D;AAAA,0CACAK,KADA;AAAA,UACAA,KADA,kCACQ,EADR;AAAA,8CACY2B,SADZ;AAAA,UACYA,SADZ,sCACwB,IADxB;AAAA,UAC8BC,UAD9B,eAC8BA,UAD9B;AAAA,UAC0CC,SAD1C,eAC0CA,SAD1C;AAAA,yBAE8D,KAAKzC,KAFnE;AAAA,UAEAE,eAFA,gBAEAA,eAFA;AAAA,UAEiBD,WAFjB,gBAEiBA,WAFjB;AAAA,UAE8BE,kBAF9B,gBAE8BA,kBAF9B;AAAA,UAEkDc,OAFlD,gBAEkDA,OAFlD;AAGR;;AACA,aACC;AAAK,QAAA,SAAS,EAAG,yBAAY,yCAAZ,EAAuDwB,SAAvD;AAAjB,SACC;AACC,QAAA,SAAS,EAAGF,SADb;AAEC,QAAA,IAAI,EAAC,MAFN;AAGC,sBAAa,cAAI,KAAJ,CAHd;AAIC,QAAA,QAAQ,MAJT;AAKC,QAAA,KAAK,EAAG3B,KALT;AAMC,QAAA,QAAQ,EAAG,KAAKlB,QANjB;AAOC,QAAA,OAAO,EAAGN,oBAPX;AAQC,QAAA,WAAW,EAAG,cAAI,6BAAJ,CARf;AASC,QAAA,SAAS,EAAG,KAAKQ,SATlB;AAUC,QAAA,IAAI,EAAC,UAVN;AAWC,yBAAgBM,eAXjB;AAYC,6BAAkB,MAZnB;AAaC,kEAAmDsC,UAAnD,CAbD;AAcC,iCAAwBrC,kBAAkB,KAAK,IAAvB,+CAAoEqC,UAApE,cAAoFrC,kBAApF,IAA4GuC,SAdrI;AAeC,QAAA,GAAG,EAAG,KAAK7C;AAfZ,QADD,EAmBKoB,OAAF,IAAe,4BAAC,mBAAD,OAnBlB,EAqBGf,eAAe,IAAI,CAAC,CAAED,WAAW,CAACa,MAAlC,IACD,4BAAC,mBAAD;AAAS,QAAA,QAAQ,EAAC,QAAlB;AAA2B,QAAA,OAAO,MAAlC;AAAmC,QAAA,YAAY,EAAG;AAAlD,SACC;AACC,QAAA,SAAS,EAAC,mEADX;AAEC,QAAA,EAAE,yCAAoC0B,UAApC,CAFH;AAGC,QAAA,GAAG,EAAG,KAAKhD,eAHZ;AAIC,QAAA,IAAI,EAAC;AAJN,SAMGS,WAAW,CAAC0C,GAAZ,CAAiB,UAAEb,UAAF,EAAcpB,KAAd;AAAA,eAClB;AACC,UAAA,GAAG,EAAGoB,UAAU,CAACc,EADlB;AAEC,UAAA,IAAI,EAAC,QAFN;AAGC,UAAA,QAAQ,EAAC,IAHV;AAIC,UAAA,EAAE,8CAAyCJ,UAAzC,cAAyD9B,KAAzD,CAJH;AAKC,UAAA,GAAG,EAAG,MAAI,CAACmC,kBAAL,CAAyBnC,KAAzB,CALP;AAMC,UAAA,SAAS,EAAG,yBAAY,iEAAZ,EAA+E;AAC1F,2BAAeA,KAAK,KAAKP;AADiE,WAA/E,CANb;AASC,UAAA,OAAO,EAAG;AAAA,mBAAM,MAAI,CAAC2C,aAAL,CAAoBhB,UAApB,CAAN;AAAA,WATX;AAUC,2BAAgBpB,KAAK,KAAKP;AAV3B,WAYG2B,UAAU,CAACiB,KAZd,CADkB;AAAA,OAAjB,CANH,CADD,CAtBF,CADD;AAmDA;AACA;;;EAnQqBC,kB;;eAsQR,sBACdC,wBADc,EAEdC,8BAFc,EAGdC,uBAHc,EAId,sBAAY,UAAEC,MAAF,EAAc;AAAA,gBACDA,MAAM,CAAE,mBAAF,CADL;AAAA,MACjBC,WADiB,WACjBA,WADiB;;AAEzB,SAAO;AACNxC,IAAAA,oBAAoB,EAAEwC,WAAW,GAAGC;AAD9B,GAAP;AAGA,CALD,CAJc,EAUZ/D,QAVY,C","sourcesContent":["/**\n * External dependencies\n */\nimport { throttle } from 'lodash';\nimport classnames from 'classnames';\nimport scrollIntoView from 'dom-scroll-into-view';\n\n/**\n * WordPress dependencies\n */\nimport { __, sprintf, _n } from '@wordpress/i18n';\nimport { Component, createRef } from '@wordpress/element';\nimport { UP, DOWN, ENTER, TAB } from '@wordpress/keycodes';\nimport { Spinner, withSpokenMessages, Popover } from '@wordpress/components';\nimport { withInstanceId, withSafeTimeout, compose } from '@wordpress/compose';\nimport { withSelect } from '@wordpress/data';\n\n// Since URLInput is rendered in the context of other inputs, but should be\n// considered a separate modal node, prevent keyboard events from propagating\n// as being considered from the input.\nconst stopEventPropagation = ( event ) => event.stopPropagation();\n\nclass URLInput extends Component {\n\tconstructor( { autocompleteRef } ) {\n\t\tsuper( ...arguments );\n\n\t\tthis.onChange = this.onChange.bind( this );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.autocompleteRef = autocompleteRef || createRef();\n\t\tthis.inputRef = createRef();\n\t\tthis.updateSuggestions = throttle( this.updateSuggestions.bind( this ), 200 );\n\n\t\tthis.suggestionNodes = [];\n\n\t\tthis.state = {\n\t\t\tsuggestions: [],\n\t\t\tshowSuggestions: false,\n\t\t\tselectedSuggestion: null,\n\t\t};\n\t}\n\n\tcomponentDidUpdate() {\n\t\tconst { showSuggestions, selectedSuggestion } = this.state;\n\t\t// only have to worry about scrolling selected suggestion into view\n\t\t// when already expanded\n\t\tif ( showSuggestions && selectedSuggestion !== null && ! this.scrollingIntoView ) {\n\t\t\tthis.scrollingIntoView = true;\n\t\t\tscrollIntoView( this.suggestionNodes[ selectedSuggestion ], this.autocompleteRef.current, {\n\t\t\t\tonlyScrollIfNeeded: true,\n\t\t\t} );\n\n\t\t\tthis.props.setTimeout( () => {\n\t\t\t\tthis.scrollingIntoView = false;\n\t\t\t}, 100 );\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tdelete this.suggestionsRequest;\n\t}\n\n\tbindSuggestionNode( index ) {\n\t\treturn ( ref ) => {\n\t\t\tthis.suggestionNodes[ index ] = ref;\n\t\t};\n\t}\n\n\tupdateSuggestions( value ) {\n\t\tconst { fetchLinkSuggestions } = this.props;\n\t\tif ( ! fetchLinkSuggestions ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Show the suggestions after typing at least 2 characters\n\t\t// and also for URLs\n\t\tif ( value.length < 2 || /^https?:/.test( value ) ) {\n\t\t\tthis.setState( {\n\t\t\t\tshowSuggestions: false,\n\t\t\t\tselectedSuggestion: null,\n\t\t\t\tloading: false,\n\t\t\t} );\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tshowSuggestions: true,\n\t\t\tselectedSuggestion: null,\n\t\t\tloading: true,\n\t\t} );\n\n\t\tconst request = fetchLinkSuggestions( value );\n\n\t\trequest.then( ( suggestions ) => {\n\t\t\t// A fetch Promise doesn't have an abort option. It's mimicked by\n\t\t\t// comparing the request reference in on the instance, which is\n\t\t\t// reset or deleted on subsequent requests or unmounting.\n\t\t\tif ( this.suggestionsRequest !== request ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.setState( {\n\t\t\t\tsuggestions,\n\t\t\t\tloading: false,\n\t\t\t} );\n\n\t\t\tif ( !! suggestions.length ) {\n\t\t\t\tthis.props.debouncedSpeak( sprintf( _n(\n\t\t\t\t\t'%d result found, use up and down arrow keys to navigate.',\n\t\t\t\t\t'%d results found, use up and down arrow keys to navigate.',\n\t\t\t\t\tsuggestions.length\n\t\t\t\t), suggestions.length ), 'assertive' );\n\t\t\t} else {\n\t\t\t\tthis.props.debouncedSpeak( __( 'No results.' ), 'assertive' );\n\t\t\t}\n\t\t} ).catch( () => {\n\t\t\tif ( this.suggestionsRequest === request ) {\n\t\t\t\tthis.setState( {\n\t\t\t\t\tloading: false,\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\n\t\tthis.suggestionsRequest = request;\n\t}\n\n\tonChange( event ) {\n\t\tconst inputValue = event.target.value;\n\t\tthis.props.onChange( inputValue );\n\t\tthis.updateSuggestions( inputValue );\n\t}\n\n\tonKeyDown( event ) {\n\t\tconst { showSuggestions, selectedSuggestion, suggestions, loading } = this.state;\n\t\t// If the suggestions are not shown or loading, we shouldn't handle the arrow keys\n\t\t// We shouldn't preventDefault to allow block arrow keys navigation\n\t\tif ( ! showSuggestions || ! suggestions.length || loading ) {\n\t\t\t// In the Windows version of Firefox the up and down arrows don't move the caret\n\t\t\t// within an input field like they do for Mac Firefox/Chrome/Safari. This causes\n\t\t\t// a form of focus trapping that is disruptive to the user experience. This disruption\n\t\t\t// only happens if the caret is not in the first or last position in the text input.\n\t\t\t// See: https://github.com/WordPress/gutenberg/issues/5693#issuecomment-436684747\n\t\t\tswitch ( event.keyCode ) {\n\t\t\t\t// When UP is pressed, if the caret is at the start of the text, move it to the 0\n\t\t\t\t// position.\n\t\t\t\tcase UP: {\n\t\t\t\t\tif ( 0 !== event.target.selectionStart ) {\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\t\t// Set the input caret to position 0\n\t\t\t\t\t\tevent.target.setSelectionRange( 0, 0 );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t// When DOWN is pressed, if the caret is not at the end of the text, move it to the\n\t\t\t\t// last position.\n\t\t\t\tcase DOWN: {\n\t\t\t\t\tif ( this.props.value.length !== event.target.selectionStart ) {\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\t\t// Set the input caret to the last position\n\t\t\t\t\t\tevent.target.setSelectionRange( this.props.value.length, this.props.value.length );\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst suggestion = this.state.suggestions[ this.state.selectedSuggestion ];\n\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase UP: {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst previousIndex = ! selectedSuggestion ? suggestions.length - 1 : selectedSuggestion - 1;\n\t\t\t\tthis.setState( {\n\t\t\t\t\tselectedSuggestion: previousIndex,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase DOWN: {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst nextIndex = selectedSuggestion === null || ( selectedSuggestion === suggestions.length - 1 ) ? 0 : selectedSuggestion + 1;\n\t\t\t\tthis.setState( {\n\t\t\t\t\tselectedSuggestion: nextIndex,\n\t\t\t\t} );\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase TAB: {\n\t\t\t\tif ( this.state.selectedSuggestion !== null ) {\n\t\t\t\t\tthis.selectLink( suggestion );\n\t\t\t\t\t// Announce a link has been selected when tabbing away from the input field.\n\t\t\t\t\tthis.props.speak( __( 'Link selected.' ) );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase ENTER: {\n\t\t\t\tif ( this.state.selectedSuggestion !== null ) {\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\tthis.selectLink( suggestion );\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tselectLink( suggestion ) {\n\t\tthis.props.onChange( suggestion.url, suggestion );\n\t\tthis.setState( {\n\t\t\tselectedSuggestion: null,\n\t\t\tshowSuggestions: false,\n\t\t} );\n\t}\n\n\thandleOnClick( suggestion ) {\n\t\tthis.selectLink( suggestion );\n\t\t// Move focus to the input field when a link suggestion is clicked.\n\t\tthis.inputRef.current.focus();\n\t}\n\n\trender() {\n\t\tconst { value = '', autoFocus = true, instanceId, className } = this.props;\n\t\tconst { showSuggestions, suggestions, selectedSuggestion, loading } = this.state;\n\t\t/* eslint-disable jsx-a11y/no-autofocus */\n\t\treturn (\n\t\t\t<div className={ classnames( 'editor-url-input block-editor-url-input', className ) }>\n\t\t\t\t<input\n\t\t\t\t\tautoFocus={ autoFocus }\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\taria-label={ __( 'URL' ) }\n\t\t\t\t\trequired\n\t\t\t\t\tvalue={ value }\n\t\t\t\t\tonChange={ this.onChange }\n\t\t\t\t\tonInput={ stopEventPropagation }\n\t\t\t\t\tplaceholder={ __( 'Paste URL or type to search' ) }\n\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\trole=\"combobox\"\n\t\t\t\t\taria-expanded={ showSuggestions }\n\t\t\t\t\taria-autocomplete=\"list\"\n\t\t\t\t\taria-owns={ `block-editor-url-input-suggestions-${ instanceId }` }\n\t\t\t\t\taria-activedescendant={ selectedSuggestion !== null ? `block-editor-url-input-suggestion-${ instanceId }-${ selectedSuggestion }` : undefined }\n\t\t\t\t\tref={ this.inputRef }\n\t\t\t\t/>\n\n\t\t\t\t{ ( loading ) && <Spinner /> }\n\n\t\t\t\t{ showSuggestions && !! suggestions.length &&\n\t\t\t\t\t<Popover position=\"bottom\" noArrow focusOnMount={ false }>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclassName=\"editor-url-input__suggestions block-editor-url-input__suggestions\"\n\t\t\t\t\t\t\tid={ `editor-url-input-suggestions-${ instanceId }` }\n\t\t\t\t\t\t\tref={ this.autocompleteRef }\n\t\t\t\t\t\t\trole=\"listbox\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ suggestions.map( ( suggestion, index ) => (\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tkey={ suggestion.id }\n\t\t\t\t\t\t\t\t\trole=\"option\"\n\t\t\t\t\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\t\t\t\t\tid={ `block-editor-url-input-suggestion-${ instanceId }-${ index }` }\n\t\t\t\t\t\t\t\t\tref={ this.bindSuggestionNode( index ) }\n\t\t\t\t\t\t\t\t\tclassName={ classnames( 'editor-url-input__suggestion block-editor-url-input__suggestion', {\n\t\t\t\t\t\t\t\t\t\t'is-selected': index === selectedSuggestion,\n\t\t\t\t\t\t\t\t\t} ) }\n\t\t\t\t\t\t\t\t\tonClick={ () => this.handleOnClick( suggestion ) }\n\t\t\t\t\t\t\t\t\taria-selected={ index === selectedSuggestion }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ suggestion.title }\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Popover>\n\t\t\t\t}\n\t\t\t</div>\n\t\t);\n\t\t/* eslint-enable jsx-a11y/no-autofocus */\n\t}\n}\n\nexport default compose(\n\twithSafeTimeout,\n\twithSpokenMessages,\n\twithInstanceId,\n\twithSelect( ( select ) => {\n\t\tconst { getSettings } = select( 'core/block-editor' );\n\t\treturn {\n\t\t\tfetchLinkSuggestions: getSettings().__experimentalFetchLinkSuggestions,\n\t\t};\n\t} )\n)( URLInput );\n"]}