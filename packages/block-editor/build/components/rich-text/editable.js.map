{"version":3,"sources":["@wordpress/block-editor/src/components/rich-text/editable.js"],"names":["userAgent","window","navigator","applyInternetExplorerInputFix","editorNode","mapTextInputEvent","textInputEvent","stopImmediatePropagation","inputEvent","document","createEvent","initEvent","data","target","dispatchEvent","mapDeletionKeyUpEvents","keyCode","isDeletion","BACKSPACE","DELETE","contains","addEventListener","removeInternetExplorerInputFix","removeEventListener","IS_PLACEHOLDER_VISIBLE_ATTR_NAME","CLASS_NAME","IS_IE","indexOf","Editable","bindEditorNode","bind","nextProps","configureIsPlaceholderVisible","isPlaceholderVisible","props","style","setAttribute","Object","assign","className","removedKeys","updatedKeys","forEach","key","removeAttribute","isPlaceholderVisibleString","String","getAttribute","setRef","tagName","record","valueToEditableHTML","remainingProps","role","contentEditable","__html","Component"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { isEqual } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { Component, createElement } from '@wordpress/element';\nimport { BACKSPACE, DELETE } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport { diffAriaProps } from './aria';\n\n/**\n * Browser dependencies\n */\n\nconst { userAgent } = window.navigator;\n\n/**\n * Applies a fix that provides `input` events for contenteditable in Internet Explorer.\n *\n * @param {Element} editorNode The root editor node.\n *\n * @return {Function} A function to remove the fix (for cleanup).\n */\nfunction applyInternetExplorerInputFix( editorNode ) {\n\t/**\n\t * Dispatches `input` events in response to `textinput` events.\n\t *\n\t * IE provides a `textinput` event that is similar to an `input` event,\n\t * and we use it to manually dispatch an `input` event.\n\t * `textinput` is dispatched for text entry but for not deletions.\n\t *\n\t * @param {Event} textInputEvent An Internet Explorer `textinput` event.\n\t */\n\tfunction mapTextInputEvent( textInputEvent ) {\n\t\ttextInputEvent.stopImmediatePropagation();\n\n\t\tconst inputEvent = document.createEvent( 'Event' );\n\t\tinputEvent.initEvent( 'input', true, false );\n\t\tinputEvent.data = textInputEvent.data;\n\t\ttextInputEvent.target.dispatchEvent( inputEvent );\n\t}\n\n\t/**\n\t * Dispatches `input` events in response to Delete and Backspace keyup.\n\t *\n\t * It would be better dispatch an `input` event after each deleting\n\t * `keydown` because the DOM is updated after each, but it is challenging\n\t * to determine the right time to dispatch `input` since propagation of\n\t * `keydown` can be stopped at any point.\n\t *\n\t * It's easier to listen for `keyup` in the capture phase and dispatch\n\t * `input` before `keyup` propagates further. It's not perfect, but should\n\t * be good enough.\n\t *\n\t * @param {KeyboardEvent} keyUp\n\t * @param {Node}          keyUp.target  The event target.\n\t * @param {number}        keyUp.keyCode The key code.\n\t */\n\tfunction mapDeletionKeyUpEvents( { target, keyCode } ) {\n\t\tconst isDeletion = BACKSPACE === keyCode || DELETE === keyCode;\n\n\t\tif ( isDeletion && editorNode.contains( target ) ) {\n\t\t\tconst inputEvent = document.createEvent( 'Event' );\n\t\t\tinputEvent.initEvent( 'input', true, false );\n\t\t\tinputEvent.data = null;\n\t\t\ttarget.dispatchEvent( inputEvent );\n\t\t}\n\t}\n\n\teditorNode.addEventListener( 'textinput', mapTextInputEvent );\n\tdocument.addEventListener( 'keyup', mapDeletionKeyUpEvents, true );\n\treturn function removeInternetExplorerInputFix() {\n\t\teditorNode.removeEventListener( 'textinput', mapTextInputEvent );\n\t\tdocument.removeEventListener( 'keyup', mapDeletionKeyUpEvents, true );\n\t};\n}\n\nconst IS_PLACEHOLDER_VISIBLE_ATTR_NAME = 'data-is-placeholder-visible';\nconst CLASS_NAME = 'editor-rich-text__editable block-editor-rich-text__editable';\n\n/**\n * Whether or not the user agent is Internet Explorer.\n *\n * @type {boolean}\n */\nconst IS_IE = userAgent.indexOf( 'Trident' ) >= 0;\n\nexport default class Editable extends Component {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.bindEditorNode = this.bindEditorNode.bind( this );\n\t}\n\n\t// We must prevent rerenders because the browser will modify the DOM. React\n\t// will rerender the DOM fine, but we're losing selection and it would be\n\t// more expensive to do so as it would just set the inner HTML through\n\t// `dangerouslySetInnerHTML`. Instead RichText does it's own diffing and\n\t// selection setting.\n\t//\n\t// Because we never update the component, we have to look through props and\n\t// update the attributes on the wrapper nodes here. `componentDidUpdate`\n\t// will never be called.\n\tshouldComponentUpdate( nextProps ) {\n\t\tthis.configureIsPlaceholderVisible( nextProps.isPlaceholderVisible );\n\n\t\tif ( ! isEqual( this.props.style, nextProps.style ) ) {\n\t\t\tthis.editorNode.setAttribute( 'style', '' );\n\t\t\tObject.assign( this.editorNode.style, nextProps.style );\n\t\t}\n\n\t\tif ( ! isEqual( this.props.className, nextProps.className ) ) {\n\t\t\tthis.editorNode.className = classnames( nextProps.className, CLASS_NAME );\n\t\t}\n\n\t\tconst { removedKeys, updatedKeys } = diffAriaProps( this.props, nextProps );\n\t\tremovedKeys.forEach( ( key ) =>\n\t\t\tthis.editorNode.removeAttribute( key ) );\n\t\tupdatedKeys.forEach( ( key ) =>\n\t\t\tthis.editorNode.setAttribute( key, nextProps[ key ] ) );\n\n\t\treturn false;\n\t}\n\n\tconfigureIsPlaceholderVisible( isPlaceholderVisible ) {\n\t\tconst isPlaceholderVisibleString = String( !! isPlaceholderVisible );\n\t\tif ( this.editorNode.getAttribute( IS_PLACEHOLDER_VISIBLE_ATTR_NAME ) !== isPlaceholderVisibleString ) {\n\t\t\tthis.editorNode.setAttribute( IS_PLACEHOLDER_VISIBLE_ATTR_NAME, isPlaceholderVisibleString );\n\t\t}\n\t}\n\n\tbindEditorNode( editorNode ) {\n\t\tthis.editorNode = editorNode;\n\t\tthis.props.setRef( editorNode );\n\n\t\tif ( IS_IE ) {\n\t\t\tif ( editorNode ) {\n\t\t\t\t// Mounting:\n\t\t\t\tthis.removeInternetExplorerInputFix = applyInternetExplorerInputFix( editorNode );\n\t\t\t} else {\n\t\t\t\t// Unmounting:\n\t\t\t\tthis.removeInternetExplorerInputFix();\n\t\t\t}\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\ttagName = 'div',\n\t\t\tstyle,\n\t\t\trecord,\n\t\t\tvalueToEditableHTML,\n\t\t\tclassName,\n\t\t\tisPlaceholderVisible,\n\t\t\t...remainingProps\n\t\t} = this.props;\n\n\t\tdelete remainingProps.setRef;\n\n\t\treturn createElement( tagName, {\n\t\t\trole: 'textbox',\n\t\t\t'aria-multiline': true,\n\t\t\tclassName: classnames( className, CLASS_NAME ),\n\t\t\tcontentEditable: true,\n\t\t\t[ IS_PLACEHOLDER_VISIBLE_ATTR_NAME ]: isPlaceholderVisible,\n\t\t\tref: this.bindEditorNode,\n\t\t\tstyle,\n\t\t\tsuppressContentEditableWarning: true,\n\t\t\tdangerouslySetInnerHTML: { __html: valueToEditableHTML( record ) },\n\t\t\t...remainingProps,\n\t\t} );\n\t}\n}\n"]}