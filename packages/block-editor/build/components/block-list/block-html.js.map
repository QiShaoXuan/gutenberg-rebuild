{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/block-html.js"],"names":["BlockHTML","props","arguments","onChange","bind","onBlur","state","html","block","isValid","originalContent","prevProps","attributes","setState","blockType","name","content","clientId","event","target","value","Component","select","ownProps","getBlock","dispatch","updateBlock"],"mappings":";;;;;;;;;AAUA;;;;;;;;;;;;;;AANA;;AACA;;AAMA;;AACA;;AACA;;AAZA;;;;AAMA;;;IAQaA,S;;;;;AACZ,qBAAaC,KAAb,EAAqB;AAAA;;AAAA;AACpB,gHAAUC,SAAV;AACA,UAAKC,QAAL,GAAgB,MAAKA,QAAL,CAAcC,IAAd,mFAAhB;AACA,UAAKC,MAAL,GAAc,MAAKA,MAAL,CAAYD,IAAZ,mFAAd;AACA,UAAKE,KAAL,GAAa;AACZC,MAAAA,IAAI,EAAEN,KAAK,CAACO,KAAN,CAAYC,OAAZ,GAAsB,6BAAiBR,KAAK,CAACO,KAAvB,CAAtB,GAAuDP,KAAK,CAACO,KAAN,CAAYE;AAD7D,KAAb;AAJoB;AAOpB;;;;uCAEmBC,S,EAAY;AAC/B,UAAK,CAAE,qBAAS,KAAKV,KAAL,CAAWO,KAAX,CAAiBI,UAA1B,EAAsCD,SAAS,CAACH,KAAV,CAAgBI,UAAtD,CAAP,EAA4E;AAC3E,aAAKC,QAAL,CAAe;AACdN,UAAAA,IAAI,EAAE,6BAAiB,KAAKN,KAAL,CAAWO,KAA5B;AADQ,SAAf;AAGA;AACD;;;6BAEQ;AAAA,UACAD,IADA,GACS,KAAKD,KADd,CACAC,IADA;AAER,UAAMO,SAAS,GAAG,0BAAc,KAAKb,KAAL,CAAWO,KAAX,CAAiBO,IAA/B,CAAlB;AACA,UAAMH,UAAU,GAAG,gCAAoBE,SAApB,EAA+BP,IAA/B,EAAqC,KAAKN,KAAL,CAAWO,KAAX,CAAiBI,UAAtD,CAAnB,CAHQ,CAKR;;AACA,UAAMI,OAAO,GAAGT,IAAI,GAAGA,IAAH,GAAU,4BAAgBO,SAAhB,EAA2BF,UAA3B,CAA9B;AACA,UAAMH,OAAO,GAAGF,IAAI,GAAG,iCAAqBO,SAArB,EAAgCF,UAAhC,EAA4CI,OAA5C,CAAH,GAA2D,IAA/E;AAEA,WAAKf,KAAL,CAAWE,QAAX,CAAqB,KAAKF,KAAL,CAAWgB,QAAhC,EAA0CL,UAA1C,EAAsDI,OAAtD,EAA+DP,OAA/D,EATQ,CAWR;;AACA,UAAK,CAAEF,IAAP,EAAc;AACb,aAAKM,QAAL,CAAe;AAAEN,UAAAA,IAAI,EAAES;AAAR,SAAf;AACA;AACD;;;6BAESE,K,EAAQ;AACjB,WAAKL,QAAL,CAAe;AAAEN,QAAAA,IAAI,EAAEW,KAAK,CAACC,MAAN,CAAaC;AAArB,OAAf;AACA;;;6BAEQ;AAAA,UACAb,IADA,GACS,KAAKD,KADd,CACAC,IADA;AAER,aACC,4BAAC,8BAAD;AACC,QAAA,SAAS,EAAC,qFADX;AAEC,QAAA,KAAK,EAAGA,IAFT;AAGC,QAAA,MAAM,EAAG,KAAKF,MAHf;AAIC,QAAA,QAAQ,EAAG,KAAKF;AAJjB,QADD;AAQA;;;EAjD6BkB,kB;;;;eAoDhB,sBAAS,CACvB,sBAAY,UAAEC,MAAF,EAAUC,QAAV;AAAA,SAA0B;AACrCf,IAAAA,KAAK,EAAEc,MAAM,CAAE,mBAAF,CAAN,CAA8BE,QAA9B,CAAwCD,QAAQ,CAACN,QAAjD;AAD8B,GAA1B;AAAA,CAAZ,CADuB,EAIvB,wBAAc,UAAEQ,QAAF;AAAA,SAAkB;AAC/BtB,IAAAA,QAD+B,oBACrBc,QADqB,EACXL,UADW,EACCF,eADD,EACkBD,OADlB,EAC4B;AAC1DgB,MAAAA,QAAQ,CAAE,mBAAF,CAAR,CAAgCC,WAAhC,CAA6CT,QAA7C,EAAuD;AAAEL,QAAAA,UAAU,EAAVA,UAAF;AAAcF,QAAAA,eAAe,EAAfA,eAAd;AAA+BD,QAAAA,OAAO,EAAPA;AAA/B,OAAvD;AACA;AAH8B,GAAlB;AAAA,CAAd,CAJuB,CAAT,EASVT,SATU,C","sourcesContent":["\n/**\n * External dependencies\n */\nimport TextareaAutosize from 'react-autosize-textarea';\nimport { isEqual } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { compose } from '@wordpress/compose';\nimport { getBlockAttributes, getBlockContent, getBlockType, isValidBlockContent, getSaveContent } from '@wordpress/blocks';\nimport { withSelect, withDispatch } from '@wordpress/data';\n\nexport class BlockHTML extends Component {\n\tconstructor( props ) {\n\t\tsuper( ...arguments );\n\t\tthis.onChange = this.onChange.bind( this );\n\t\tthis.onBlur = this.onBlur.bind( this );\n\t\tthis.state = {\n\t\t\thtml: props.block.isValid ? getBlockContent( props.block ) : props.block.originalContent,\n\t\t};\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( ! isEqual( this.props.block.attributes, prevProps.block.attributes ) ) {\n\t\t\tthis.setState( {\n\t\t\t\thtml: getBlockContent( this.props.block ),\n\t\t\t} );\n\t\t}\n\t}\n\n\tonBlur() {\n\t\tconst { html } = this.state;\n\t\tconst blockType = getBlockType( this.props.block.name );\n\t\tconst attributes = getBlockAttributes( blockType, html, this.props.block.attributes );\n\n\t\t// If html is empty  we reset the block to the default HTML and mark it as valid to avoid triggering an error\n\t\tconst content = html ? html : getSaveContent( blockType, attributes );\n\t\tconst isValid = html ? isValidBlockContent( blockType, attributes, content ) : true;\n\n\t\tthis.props.onChange( this.props.clientId, attributes, content, isValid );\n\n\t\t// Ensure the state is updated if we reset so it displays the default content\n\t\tif ( ! html ) {\n\t\t\tthis.setState( { html: content } );\n\t\t}\n\t}\n\n\tonChange( event ) {\n\t\tthis.setState( { html: event.target.value } );\n\t}\n\n\trender() {\n\t\tconst { html } = this.state;\n\t\treturn (\n\t\t\t<TextareaAutosize\n\t\t\t\tclassName=\"editor-block-list__block-html-textarea block-editor-block-list__block-html-textarea\"\n\t\t\t\tvalue={ html }\n\t\t\t\tonBlur={ this.onBlur }\n\t\t\t\tonChange={ this.onChange }\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, ownProps ) => ( {\n\t\tblock: select( 'core/block-editor' ).getBlock( ownProps.clientId ),\n\t} ) ),\n\twithDispatch( ( dispatch ) => ( {\n\t\tonChange( clientId, attributes, originalContent, isValid ) {\n\t\t\tdispatch( 'core/block-editor' ).updateBlock( clientId, { attributes, originalContent, isValid } );\n\t\t},\n\t} ) ),\n] )( BlockHTML );\n"]}