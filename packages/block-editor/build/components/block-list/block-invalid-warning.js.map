{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/block-invalid-warning.js"],"names":["BlockInvalidWarning","props","state","compare","onCompare","bind","onCompareClose","setState","convertToHTML","convertToBlocks","convertToClassic","attemptBlockRecovery","block","hasHTMLBlock","hiddenActions","title","onClick","blockToBlocks","Component","blockToClassic","content","originalContent","blockToHTML","HTML","recoverBlock","name","attributes","innerBlocks","select","clientId","getBlock","dispatch","replaceBlock"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __, _x } from '@wordpress/i18n';\nimport { Button, Modal } from '@wordpress/components';\nimport { Component } from '@wordpress/element';\nimport {\n\tgetBlockType,\n\tcreateBlock,\n\trawHandler,\n} from '@wordpress/blocks';\nimport { compose } from '@wordpress/compose';\nimport { withDispatch, withSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport Warning from '../warning';\nimport BlockCompare from '../block-compare';\n\nexport class BlockInvalidWarning extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = { compare: false };\n\t\tthis.onCompare = this.onCompare.bind( this );\n\t\tthis.onCompareClose = this.onCompareClose.bind( this );\n\t}\n\n\tonCompare() {\n\t\tthis.setState( { compare: true } );\n\t}\n\n\tonCompareClose() {\n\t\tthis.setState( { compare: false } );\n\t}\n\n\trender() {\n\t\tconst { convertToHTML, convertToBlocks, convertToClassic, attemptBlockRecovery, block } = this.props;\n\t\tconst hasHTMLBlock = !! getBlockType( 'core/html' );\n\t\tconst { compare } = this.state;\n\t\tconst hiddenActions = [\n\t\t\t{ title: __( 'Convert to Classic Block' ), onClick: convertToClassic },\n\t\t\t{ title: __( 'Attempt Block Recovery' ), onClick: attemptBlockRecovery },\n\t\t];\n\n\t\tif ( compare ) {\n\t\t\treturn (\n\t\t\t\t<Modal\n\t\t\t\t\ttitle={\n\t\t\t\t\t\t// translators: Dialog title to fix block content\n\t\t\t\t\t\t__( 'Resolve Block' )\n\t\t\t\t\t}\n\t\t\t\t\tonRequestClose={ this.onCompareClose }\n\t\t\t\t\tclassName=\"editor-block-compare block-editor-block-compare\"\n\t\t\t\t>\n\t\t\t\t\t<BlockCompare\n\t\t\t\t\t\tblock={ block }\n\t\t\t\t\t\tonKeep={ convertToHTML }\n\t\t\t\t\t\tonConvert={ convertToBlocks }\n\t\t\t\t\t\tconvertor={ blockToBlocks }\n\t\t\t\t\t\tconvertButtonText={ __( 'Convert to Blocks' ) }\n\t\t\t\t\t/>\n\t\t\t\t</Modal>\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\t<Warning\n\t\t\t\tactions={ [\n\t\t\t\t\t<Button key=\"convert\" onClick={ this.onCompare } isLarge isPrimary={ ! hasHTMLBlock }>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// translators: Button to fix block content\n\t\t\t\t\t\t\t_x( 'Resolve', 'imperative verb' )\n\t\t\t\t\t\t}\n\t\t\t\t\t</Button>,\n\t\t\t\t\thasHTMLBlock && (\n\t\t\t\t\t\t<Button key=\"edit\" onClick={ convertToHTML } isLarge isPrimary>\n\t\t\t\t\t\t\t{ __( 'Convert to HTML' ) }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t),\n\t\t\t\t] }\n\t\t\t\tsecondaryActions={ hiddenActions }\n\t\t\t>\n\t\t\t\t{ __( 'This block contains unexpected or invalid content.' ) }\n\t\t\t</Warning>\n\t\t);\n\t}\n}\n\nconst blockToClassic = ( block ) => createBlock( 'core/freeform', {\n\tcontent: block.originalContent,\n} );\nconst blockToHTML = ( block ) => createBlock( 'core/html', {\n\tcontent: block.originalContent,\n} );\nconst blockToBlocks = ( block ) => rawHandler( {\n\tHTML: block.originalContent,\n} );\nconst recoverBlock = ( { name, attributes, innerBlocks } ) => createBlock( name, attributes, innerBlocks );\n\nexport default compose( [\n\twithSelect( ( select, { clientId } ) => ( {\n\t\tblock: select( 'core/block-editor' ).getBlock( clientId ),\n\t} ) ),\n\twithDispatch( ( dispatch, { block } ) => {\n\t\tconst { replaceBlock } = dispatch( 'core/block-editor' );\n\n\t\treturn {\n\t\t\tconvertToClassic() {\n\t\t\t\treplaceBlock( block.clientId, blockToClassic( block ) );\n\t\t\t},\n\t\t\tconvertToHTML() {\n\t\t\t\treplaceBlock( block.clientId, blockToHTML( block ) );\n\t\t\t},\n\t\t\tconvertToBlocks() {\n\t\t\t\treplaceBlock( block.clientId, blockToBlocks( block ) );\n\t\t\t},\n\t\t\tattemptBlockRecovery() {\n\t\t\t\treplaceBlock( block.clientId, recoverBlock( block ) );\n\t\t\t},\n\t\t};\n\t} ),\n] )( BlockInvalidWarning );\n"]}