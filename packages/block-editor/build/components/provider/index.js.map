{"version":3,"sources":["@wordpress/block-editor/src/components/provider/index.js"],"names":["BlockEditorProvider","props","updateSettings","settings","resetBlocks","value","attachChangeObserver","registry","prevProps","isSyncingOutcomingValue","isSyncingIncomingValue","unsubscribe","select","getBlocks","isLastBlockChangePersistent","blocks","isPersistent","subscribe","onChange","onInput","newBlocks","newIsPersistent","children","Component","withRegistryProvider","dispatch"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { DropZoneProvider, SlotFillProvider } from '@wordpress/components';\nimport { withDispatch } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport withRegistryProvider from './with-registry-provider';\n\nclass BlockEditorProvider extends Component {\n\tcomponentDidMount() {\n\t\tthis.props.updateSettings( this.props.settings );\n\t\tthis.props.resetBlocks( this.props.value );\n\t\tthis.attachChangeObserver( this.props.registry );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst {\n\t\t\tsettings,\n\t\t\tupdateSettings,\n\t\t\tvalue,\n\t\t\tresetBlocks,\n\t\t\tregistry,\n\t\t} = this.props;\n\n\t\tif ( settings !== prevProps.settings ) {\n\t\t\tupdateSettings( settings );\n\t\t}\n\n\t\tif ( registry !== prevProps.registry ) {\n\t\t\tthis.attachChangeObserver( registry );\n\t\t}\n\n\t\tif ( this.isSyncingOutcomingValue ) {\n\t\t\tthis.isSyncingOutcomingValue = false;\n\t\t} else if ( value !== prevProps.value ) {\n\t\t\tthis.isSyncingIncomingValue = true;\n\t\t\tresetBlocks( value );\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif ( this.unsubscribe ) {\n\t\t\tthis.unsubscribe();\n\t\t}\n\t}\n\n\t/**\n\t * Given a registry object, overrides the default dispatch behavior for the\n\t * `core/block-editor` store to interpret a state change and decide whether\n\t * we should call `onChange` or `onInput` depending on whether the change\n\t * is persistent or not.\n\t *\n\t * This needs to be done synchronously after state changes (instead of using\n\t * `componentDidUpdate`) in order to avoid batching these changes.\n\t *\n\t * @param {WPDataRegistry} registry     Registry from which block editor\n\t *                                      dispatch is to be overriden.\n\t */\n\tattachChangeObserver( registry ) {\n\t\tif ( this.unsubscribe ) {\n\t\t\tthis.unsubscribe();\n\t\t}\n\n\t\tconst {\n\t\t\tgetBlocks,\n\t\t\tisLastBlockChangePersistent,\n\t\t} = registry.select( 'core/block-editor' );\n\n\t\tlet blocks = getBlocks();\n\t\tlet isPersistent = isLastBlockChangePersistent();\n\n\t\tthis.unsubscribe = registry.subscribe( () => {\n\t\t\tconst {\n\t\t\t\tonChange,\n\t\t\t\tonInput,\n\t\t\t} = this.props;\n\t\t\tconst newBlocks = getBlocks();\n\t\t\tconst newIsPersistent = isLastBlockChangePersistent();\n\t\t\tif ( newBlocks !== blocks && this.isSyncingIncomingValue ) {\n\t\t\t\tthis.isSyncingIncomingValue = false;\n\t\t\t\tblocks = newBlocks;\n\t\t\t\tisPersistent = newIsPersistent;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tnewBlocks !== blocks ||\n\t\t\t\t// This happens when a previous input is explicitely marked as persistent.\n\t\t\t\t( newIsPersistent && ! isPersistent )\n\t\t\t) {\n\t\t\t\tblocks = newBlocks;\n\t\t\t\tisPersistent = newIsPersistent;\n\n\t\t\t\tthis.isSyncingOutcomingValue = true;\n\t\t\t\tif ( isPersistent ) {\n\t\t\t\t\tonChange( blocks );\n\t\t\t\t} else {\n\t\t\t\t\tonInput( blocks );\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\t}\n\n\trender() {\n\t\tconst { children } = this.props;\n\n\t\treturn (\n\t\t\t<SlotFillProvider>\n\t\t\t\t<DropZoneProvider>\n\t\t\t\t\t{ children }\n\t\t\t\t</DropZoneProvider>\n\t\t\t</SlotFillProvider>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithRegistryProvider,\n\twithDispatch( ( dispatch ) => {\n\t\tconst {\n\t\t\tupdateSettings,\n\t\t\tresetBlocks,\n\t\t} = dispatch( 'core/block-editor' );\n\n\t\treturn {\n\t\t\tupdateSettings,\n\t\t\tresetBlocks,\n\t\t};\n\t} ),\n] )( BlockEditorProvider );\n"]}