{"version":3,"sources":["@wordpress/block-editor/src/components/inner-blocks/index.js"],"names":["InnerBlocks","arguments","state","templateInProcess","props","template","updateNestedSettings","templateLock","parentLock","undefined","innerBlocks","block","length","getTemplateLock","synchronizeBlocksWithTemplate","setState","prevProps","hasTemplateChanged","replaceInnerBlocks","nextBlocks","blockListSettings","allowedBlocks","newSettings","clientId","isSmallScreen","isSelectedBlockInRoot","classes","Component","context","select","ownProps","isBlockSelected","hasSelectedInnerBlock","getBlock","getBlockListSettings","getBlockRootClientId","rootClientId","dispatch","updateBlockListSettings","templateInsertUpdatesSelection","blocks","settings","Content","BlockContent"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { pick, isEqual } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { withViewportMatch } from '@wordpress/viewport';\nimport { Component } from '@wordpress/element';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport { synchronizeBlocksWithTemplate, withBlockContentContext } from '@wordpress/blocks';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\nimport { compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport BlockList from '../block-list';\nimport { withBlockEditContext } from '../block-edit/context';\n\nclass InnerBlocks extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.state = {\n\t\t\ttemplateInProcess: !! this.props.template,\n\t\t};\n\t\tthis.updateNestedSettings();\n\t}\n\n\tgetTemplateLock() {\n\t\tconst {\n\t\t\ttemplateLock,\n\t\t\tparentLock,\n\t\t} = this.props;\n\t\treturn templateLock === undefined ? parentLock : templateLock;\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { innerBlocks } = this.props.block;\n\t\t// only synchronize innerBlocks with template if innerBlocks are empty or a locking all exists\n\t\tif ( innerBlocks.length === 0 || this.getTemplateLock() === 'all' ) {\n\t\t\tthis.synchronizeBlocksWithTemplate();\n\t\t}\n\t\tif ( this.state.templateInProcess ) {\n\t\t\tthis.setState( {\n\t\t\t\ttemplateInProcess: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { template, block } = this.props;\n\t\tconst { innerBlocks } = block;\n\n\t\tthis.updateNestedSettings();\n\t\t// only synchronize innerBlocks with template if innerBlocks are empty or a locking all exists\n\t\tif ( innerBlocks.length === 0 || this.getTemplateLock() === 'all' ) {\n\t\t\tconst hasTemplateChanged = ! isEqual( template, prevProps.template );\n\t\t\tif ( hasTemplateChanged ) {\n\t\t\t\tthis.synchronizeBlocksWithTemplate();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Called on mount or when a mismatch exists between the templates and\n\t * inner blocks, synchronizes inner blocks with the template, replacing\n\t * current blocks.\n\t */\n\tsynchronizeBlocksWithTemplate() {\n\t\tconst { template, block, replaceInnerBlocks } = this.props;\n\t\tconst { innerBlocks } = block;\n\n\t\t// Synchronize with templates. If the next set differs, replace.\n\t\tconst nextBlocks = synchronizeBlocksWithTemplate( innerBlocks, template );\n\t\tif ( ! isEqual( nextBlocks, innerBlocks\t) ) {\n\t\t\treplaceInnerBlocks( nextBlocks );\n\t\t}\n\t}\n\n\tupdateNestedSettings() {\n\t\tconst {\n\t\t\tblockListSettings,\n\t\t\tallowedBlocks,\n\t\t\tupdateNestedSettings,\n\t\t} = this.props;\n\n\t\tconst newSettings = {\n\t\t\tallowedBlocks,\n\t\t\ttemplateLock: this.getTemplateLock(),\n\t\t};\n\n\t\tif ( ! isShallowEqual( blockListSettings, newSettings ) ) {\n\t\t\tupdateNestedSettings( newSettings );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tclientId,\n\t\t\tisSmallScreen,\n\t\t\tisSelectedBlockInRoot,\n\t\t} = this.props;\n\t\tconst { templateInProcess } = this.state;\n\n\t\tconst classes = classnames( 'editor-inner-blocks block-editor-inner-blocks', {\n\t\t\t'has-overlay': isSmallScreen && ! isSelectedBlockInRoot,\n\t\t} );\n\n\t\treturn (\n\t\t\t<div className={ classes }>\n\t\t\t\t{ ! templateInProcess && (\n\t\t\t\t\t<BlockList\n\t\t\t\t\t\trootClientId={ clientId }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nInnerBlocks = compose( [\n\twithBlockEditContext( ( context ) => pick( context, [ 'clientId' ] ) ),\n\twithViewportMatch( { isSmallScreen: '< medium' } ),\n\twithSelect( ( select, ownProps ) => {\n\t\tconst {\n\t\t\tisBlockSelected,\n\t\t\thasSelectedInnerBlock,\n\t\t\tgetBlock,\n\t\t\tgetBlockListSettings,\n\t\t\tgetBlockRootClientId,\n\t\t\tgetTemplateLock,\n\t\t} = select( 'core/block-editor' );\n\t\tconst { clientId } = ownProps;\n\t\tconst rootClientId = getBlockRootClientId( clientId );\n\t\treturn {\n\t\t\tisSelectedBlockInRoot: isBlockSelected( clientId ) || hasSelectedInnerBlock( clientId ),\n\t\t\tblock: getBlock( clientId ),\n\t\t\tblockListSettings: getBlockListSettings( clientId ),\n\t\t\tparentLock: getTemplateLock( rootClientId ),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps ) => {\n\t\tconst {\n\t\t\treplaceInnerBlocks,\n\t\t\tupdateBlockListSettings,\n\t\t} = dispatch( 'core/block-editor' );\n\t\tconst { block, clientId, templateInsertUpdatesSelection = true } = ownProps;\n\n\t\treturn {\n\t\t\treplaceInnerBlocks( blocks ) {\n\t\t\t\treplaceInnerBlocks( clientId, blocks, block.innerBlocks.length === 0 && templateInsertUpdatesSelection );\n\t\t\t},\n\t\t\tupdateNestedSettings( settings ) {\n\t\t\t\tdispatch( updateBlockListSettings( clientId, settings ) );\n\t\t\t},\n\t\t};\n\t} ),\n] )( InnerBlocks );\n\nInnerBlocks.Content = withBlockContentContext(\n\t( { BlockContent } ) => <BlockContent />\n);\n\nexport default InnerBlocks;\n"]}