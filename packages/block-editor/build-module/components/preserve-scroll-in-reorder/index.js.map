{"version":3,"sources":["@wordpress/block-editor/src/components/preserve-scroll-in-reorder/index.js"],"names":["Component","withSelect","getScrollContainer","getBlockDOMNode","PreserveScrollInReorder","prevProps","props","blockOrder","selectionStart","getOffset","prevState","snapshot","restorePreviousOffset","blockNode","getBoundingClientRect","top","offset","scrollContainer","scrollTop","select","getBlockOrder","getBlockSelectionStart"],"mappings":";;;;;;AAAA;;;AAGA,SAASA,SAAT,QAA0B,oBAA1B;AACA,SAASC,UAAT,QAA2B,iBAA3B;AACA,SAASC,kBAAT,QAAmC,gBAAnC;AAEA;;;;AAGA,SAASC,eAAT,QAAgC,iBAAhC;AAEA;;;;;;;;;;;IAUMC,uB;;;;;;;;;;;;;4CACoBC,S,EAAY;AAAA,wBACG,KAAKC,KADR;AAAA,UAC5BC,UAD4B,eAC5BA,UAD4B;AAAA,UAChBC,cADgB,eAChBA,cADgB;;AAEpC,UAAKD,UAAU,KAAKF,SAAS,CAACE,UAAzB,IAAuCC,cAA5C,EAA6D;AAC5D,eAAO,KAAKC,SAAL,CAAgBD,cAAhB,CAAP;AACA;;AAED,aAAO,IAAP;AACA;;;uCAEmBH,S,EAAWK,S,EAAWC,Q,EAAW;AACpD,UAAKA,QAAL,EAAgB;AACf,aAAKC,qBAAL,CAA4BD,QAA5B;AACA;AACD;AAED;;;;;;;;;;;8BAQWH,c,EAAiB;AAC3B,UAAMK,SAAS,GAAGV,eAAe,CAAEK,cAAF,CAAjC;;AACA,UAAK,CAAEK,SAAP,EAAmB;AAClB,eAAO,IAAP;AACA;;AAED,aAAOA,SAAS,CAACC,qBAAV,GAAkCC,GAAzC;AACA;AAED;;;;;;;;0CAKuBC,M,EAAS;AAAA,UACvBR,cADuB,GACJ,KAAKF,KADD,CACvBE,cADuB;AAE/B,UAAMK,SAAS,GAAGV,eAAe,CAAEK,cAAF,CAAjC;;AACA,UAAKK,SAAL,EAAiB;AAChB,YAAMI,eAAe,GAAGf,kBAAkB,CAAEW,SAAF,CAA1C;;AACA,YAAKI,eAAL,EAAuB;AACtBA,UAAAA,eAAe,CAACC,SAAhB,GAA4BD,eAAe,CAACC,SAAhB,GAC3BL,SAAS,CAACC,qBAAV,GAAkCC,GADP,GACaC,MADzC;AAEA;AACD;AACD;;;6BAEQ;AACR,aAAO,IAAP;AACA;;;;EApDoChB,S;;AAuDtC,eAAeC,UAAU,CAAE,UAAEkB,MAAF,EAAc;AACxC,SAAO;AACNZ,IAAAA,UAAU,EAAEY,MAAM,CAAE,mBAAF,CAAN,CAA8BC,aAA9B,EADN;AAENZ,IAAAA,cAAc,EAAEW,MAAM,CAAE,mBAAF,CAAN,CAA8BE,sBAA9B;AAFV,GAAP;AAIA,CALwB,CAAV,CAKVjB,uBALU,CAAf","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { withSelect } from '@wordpress/data';\nimport { getScrollContainer } from '@wordpress/dom';\n\n/**\n * Internal dependencies\n */\nimport { getBlockDOMNode } from '../../utils/dom';\n\n/**\n * Non-visual component which preserves offset of selected block within nearest\n * scrollable container while reordering.\n *\n * @example\n *\n * ```jsx\n * <PreserveScrollInReorder />\n * ```\n */\nclass PreserveScrollInReorder extends Component {\n\tgetSnapshotBeforeUpdate( prevProps ) {\n\t\tconst { blockOrder, selectionStart } = this.props;\n\t\tif ( blockOrder !== prevProps.blockOrder && selectionStart ) {\n\t\t\treturn this.getOffset( selectionStart );\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tcomponentDidUpdate( prevProps, prevState, snapshot ) {\n\t\tif ( snapshot ) {\n\t\t\tthis.restorePreviousOffset( snapshot );\n\t\t}\n\t}\n\n\t/**\n\t * Given the block client ID of the start of the selection, saves the\n\t * block's top offset as an instance property before a reorder is to occur.\n\t *\n\t * @param {string} selectionStart Client ID of selected block.\n\t *\n\t * @return {number?} The scroll offset.\n\t */\n\tgetOffset( selectionStart ) {\n\t\tconst blockNode = getBlockDOMNode( selectionStart );\n\t\tif ( ! blockNode ) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn blockNode.getBoundingClientRect().top;\n\t}\n\n\t/**\n\t * After a block reordering, restores the previous viewport top offset.\n\t *\n\t * @param {number} offset The scroll offset.\n\t */\n\trestorePreviousOffset( offset ) {\n\t\tconst { selectionStart } = this.props;\n\t\tconst blockNode = getBlockDOMNode( selectionStart );\n\t\tif ( blockNode ) {\n\t\t\tconst scrollContainer = getScrollContainer( blockNode );\n\t\t\tif ( scrollContainer ) {\n\t\t\t\tscrollContainer.scrollTop = scrollContainer.scrollTop +\n\t\t\t\t\tblockNode.getBoundingClientRect().top - offset;\n\t\t\t}\n\t\t}\n\t}\n\n\trender() {\n\t\treturn null;\n\t}\n}\n\nexport default withSelect( ( select ) => {\n\treturn {\n\t\tblockOrder: select( 'core/block-editor' ).getBlockOrder(),\n\t\tselectionStart: select( 'core/block-editor' ).getBlockSelectionStart(),\n\t};\n} )( PreserveScrollInReorder );\n"]}