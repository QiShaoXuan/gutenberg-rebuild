{"version":3,"sources":["@wordpress/core-data/src/reducer.js"],"names":["terms","state","action","type","taxonomy","users","byId","queries","queryID","user","id","taxonomies","themeSupports","entity","entityConfig","name","kind","key","DEFAULT_ENTITY_KEY","queriedDataReducer","entitiesConfig","defaultEntities","entities","newConfig","config","entitiesDataReducer","reducer","entitiesByKind","Object","entries","reduce","memo","subEntities","kindReducer","kindMemo","newData","data","embedPreviews","url","preview","userPermissions","isAllowed"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { keyBy, map, groupBy, flowRight } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { combineReducers } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { ifMatchingAction, replaceAction } from './utils';\nimport { reducer as queriedDataReducer } from './queried-data';\nimport { defaultEntities, DEFAULT_ENTITY_KEY } from './entities';\n\n/**\n * Reducer managing terms state. Keyed by taxonomy slug, the value is either\n * undefined (if no request has been made for given taxonomy), null (if a\n * request is in-flight for given taxonomy), or the array of terms for the\n * taxonomy.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function terms( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_TERMS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.taxonomy ]: action.terms,\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing authors state. Keyed by id.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function users( state = { byId: {}, queries: {} }, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_USER_QUERY':\n\t\t\treturn {\n\t\t\t\tbyId: {\n\t\t\t\t\t...state.byId,\n\t\t\t\t\t...keyBy( action.users, 'id' ),\n\t\t\t\t},\n\t\t\t\tqueries: {\n\t\t\t\t\t...state.queries,\n\t\t\t\t\t[ action.queryID ]: map( action.users, ( user ) => user.id ),\n\t\t\t\t},\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing taxonomies.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function taxonomies( state = [], action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_TAXONOMIES':\n\t\t\treturn action.taxonomies;\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing theme supports data.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function themeSupports( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_THEME_SUPPORTS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...action.themeSupports,\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Higher Order Reducer for a given entity config. It supports:\n *\n *  - Fetching a record by primary key\n *\n * @param {Object} entityConfig  Entity config.\n *\n * @return {Function} Reducer.\n */\nfunction entity( entityConfig ) {\n\treturn flowRight( [\n\t\t// Limit to matching action type so we don't attempt to replace action on\n\t\t// an unhandled action.\n\t\tifMatchingAction( ( action ) => (\n\t\t\taction.name &&\n\t\t\taction.kind &&\n\t\t\taction.name === entityConfig.name &&\n\t\t\taction.kind === entityConfig.kind\n\t\t) ),\n\n\t\t// Inject the entity config into the action.\n\t\treplaceAction( ( action ) => {\n\t\t\treturn {\n\t\t\t\t...action,\n\t\t\t\tkey: entityConfig.key || DEFAULT_ENTITY_KEY,\n\t\t\t};\n\t\t} ),\n\t] )( queriedDataReducer );\n}\n\n/**\n * Reducer keeping track of the registered entities.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function entitiesConfig( state = defaultEntities, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'ADD_ENTITIES':\n\t\t\treturn [\n\t\t\t\t...state,\n\t\t\t\t...action.entities,\n\t\t\t];\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer keeping track of the registered entities config and data.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport const entities = ( state = {}, action ) => {\n\tconst newConfig = entitiesConfig( state.config, action );\n\n\t// Generates a dynamic reducer for the entities\n\tlet entitiesDataReducer = state.reducer;\n\tif ( ! entitiesDataReducer || newConfig !== state.config ) {\n\t\tconst entitiesByKind = groupBy( newConfig, 'kind' );\n\t\tentitiesDataReducer = combineReducers( Object.entries( entitiesByKind ).reduce( ( memo, [ kind, subEntities ] ) => {\n\t\t\tconst kindReducer = combineReducers( subEntities.reduce(\n\t\t\t\t( kindMemo, entityConfig ) => ( {\n\t\t\t\t\t...kindMemo,\n\t\t\t\t\t[ entityConfig.name ]: entity( entityConfig ),\n\t\t\t\t} ),\n\t\t\t\t{}\n\t\t\t) );\n\n\t\t\tmemo[ kind ] = kindReducer;\n\t\t\treturn memo;\n\t\t}, {} ) );\n\t}\n\n\tconst newData = entitiesDataReducer( state.data, action );\n\n\tif (\n\t\tnewData === state.data &&\n\t\tnewConfig === state.config &&\n\t\tentitiesDataReducer === state.reducer\n\t) {\n\t\treturn state;\n\t}\n\n\treturn {\n\t\treducer: entitiesDataReducer,\n\t\tdata: newData,\n\t\tconfig: newConfig,\n\t};\n};\n\n/**\n * Reducer managing embed preview data.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function embedPreviews( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_EMBED_PREVIEW':\n\t\t\tconst { url, preview } = action;\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ url ]: preview,\n\t\t\t};\n\t}\n\treturn state;\n}\n\n/**\n * State which tracks whether the user can perform an action on a REST\n * resource.\n *\n * @param  {Object} state  Current state.\n * @param  {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function userPermissions( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_USER_PERMISSION':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.key ]: action.isAllowed,\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\nexport default combineReducers( {\n\tterms,\n\tusers,\n\ttaxonomies,\n\tthemeSupports,\n\tentities,\n\tembedPreviews,\n\tuserPermissions,\n} );\n"]}