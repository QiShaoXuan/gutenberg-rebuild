{"version":3,"sources":["@wordpress/editor/src/components/autosave-monitor/index.js"],"names":["AutosaveMonitor","prevProps","props","isDirty","editsReference","isAutosaveable","isAutosaving","didAutosaveForEditsReference","toggleTimer","isPendingSave","clearTimeout","pendingSave","autosaveInterval","setTimeout","autosave","Component","select","isEditedPostDirty","isEditedPostAutosaveable","getReferenceByDistinctEdits","isAutosavingPost","getEditorSettings","dispatch"],"mappings":";;;;;;;;;;;;;;;;;;;AAGA;;AACA;;AACA;;AALA;;;IAOaA,e;;;;;;;;;;;;uCACQC,S,EAAY;AAAA,wBACmC,KAAKC,KADxC;AAAA,UACvBC,OADuB,eACvBA,OADuB;AAAA,UACdC,cADc,eACdA,cADc;AAAA,UACEC,cADF,eACEA,cADF;AAAA,UACkBC,YADlB,eACkBA,YADlB,EAG/B;AACA;AACA;AACA;AACA;AACA;;AAEA,UAAKF,cAAc,KAAKH,SAAS,CAACG,cAAlC,EAAmD;AAClD,aAAKG,4BAAL,GAAoC,KAApC;AACA;;AAED,UAAK,CAAED,YAAF,IAAkBL,SAAS,CAACK,YAAjC,EAAgD;AAC/C,aAAKC,4BAAL,GAAoC,IAApC;AACA;;AAED,UACCN,SAAS,CAACE,OAAV,KAAsBA,OAAtB,IACAF,SAAS,CAACI,cAAV,KAA6BA,cAD7B,IAEAJ,SAAS,CAACG,cAAV,KAA6BA,cAH9B,EAIE;AACD,aAAKI,WAAL,CACCL,OAAO,IACPE,cADA,IAEA,CAAE,KAAKE,4BAHR;AAKA;AACD;;;2CAEsB;AACtB,WAAKC,WAAL,CAAkB,KAAlB;AACA;;;gCAEYC,a,EAAgB;AAAA;;AAC5BC,MAAAA,YAAY,CAAE,KAAKC,WAAP,CAAZ;AAD4B,UAEpBC,gBAFoB,GAEC,KAAKV,KAFN,CAEpBU,gBAFoB;;AAG5B,UAAKH,aAAL,EAAqB;AACpB,aAAKE,WAAL,GAAmBE,UAAU,CAC5B;AAAA,iBAAM,KAAI,CAACX,KAAL,CAAWY,QAAX,EAAN;AAAA,SAD4B,EAE5BF,gBAAgB,GAAG,IAFS,CAA7B;AAIA;AACD;;;6BAEQ;AACR,aAAO,IAAP;AACA;;;EAjDmCG,kB;;;;eAoDtB,sBAAS,CACvB,sBAAY,UAAEC,MAAF,EAAc;AAAA,gBAMrBA,MAAM,CAAE,aAAF,CANe;AAAA,MAExBC,iBAFwB,WAExBA,iBAFwB;AAAA,MAGxBC,wBAHwB,WAGxBA,wBAHwB;AAAA,MAIxBC,2BAJwB,WAIxBA,2BAJwB;AAAA,MAKxBC,gBALwB,WAKxBA,gBALwB;;AAAA,8BAQIJ,MAAM,CAAE,aAAF,CAAN,CAAwBK,iBAAxB,EARJ;AAAA,MAQjBT,gBARiB,yBAQjBA,gBARiB;;AAUzB,SAAO;AACNT,IAAAA,OAAO,EAAEc,iBAAiB,EADpB;AAENZ,IAAAA,cAAc,EAAEa,wBAAwB,EAFlC;AAGNd,IAAAA,cAAc,EAAEe,2BAA2B,EAHrC;AAINb,IAAAA,YAAY,EAAEc,gBAAgB,EAJxB;AAKNR,IAAAA,gBAAgB,EAAhBA;AALM,GAAP;AAOA,CAjBD,CADuB,EAmBvB,wBAAc,UAAEU,QAAF;AAAA,SAAkB;AAC/BR,IAAAA,QAAQ,EAAEQ,QAAQ,CAAE,aAAF,CAAR,CAA0BR;AADL,GAAlB;AAAA,CAAd,CAnBuB,CAAT,EAsBVd,eAtBU,C","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { compose } from '@wordpress/compose';\nimport { withSelect, withDispatch } from '@wordpress/data';\n\nexport class AutosaveMonitor extends Component {\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { isDirty, editsReference, isAutosaveable, isAutosaving } = this.props;\n\n\t\t// The edits reference is held for comparison to avoid scheduling an\n\t\t// autosave if an edit has not been made since the last autosave\n\t\t// completion. This is assigned when the autosave completes, and reset\n\t\t// when an edit occurs.\n\t\t//\n\t\t// See: https://github.com/WordPress/gutenberg/issues/12318\n\n\t\tif ( editsReference !== prevProps.editsReference ) {\n\t\t\tthis.didAutosaveForEditsReference = false;\n\t\t}\n\n\t\tif ( ! isAutosaving && prevProps.isAutosaving ) {\n\t\t\tthis.didAutosaveForEditsReference = true;\n\t\t}\n\n\t\tif (\n\t\t\tprevProps.isDirty !== isDirty ||\n\t\t\tprevProps.isAutosaveable !== isAutosaveable ||\n\t\t\tprevProps.editsReference !== editsReference\n\t\t) {\n\t\t\tthis.toggleTimer(\n\t\t\t\tisDirty &&\n\t\t\t\tisAutosaveable &&\n\t\t\t\t! this.didAutosaveForEditsReference\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.toggleTimer( false );\n\t}\n\n\ttoggleTimer( isPendingSave ) {\n\t\tclearTimeout( this.pendingSave );\n\t\tconst { autosaveInterval } = this.props;\n\t\tif ( isPendingSave ) {\n\t\t\tthis.pendingSave = setTimeout(\n\t\t\t\t() => this.props.autosave(),\n\t\t\t\tautosaveInterval * 1000\n\t\t\t);\n\t\t}\n\t}\n\n\trender() {\n\t\treturn null;\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst {\n\t\t\tisEditedPostDirty,\n\t\t\tisEditedPostAutosaveable,\n\t\t\tgetReferenceByDistinctEdits,\n\t\t\tisAutosavingPost,\n\t\t} = select( 'core/editor' );\n\n\t\tconst { autosaveInterval } = select( 'core/editor' ).getEditorSettings();\n\n\t\treturn {\n\t\t\tisDirty: isEditedPostDirty(),\n\t\t\tisAutosaveable: isEditedPostAutosaveable(),\n\t\t\teditsReference: getReferenceByDistinctEdits(),\n\t\t\tisAutosaving: isAutosavingPost(),\n\t\t\tautosaveInterval,\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => ( {\n\t\tautosave: dispatch( 'core/editor' ).autosave,\n\t} ) ),\n] )( AutosaveMonitor );\n"]}