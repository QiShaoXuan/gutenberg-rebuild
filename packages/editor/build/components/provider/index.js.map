{"version":3,"sources":["@wordpress/editor/src/components/provider/index.js"],"names":["fetchLinkSuggestions","search","path","per_page","type","posts","post","id","url","title","EditorProvider","props","arguments","getBlockEditorSettings","maxSize","recovery","updatePostLock","settings","postLock","setupEditor","initialEdits","template","autosave","createWarningNotice","actions","label","editLink","meta","onMetaChange","reusableBlocks","hasUploadPermissions","__experimentalMetaSource","value","onChange","__experimentalReusableBlocks","__experimentalMediaUpload","mediaUpload","undefined","__experimentalFetchLinkSuggestions","updateEditorSettings","styles","updatedStyles","updatedCSS","node","document","createElement","innerHTML","body","appendChild","prevProps","children","blocks","resetEditorBlocks","isReady","resetEditorBlocksWithoutUndoLevel","editorSettings","Component","select","isEditorReady","__unstableIsEditorReady","getEditorBlocks","getEditedPostAttribute","__experimentalGetReusableBlocks","canUser","dispatch","editPost","__unstableShouldCreateUndoLevel"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { map, pick, defaultTo } from 'lodash';\nimport memize from 'memize';\n\n/**\n * WordPress dependencies\n */\nimport { compose } from '@wordpress/compose';\nimport { Component } from '@wordpress/element';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\nimport { BlockEditorProvider } from '@wordpress/block-editor';\nimport apiFetch from '@wordpress/api-fetch';\nimport { addQueryArgs } from '@wordpress/url';\nimport { decodeEntities } from '@wordpress/html-entities';\n\n/**\n * Internal dependencies\n */\nimport transformStyles from '../../editor-styles';\nimport { mediaUpload } from '../../utils';\nimport ReusableBlocksButtons from '../reusable-blocks-buttons';\n\nconst fetchLinkSuggestions = async ( search ) => {\n\tconst posts = await apiFetch( {\n\t\tpath: addQueryArgs( '/wp/v2/search', {\n\t\t\tsearch,\n\t\t\tper_page: 20,\n\t\t\ttype: 'post',\n\t\t} ),\n\t} );\n\n\treturn map( posts, ( post ) => ( {\n\t\tid: post.id,\n\t\turl: post.url,\n\t\ttitle: decodeEntities( post.title ) || __( '(no title)' ),\n\t} ) );\n};\n\nclass EditorProvider extends Component {\n\tconstructor( props ) {\n\t\tsuper( ...arguments );\n\n\t\tthis.getBlockEditorSettings = memize( this.getBlockEditorSettings, {\n\t\t\tmaxSize: 1,\n\t\t} );\n\n\t\t// Assume that we don't need to initialize in the case of an error recovery.\n\t\tif ( props.recovery ) {\n\t\t\treturn;\n\t\t}\n\n\t\tprops.updatePostLock( props.settings.postLock );\n\t\tprops.setupEditor( props.post, props.initialEdits, props.settings.template );\n\n\t\tif ( props.settings.autosave ) {\n\t\t\tprops.createWarningNotice(\n\t\t\t\t__( 'There is an autosave of this post that is more recent than the version below.' ),\n\t\t\t\t{\n\t\t\t\t\tid: 'autosave-exists',\n\t\t\t\t\tactions: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __( 'View the autosave' ),\n\t\t\t\t\t\t\turl: props.settings.autosave.editLink,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tgetBlockEditorSettings( settings, meta, onMetaChange, reusableBlocks, hasUploadPermissions ) {\n\t\treturn {\n\t\t\t...pick( settings, [\n\t\t\t\t'alignWide',\n\t\t\t\t'allowedBlockTypes',\n\t\t\t\t'availableLegacyWidgets',\n\t\t\t\t'bodyPlaceholder',\n\t\t\t\t'colors',\n\t\t\t\t'disableCustomColors',\n\t\t\t\t'disableCustomFontSizes',\n\t\t\t\t'focusMode',\n\t\t\t\t'fontSizes',\n\t\t\t\t'hasFixedToolbar',\n\t\t\t\t'hasPermissionsToManageWidgets',\n\t\t\t\t'imageSizes',\n\t\t\t\t'isRTL',\n\t\t\t\t'maxWidth',\n\t\t\t\t'styles',\n\t\t\t\t'templateLock',\n\t\t\t\t'titlePlaceholder',\n\t\t\t] ),\n\t\t\t__experimentalMetaSource: {\n\t\t\t\tvalue: meta,\n\t\t\t\tonChange: onMetaChange,\n\t\t\t},\n\t\t\t__experimentalReusableBlocks: reusableBlocks,\n\t\t\t__experimentalMediaUpload: hasUploadPermissions ? mediaUpload : undefined,\n\t\t\t__experimentalFetchLinkSuggestions: fetchLinkSuggestions,\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.props.updateEditorSettings( this.props.settings );\n\n\t\tif ( ! this.props.settings.styles ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst updatedStyles = transformStyles( this.props.settings.styles, '.editor-styles-wrapper' );\n\n\t\tmap( updatedStyles, ( updatedCSS ) => {\n\t\t\tif ( updatedCSS ) {\n\t\t\t\tconst node = document.createElement( 'style' );\n\t\t\t\tnode.innerHTML = updatedCSS;\n\t\t\t\tdocument.body.appendChild( node );\n\t\t\t}\n\t\t} );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( this.props.settings !== prevProps.settings ) {\n\t\t\tthis.props.updateEditorSettings( this.props.settings );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tchildren,\n\t\t\tblocks,\n\t\t\tresetEditorBlocks,\n\t\t\tisReady,\n\t\t\tsettings,\n\t\t\tmeta,\n\t\t\tonMetaChange,\n\t\t\treusableBlocks,\n\t\t\tresetEditorBlocksWithoutUndoLevel,\n\t\t\thasUploadPermissions,\n\t\t} = this.props;\n\n\t\tif ( ! isReady ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst editorSettings = this.getBlockEditorSettings(\n\t\t\tsettings, meta, onMetaChange, reusableBlocks, hasUploadPermissions\n\t\t);\n\n\t\treturn (\n\t\t\t<BlockEditorProvider\n\t\t\t\tvalue={ blocks }\n\t\t\t\tonInput={ resetEditorBlocksWithoutUndoLevel }\n\t\t\t\tonChange={ resetEditorBlocks }\n\t\t\t\tsettings={ editorSettings }\n\t\t\t\tuseSubRegistry={ false }\n\t\t\t>\n\t\t\t\t{ children }\n\t\t\t\t<ReusableBlocksButtons />\n\t\t\t</BlockEditorProvider>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst {\n\t\t\t__unstableIsEditorReady: isEditorReady,\n\t\t\tgetEditorBlocks,\n\t\t\tgetEditedPostAttribute,\n\t\t\t__experimentalGetReusableBlocks,\n\t\t} = select( 'core/editor' );\n\t\tconst { canUser } = select( 'core' );\n\n\t\treturn {\n\t\t\tisReady: isEditorReady(),\n\t\t\tblocks: getEditorBlocks(),\n\t\t\tmeta: getEditedPostAttribute( 'meta' ),\n\t\t\treusableBlocks: __experimentalGetReusableBlocks(),\n\t\t\thasUploadPermissions: defaultTo( canUser( 'create', 'media' ), true ),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst {\n\t\t\tsetupEditor,\n\t\t\tupdatePostLock,\n\t\t\tresetEditorBlocks,\n\t\t\teditPost,\n\t\t\tupdateEditorSettings,\n\t\t} = dispatch( 'core/editor' );\n\t\tconst { createWarningNotice } = dispatch( 'core/notices' );\n\n\t\treturn {\n\t\t\tsetupEditor,\n\t\t\tupdatePostLock,\n\t\t\tcreateWarningNotice,\n\t\t\tresetEditorBlocks,\n\t\t\tupdateEditorSettings,\n\t\t\tresetEditorBlocksWithoutUndoLevel( blocks ) {\n\t\t\t\tresetEditorBlocks( blocks, {\n\t\t\t\t\t__unstableShouldCreateUndoLevel: false,\n\t\t\t\t} );\n\t\t\t},\n\t\t\tonMetaChange( meta ) {\n\t\t\t\teditPost( { meta } );\n\t\t\t},\n\t\t};\n\t} ),\n] )( EditorProvider );\n"]}