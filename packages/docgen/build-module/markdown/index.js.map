{"version":3,"sources":["@wordpress/docgen/src/markdown/index.js"],"names":["remark","require","unified","remarkParser","inject","fs","formatter","embed","appendOrEmbedContents","options","newContents","transform","targetAst","file","next","toSection","Error","toToken","useToken","module","exports","processDir","doc","filteredIr","headingTitle","currentReadmeFile","readFileSync","output","use","parse","settings","commonmark","process","err","writeFileSync"],"mappings":"AAAA;;;AAGA,IAAMA,MAAM,GAAGC,OAAO,CAAE,QAAF,CAAtB;;AACA,IAAMC,OAAO,GAAGD,OAAO,CAAE,SAAF,CAAvB;;AACA,IAAME,YAAY,GAAGF,OAAO,CAAE,cAAF,CAA5B;;AACA,IAAMG,MAAM,GAAGH,OAAO,CAAE,mBAAF,CAAtB;;AACA,IAAMI,EAAE,GAAGJ,OAAO,CAAE,IAAF,CAAlB;AAEA;;;;;AAGA,IAAMK,SAAS,GAAGL,OAAO,CAAE,aAAF,CAAzB;;AACA,IAAMM,KAAK,GAAGN,OAAO,CAAE,SAAF,CAArB;;AAEA,IAAMO,qBAAqB,GAAG,SAAxBA,qBAAwB,OAAgC;AAAA,MAA5BC,OAA4B,QAA5BA,OAA4B;AAAA,MAAnBC,WAAmB,QAAnBA,WAAmB;AAC7D,SAAO,SAASC,SAAT,CAAoBC,SAApB,EAA+BC,IAA/B,EAAqCC,IAArC,EAA4C;AAClD,QAAKL,OAAO,CAACM,SAAR,IAAqB,CAAEX,MAAM,CAAEK,OAAO,CAACM,SAAV,EAAqBH,SAArB,EAAgCF,WAAhC,CAAlC,EAAkF;AACjF,aAAOI,IAAI,CAAE,IAAIE,KAAJ,mBAAuBP,OAAO,CAACM,SAA/B,iBAAF,CAAX;AACA,KAFD,MAEO,IAAKN,OAAO,CAACQ,OAAR,IAAmB,CAAEV,KAAK,CAAEE,OAAO,CAACS,QAAV,EAAoBN,SAApB,EAA+BF,WAA/B,CAA/B,EAA8E;AACpF,aAAOI,IAAI,CAAE,IAAIE,KAAJ,uCAA2CP,OAAO,CAACS,QAAnD,iBAAF,CAAX;AACA;;AACDJ,IAAAA,IAAI;AACJ,GAPD;AAQA,CATD;;AAWAK,MAAM,CAACC,OAAP,GAAiB,UAAUX,OAAV,EAAmBY,UAAnB,EAA+BC,GAA/B,EAAoCC,UAApC,EAAgDC,YAAhD,EAA+D;AAC/E,MAAKf,OAAO,CAACM,SAAR,IAAqBN,OAAO,CAACQ,OAAlC,EAA4C;AAC3C,QAAMQ,iBAAiB,GAAGpB,EAAE,CAACqB,YAAH,CAAiBjB,OAAO,CAACkB,MAAzB,EAAiC,MAAjC,CAA1B;AACA,QAAMjB,WAAW,GAAGR,OAAO,GAAG0B,GAAV,CAAezB,YAAf,EAA8B0B,KAA9B,CAAqCvB,SAAS,CAAEe,UAAF,EAAcC,GAAd,EAAmBC,UAAnB,EAA+B,IAA/B,CAA9C,CAApB;AACAvB,IAAAA,MAAM,GACJ4B,GADF,CACO;AAAEE,MAAAA,QAAQ,EAAE;AAAEC,QAAAA,UAAU,EAAE;AAAd;AAAZ,KADP,EAEEH,GAFF,CAEOpB,qBAFP,EAE8B;AAAEC,MAAAA,OAAO,EAAPA,OAAF;AAAWC,MAAAA,WAAW,EAAXA;AAAX,KAF9B,EAGEsB,OAHF,CAGWP,iBAHX,EAG8B,UAAUQ,GAAV,EAAepB,IAAf,EAAsB;AAClD,UAAKoB,GAAL,EAAW;AACV,cAAMA,GAAN;AACA;;AACD5B,MAAAA,EAAE,CAAC6B,aAAH,CAAkBZ,GAAlB,EAAuBT,IAAvB;AACA,KARF;AASA,GAZD,MAYO;AACN,QAAMc,MAAM,GAAGrB,SAAS,CAAEe,UAAF,EAAcC,GAAd,EAAmBC,UAAnB,EAA+BC,YAA/B,CAAxB;AACAnB,IAAAA,EAAE,CAAC6B,aAAH,CAAkBZ,GAAlB,EAAuBK,MAAvB;AACA;AACD,CAjBD","sourcesContent":["/**\n * External dependencies.\n */\nconst remark = require( 'remark' );\nconst unified = require( 'unified' );\nconst remarkParser = require( 'remark-parse' );\nconst inject = require( 'mdast-util-inject' );\nconst fs = require( 'fs' );\n\n/**\n * Internal dependencies.\n */\nconst formatter = require( './formatter' );\nconst embed = require( './embed' );\n\nconst appendOrEmbedContents = ( { options, newContents } ) => {\n\treturn function transform( targetAst, file, next ) {\n\t\tif ( options.toSection && ! inject( options.toSection, targetAst, newContents ) ) {\n\t\t\treturn next( new Error( `Heading ${ options.toSection } not found.` ) );\n\t\t} else if ( options.toToken && ! embed( options.useToken, targetAst, newContents ) ) {\n\t\t\treturn next( new Error( `Start and/or end tokens for ${ options.useToken } not found.` ) );\n\t\t}\n\t\tnext();\n\t};\n};\n\nmodule.exports = function( options, processDir, doc, filteredIr, headingTitle ) {\n\tif ( options.toSection || options.toToken ) {\n\t\tconst currentReadmeFile = fs.readFileSync( options.output, 'utf8' );\n\t\tconst newContents = unified().use( remarkParser ).parse( formatter( processDir, doc, filteredIr, null ) );\n\t\tremark()\n\t\t\t.use( { settings: { commonmark: true } } )\n\t\t\t.use( appendOrEmbedContents, { options, newContents } )\n\t\t\t.process( currentReadmeFile, function( err, file ) {\n\t\t\t\tif ( err ) {\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t\tfs.writeFileSync( doc, file );\n\t\t\t} );\n\t} else {\n\t\tconst output = formatter( processDir, doc, filteredIr, headingTitle );\n\t\tfs.writeFileSync( doc, output );\n\t}\n};\n"]}