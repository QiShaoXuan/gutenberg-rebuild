{"version":3,"sources":["@wordpress/docgen/src/index.js"],"names":["fs","require","path","last","engine","defaultMarkdownFormatter","relativeToAbsolute","basePath","relativePath","target","join","dirname","extname","targetFile","existsSync","process","stderr","write","exit","getIRFromRelativePath","rootDir","startsWith","absolutePath","result","processFile","ir","undefined","inputFile","data","readFileSync","currentFileStack","push","relative","pop","e","runCustomFormatter","customFormatterFile","doc","symbols","headingTitle","customFormatter","output","writeFileSync","module","exports","sourceFile","options","processDir","cwd","debugMode","debug","inputBase","basename","ast","tokens","filteredIr","filter","name","ignore","match","stdout","formatter","JSON","stringify"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nconst fs = require( 'fs' );\nconst path = require( 'path' );\nconst { last } = require( 'lodash' );\n\n/**\n * Internal dependencies\n */\nconst engine = require( './engine' );\nconst defaultMarkdownFormatter = require( './markdown' );\n\n/**\n * Helpers functions.\n */\n\nconst relativeToAbsolute = ( basePath, relativePath ) => {\n\tconst target = path.join( path.dirname( basePath ), relativePath );\n\tif ( path.extname( target ) === '.js' ) {\n\t\treturn target;\n\t}\n\tlet targetFile = target + '.js';\n\tif ( fs.existsSync( targetFile ) ) {\n\t\treturn targetFile;\n\t}\n\ttargetFile = path.join( target, 'index.js' );\n\tif ( fs.existsSync( targetFile ) ) {\n\t\treturn targetFile;\n\t}\n\tprocess.stderr.write( '\\nRelative path does not exists.' );\n\tprocess.stderr.write( '\\n' );\n\tprocess.stderr.write( `\\nBase: ${ basePath }` );\n\tprocess.stderr.write( `\\nRelative: ${ relativePath }` );\n\tprocess.stderr.write( '\\n\\n' );\n\tprocess.exit( 1 );\n};\n\nconst getIRFromRelativePath = ( rootDir, basePath ) => ( relativePath ) => {\n\tif ( ! relativePath.startsWith( '.' ) ) {\n\t\treturn [];\n\t}\n\tconst absolutePath = relativeToAbsolute( basePath, relativePath );\n\tconst result = processFile( rootDir, absolutePath );\n\treturn result.ir || undefined;\n};\n\nconst processFile = ( rootDir, inputFile ) => {\n\ttry {\n\t\tconst data = fs.readFileSync( inputFile, 'utf8' );\n\t\tcurrentFileStack.push( inputFile );\n\t\tconst relativePath = path.relative( rootDir, inputFile );\n\t\tconst result = engine( relativePath, data, getIRFromRelativePath( rootDir, last( currentFileStack ) ) );\n\t\tcurrentFileStack.pop( inputFile );\n\t\treturn result;\n\t} catch ( e ) {\n\t\tprocess.stderr.write( `\\n${ e }` );\n\t\tprocess.stderr.write( '\\n\\n' );\n\t\tprocess.exit( 1 );\n\t}\n};\n\nconst runCustomFormatter = ( customFormatterFile, rootDir, doc, symbols, headingTitle ) => {\n\ttry {\n\t\tconst customFormatter = require( customFormatterFile );\n\t\tconst output = customFormatter( rootDir, doc, symbols, headingTitle );\n\t\tfs.writeFileSync( doc, output );\n\t} catch ( e ) {\n\t\tprocess.stderr.write( `\\n${ e }` );\n\t\tprocess.stderr.write( '\\n\\n' );\n\t\tprocess.exit( 1 );\n\t}\n\treturn 'custom formatter';\n};\n\n// To keep track of file being processed.\nconst currentFileStack = [];\n\nmodule.exports = function( sourceFile, options ) {\n\t// Input: process CLI args, prepare files, etc\n\tconst processDir = process.cwd();\n\tif ( sourceFile === undefined ) {\n\t\tprocess.stderr.write( '\\n' );\n\t\tprocess.stderr.write( 'No source file provided' );\n\t\tprocess.stderr.write( '\\n\\n' );\n\t\tprocess.exit( 1 );\n\t}\n\tsourceFile = path.join( processDir, sourceFile );\n\n\tconst debugMode = options.debug ? true : false;\n\n\tconst inputBase = path.join(\n\t\tpath.dirname( sourceFile ),\n\t\tpath.basename( sourceFile, path.extname( sourceFile ) )\n\t);\n\tconst ast = inputBase + '-ast.json';\n\tconst tokens = inputBase + '-exports.json';\n\tconst ir = inputBase + '-ir.json';\n\tconst doc = options.output ?\n\t\tpath.join( processDir, options.output ) :\n\t\tinputBase + '-api.md';\n\n\t// Process\n\tconst result = processFile( processDir, sourceFile );\n\tconst filteredIr = result.ir.filter( ( { name } ) => options.ignore ? ! name.match( options.ignore ) : true );\n\n\t// Ouput\n\tif ( result === undefined ) {\n\t\tprocess.stdout.write( '\\nFile was processed, but contained no ES6 module exports:' );\n\t\tprocess.stdout.write( `\\n${ sourceFile }` );\n\t\tprocess.stdout.write( '\\n\\n' );\n\t\tprocess.exit( 0 );\n\t}\n\n\tif ( options.formatter ) {\n\t\trunCustomFormatter( path.join( processDir, options.formatter ), processDir, doc, filteredIr, 'API' );\n\t} else {\n\t\tdefaultMarkdownFormatter( options, processDir, doc, filteredIr, 'API' );\n\t}\n\n\tif ( debugMode ) {\n\t\tfs.writeFileSync( ir, JSON.stringify( result.ir ) );\n\t\tfs.writeFileSync( tokens, JSON.stringify( result.tokens ) );\n\t\tfs.writeFileSync( ast, JSON.stringify( result.ast ) );\n\t}\n\n\tprocess.exit( 0 );\n};\n"]}