{"version":3,"sources":["@wordpress/block-library/src/image/edit.native.js"],"names":["React","View","ImageBackground","TextInput","Text","TouchableWithoutFeedback","subscribeMediaUpload","requestMediaPickFromMediaLibrary","requestMediaPickFromDeviceLibrary","requestMediaPickFromDeviceCamera","mediaUploadSync","requestImageFailedRetryDialog","requestImageUploadCancelDialog","Toolbar","ToolbarButton","Spinner","Dashicon","MediaPlaceholder","RichText","BlockControls","InspectorControls","BottomSheet","Picker","__","isURL","doAction","hasAction","ImageSize","styles","MEDIA_UPLOAD_STATE_UPLOADING","MEDIA_UPLOAD_STATE_SUCCEEDED","MEDIA_UPLOAD_STATE_FAILED","MEDIA_UPLOAD_STATE_RESET","MEDIA_UPLOAD_BOTTOM_SHEET_VALUE_CHOOSE_FROM_DEVICE","MEDIA_UPLOAD_BOTTOM_SHEET_VALUE_TAKE_PHOTO","MEDIA_UPLOAD_BOTTOM_SHEET_VALUE_WORD_PRESS_LIBRARY","LINK_DESTINATION_CUSTOM","LINK_DESTINATION_NONE","ImageEdit","props","state","showSettings","progress","isUploadInProgress","isUploadFailed","mediaUpload","bind","addMediaUploadListener","removeMediaUploadListener","finishMediaUploadWithSuccess","finishMediaUploadWithFailure","updateMediaProgress","updateAlt","updateImageURL","onSetLinkDestination","onImagePressed","onClearSettings","attributes","id","url","payload","mediaId","mediaUploadStateReset","setAttributes","setState","mediaUrl","mediaServerId","subscriptionParentMediaUpload","remove","newAlt","alt","width","undefined","height","href","linkDestination","icon","value","label","isSelected","caption","onMediaLibraryButtonPressed","onMediaUploadButtonPressed","mediaUri","onMediaCaptureButtonPressed","onImageSettingsButtonPressed","onImageSettingsClose","picker","onMediaOptionsButtonPressed","presentPicker","toolbarEditButton","getInspectorControls","clearSettingsButton","mediaOptions","getMediaOptionsItems","getMediaOptions","instance","flex","showSpinner","opacity","sizes","imageWidthWithinContainer","imageHeightWithinContainer","finalHeight","finalWidth","imageContainer","uri","uploadFailedText","isEmpty","padding","textAlign","fontFamily","newCaption","Component"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport React from 'react';\nimport { View, ImageBackground, TextInput, Text, TouchableWithoutFeedback } from 'react-native';\nimport {\n\tsubscribeMediaUpload,\n\trequestMediaPickFromMediaLibrary,\n\trequestMediaPickFromDeviceLibrary,\n\trequestMediaPickFromDeviceCamera,\n\tmediaUploadSync,\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n} from 'react-native-gutenberg-bridge';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tToolbar,\n\tToolbarButton,\n\tSpinner,\n\tDashicon,\n} from '@wordpress/components';\nimport {\n\tMediaPlaceholder,\n\tRichText,\n\tBlockControls,\n\tInspectorControls,\n} from '@wordpress/block-editor';\nimport {\n\tBottomSheet,\n\tPicker,\n} from '@wordpress/editor';\nimport { __ } from '@wordpress/i18n';\nimport { isURL } from '@wordpress/url';\nimport { doAction, hasAction } from '@wordpress/hooks';\n\n/**\n * Internal dependencies\n */\nimport ImageSize from './image-size';\nimport styles from './styles.scss';\n\nconst MEDIA_UPLOAD_STATE_UPLOADING = 1;\nconst MEDIA_UPLOAD_STATE_SUCCEEDED = 2;\nconst MEDIA_UPLOAD_STATE_FAILED = 3;\nconst MEDIA_UPLOAD_STATE_RESET = 4;\n\nconst MEDIA_UPLOAD_BOTTOM_SHEET_VALUE_CHOOSE_FROM_DEVICE = 'choose_from_device';\nconst MEDIA_UPLOAD_BOTTOM_SHEET_VALUE_TAKE_PHOTO = 'take_photo';\nconst MEDIA_UPLOAD_BOTTOM_SHEET_VALUE_WORD_PRESS_LIBRARY = 'wordpress_media_library';\n\nconst LINK_DESTINATION_CUSTOM = 'custom';\nconst LINK_DESTINATION_NONE = 'none';\n\nclass ImageEdit extends React.Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = {\n\t\t\tshowSettings: false,\n\t\t\tprogress: 0,\n\t\t\tisUploadInProgress: false,\n\t\t\tisUploadFailed: false,\n\t\t};\n\n\t\tthis.mediaUpload = this.mediaUpload.bind( this );\n\t\tthis.addMediaUploadListener = this.addMediaUploadListener.bind( this );\n\t\tthis.removeMediaUploadListener = this.removeMediaUploadListener.bind( this );\n\t\tthis.finishMediaUploadWithSuccess = this.finishMediaUploadWithSuccess.bind( this );\n\t\tthis.finishMediaUploadWithFailure = this.finishMediaUploadWithFailure.bind( this );\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.updateAlt = this.updateAlt.bind( this );\n\t\tthis.updateImageURL = this.updateImageURL.bind( this );\n\t\tthis.onSetLinkDestination = this.onSetLinkDestination.bind( this );\n\t\tthis.onImagePressed = this.onImagePressed.bind( this );\n\t\tthis.onClearSettings = this.onClearSettings.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes } = this.props;\n\n\t\tif ( attributes.id && ! isURL( attributes.url ) ) {\n\t\t\tthis.addMediaUploadListener();\n\t\t\tmediaUploadSync();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\t// this action will only exist if the user pressed the trash button on the block holder\n\t\tif ( hasAction( 'blocks.onRemoveBlockCheckUpload' ) && this.state.isUploadInProgress ) {\n\t\t\tdoAction( 'blocks.onRemoveBlockCheckUpload', this.props.attributes.id );\n\t\t}\n\t\tthis.removeMediaUploadListener();\n\t}\n\n\tonImagePressed() {\n\t\tconst { attributes } = this.props;\n\n\t\tif ( this.state.isUploadInProgress ) {\n\t\t\trequestImageUploadCancelDialog( attributes.id );\n\t\t} else if ( attributes.id && ! isURL( attributes.url ) ) {\n\t\t\trequestImageFailedRetryDialog( attributes.id );\n\t\t}\n\t}\n\n\tmediaUpload( payload ) {\n\t\tconst { attributes } = this.props;\n\n\t\tif ( payload.mediaId !== attributes.id ) {\n\t\t\treturn;\n\t\t}\n\n\t\tswitch ( payload.state ) {\n\t\t\tcase MEDIA_UPLOAD_STATE_UPLOADING:\n\t\t\t\tthis.updateMediaProgress( payload );\n\t\t\t\tbreak;\n\t\t\tcase MEDIA_UPLOAD_STATE_SUCCEEDED:\n\t\t\t\tthis.finishMediaUploadWithSuccess( payload );\n\t\t\t\tbreak;\n\t\t\tcase MEDIA_UPLOAD_STATE_FAILED:\n\t\t\t\tthis.finishMediaUploadWithFailure( payload );\n\t\t\t\tbreak;\n\t\t\tcase MEDIA_UPLOAD_STATE_RESET:\n\t\t\t\tthis.mediaUploadStateReset( payload );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateMediaProgress( payload ) {\n\t\tconst { setAttributes } = this.props;\n\t\tthis.setState( { progress: payload.progress, isUploadInProgress: true, isUploadFailed: false } );\n\t\tif ( payload.mediaUrl ) {\n\t\t\tsetAttributes( { url: payload.mediaUrl } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { url: payload.mediaUrl, id: payload.mediaServerId } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\n\t\tthis.removeMediaUploadListener();\n\t}\n\n\tfinishMediaUploadWithFailure( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: payload.mediaId } );\n\t\tthis.setState( { isUploadInProgress: false, isUploadFailed: true } );\n\t}\n\n\tmediaUploadStateReset( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: payload.mediaId, url: null } );\n\t\tthis.setState( { isUploadInProgress: false, isUploadFailed: false } );\n\t}\n\n\taddMediaUploadListener() {\n\t\t//if we already have a subscription not worth doing it again\n\t\tif ( this.subscriptionParentMediaUpload ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.subscriptionParentMediaUpload = subscribeMediaUpload( ( payload ) => {\n\t\t\tthis.mediaUpload( payload );\n\t\t} );\n\t}\n\n\tremoveMediaUploadListener() {\n\t\tif ( this.subscriptionParentMediaUpload ) {\n\t\t\tthis.subscriptionParentMediaUpload.remove();\n\t\t}\n\t}\n\n\tupdateAlt( newAlt ) {\n\t\tthis.props.setAttributes( { alt: newAlt } );\n\t}\n\n\tupdateImageURL( url ) {\n\t\tthis.props.setAttributes( { url, width: undefined, height: undefined } );\n\t}\n\n\tonSetLinkDestination( href ) {\n\t\tthis.props.setAttributes( {\n\t\t\tlinkDestination: LINK_DESTINATION_CUSTOM,\n\t\t\thref,\n\t\t} );\n\t}\n\n\tonClearSettings() {\n\t\tthis.props.setAttributes( {\n\t\t\talt: '',\n\t\t\tlinkDestination: LINK_DESTINATION_NONE,\n\t\t\thref: undefined,\n\t\t} );\n\t}\n\n\tgetMediaOptionsItems() {\n\t\treturn [\n\t\t\t{ icon: 'format-image', value: MEDIA_UPLOAD_BOTTOM_SHEET_VALUE_CHOOSE_FROM_DEVICE, label: __( 'Choose from device' ) },\n\t\t\t{ icon: 'camera', value: MEDIA_UPLOAD_BOTTOM_SHEET_VALUE_TAKE_PHOTO, label: __( 'Take a Photo' ) },\n\t\t\t{ icon: 'wordpress-alt', value: MEDIA_UPLOAD_BOTTOM_SHEET_VALUE_WORD_PRESS_LIBRARY, label: __( 'WordPress Media Library' ) },\n\t\t];\n\t}\n\n\trender() {\n\t\tconst { attributes, isSelected, setAttributes } = this.props;\n\t\tconst { url, caption, height, width, alt, href } = attributes;\n\n\t\tconst onMediaLibraryButtonPressed = () => {\n\t\t\trequestMediaPickFromMediaLibrary( ( mediaId, mediaUrl ) => {\n\t\t\t\tif ( mediaUrl ) {\n\t\t\t\t\tsetAttributes( { id: mediaId, url: mediaUrl } );\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\n\t\tconst onMediaUploadButtonPressed = () => {\n\t\t\trequestMediaPickFromDeviceLibrary( ( mediaId, mediaUri ) => {\n\t\t\t\tif ( mediaUri ) {\n\t\t\t\t\tthis.addMediaUploadListener( );\n\t\t\t\t\tsetAttributes( { url: mediaUri, id: mediaId } );\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\n\t\tconst onMediaCaptureButtonPressed = () => {\n\t\t\trequestMediaPickFromDeviceCamera( ( mediaId, mediaUri ) => {\n\t\t\t\tif ( mediaUri ) {\n\t\t\t\t\tthis.addMediaUploadListener( );\n\t\t\t\t\tsetAttributes( { url: mediaUri, id: mediaId } );\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\n\t\tconst onImageSettingsButtonPressed = () => {\n\t\t\tthis.setState( { showSettings: true } );\n\t\t};\n\n\t\tconst onImageSettingsClose = () => {\n\t\t\tthis.setState( { showSettings: false } );\n\t\t};\n\n\t\tlet picker;\n\n\t\tconst onMediaOptionsButtonPressed = () => {\n\t\t\tpicker.presentPicker();\n\t\t};\n\n\t\tconst toolbarEditButton = (\n\t\t\t<Toolbar>\n\t\t\t\t<ToolbarButton\n\t\t\t\t\tlabel={ __( 'Edit image' ) }\n\t\t\t\t\ticon=\"edit\"\n\t\t\t\t\tonClick={ onMediaOptionsButtonPressed }\n\t\t\t\t/>\n\t\t\t</Toolbar>\n\t\t);\n\n\t\tconst getInspectorControls = () => (\n\t\t\t<BottomSheet\n\t\t\t\tisVisible={ this.state.showSettings }\n\t\t\t\tonClose={ onImageSettingsClose }\n\t\t\t\thideHeader\n\t\t\t>\n\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\ticon={ 'admin-links' }\n\t\t\t\t\tlabel={ __( 'Link To' ) }\n\t\t\t\t\tvalue={ href || '' }\n\t\t\t\t\tvaluePlaceholder={ __( 'Add URL' ) }\n\t\t\t\t\tonChangeValue={ this.onSetLinkDestination }\n\t\t\t\t\tautoCapitalize=\"none\"\n\t\t\t\t\tautoCorrect={ false }\n\t\t\t\t/>\n\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\ticon={ 'editor-textcolor' }\n\t\t\t\t\tlabel={ __( 'Alt Text' ) }\n\t\t\t\t\tvalue={ alt || '' }\n\t\t\t\t\tvaluePlaceholder={ __( 'None' ) }\n\t\t\t\t\tseparatorType={ 'fullWidth' }\n\t\t\t\t\tonChangeValue={ this.updateAlt }\n\t\t\t\t/>\n\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\tlabel={ __( 'Clear All Settings' ) }\n\t\t\t\t\tlabelStyle={ styles.clearSettingsButton }\n\t\t\t\t\tseparatorType={ 'none' }\n\t\t\t\t\tonPress={ this.onClearSettings }\n\t\t\t\t/>\n\t\t\t</BottomSheet>\n\t\t);\n\n\t\tconst mediaOptions = this.getMediaOptionsItems();\n\n\t\tconst getMediaOptions = () => (\n\t\t\t<Picker\n\t\t\t\thideCancelButton={ true }\n\t\t\t\tref={ ( instance ) => picker = instance }\n\t\t\t\toptions={ mediaOptions }\n\t\t\t\tonChange={ ( value ) => {\n\t\t\t\t\tif ( value === MEDIA_UPLOAD_BOTTOM_SHEET_VALUE_CHOOSE_FROM_DEVICE ) {\n\t\t\t\t\t\tonMediaUploadButtonPressed();\n\t\t\t\t\t} else if ( value === MEDIA_UPLOAD_BOTTOM_SHEET_VALUE_TAKE_PHOTO ) {\n\t\t\t\t\t\tonMediaCaptureButtonPressed();\n\t\t\t\t\t} else if ( value === MEDIA_UPLOAD_BOTTOM_SHEET_VALUE_WORD_PRESS_LIBRARY ) {\n\t\t\t\t\t\tonMediaLibraryButtonPressed();\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\n\t\tif ( ! url ) {\n\t\t\treturn (\n\t\t\t\t<View style={ { flex: 1 } } >\n\t\t\t\t\t{ getMediaOptions() }\n\t\t\t\t\t<MediaPlaceholder\n\t\t\t\t\t\tonMediaOptionsPressed={ onMediaOptionsButtonPressed }\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t);\n\t\t}\n\n\t\tconst showSpinner = this.state.isUploadInProgress;\n\t\tconst opacity = this.state.isUploadInProgress ? 0.3 : 1;\n\t\tconst progress = this.state.progress * 100;\n\n\t\treturn (\n\t\t\t<TouchableWithoutFeedback onPress={ this.onImagePressed } disabled={ ! isSelected }>\n\t\t\t\t<View style={ { flex: 1 } }>\n\t\t\t\t\t{ showSpinner && <Spinner progress={ progress } /> }\n\t\t\t\t\t<BlockControls>\n\t\t\t\t\t\t{ toolbarEditButton }\n\t\t\t\t\t</BlockControls>\n\t\t\t\t\t<InspectorControls>\n\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\tlabel={ __( 'Image Settings' ) }\n\t\t\t\t\t\t\ticon=\"admin-generic\"\n\t\t\t\t\t\t\tonClick={ onImageSettingsButtonPressed }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</InspectorControls>\n\t\t\t\t\t<ImageSize src={ url } >\n\t\t\t\t\t\t{ ( sizes ) => {\n\t\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\t\timageWidthWithinContainer,\n\t\t\t\t\t\t\t\timageHeightWithinContainer,\n\t\t\t\t\t\t\t} = sizes;\n\n\t\t\t\t\t\t\tlet finalHeight = imageHeightWithinContainer;\n\t\t\t\t\t\t\tif ( height > 0 && height < imageHeightWithinContainer ) {\n\t\t\t\t\t\t\t\tfinalHeight = height;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet finalWidth = imageWidthWithinContainer;\n\t\t\t\t\t\t\tif ( width > 0 && width < imageWidthWithinContainer ) {\n\t\t\t\t\t\t\t\tfinalWidth = width;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<View style={ { flex: 1 } } >\n\t\t\t\t\t\t\t\t\t{ getInspectorControls() }\n\t\t\t\t\t\t\t\t\t{ getMediaOptions() }\n\t\t\t\t\t\t\t\t\t{ ! imageWidthWithinContainer && <View style={ styles.imageContainer } >\n\t\t\t\t\t\t\t\t\t\t<Dashicon icon={ 'format-image' } size={ 300 } />\n\t\t\t\t\t\t\t\t\t</View> }\n\t\t\t\t\t\t\t\t\t<ImageBackground\n\t\t\t\t\t\t\t\t\t\tstyle={ { width: finalWidth, height: finalHeight, opacity } }\n\t\t\t\t\t\t\t\t\t\tresizeMethod=\"scale\"\n\t\t\t\t\t\t\t\t\t\tsource={ { uri: url } }\n\t\t\t\t\t\t\t\t\t\tkey={ url }\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ this.state.isUploadFailed &&\n\t\t\t\t\t\t\t\t\t\t\t<View style={ styles.imageContainer } >\n\t\t\t\t\t\t\t\t\t\t\t\t<Dashicon icon={ 'image-rotate' } ariaPressed={ 'dashicon-active' } />\n\t\t\t\t\t\t\t\t\t\t\t\t<Text style={ styles.uploadFailedText }>{ __( 'Failed to insert media.\\nPlease tap for options.' ) }</Text>\n\t\t\t\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t</ImageBackground>\n\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} }\n\t\t\t\t\t</ImageSize>\n\t\t\t\t\t{ ( ! RichText.isEmpty( caption ) > 0 || isSelected ) && (\n\t\t\t\t\t\t<View style={ { padding: 12, flex: 1 } }>\n\t\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\t\tstyle={ { textAlign: 'center' } }\n\t\t\t\t\t\t\t\tfontFamily={ this.props.fontFamily || ( styles[ 'caption-text' ].fontFamily ) }\n\t\t\t\t\t\t\t\tunderlineColorAndroid=\"transparent\"\n\t\t\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\t\t\tplaceholder={ __( 'Write caption…' ) }\n\t\t\t\t\t\t\t\tonChangeText={ ( newCaption ) => setAttributes( { caption: newCaption } ) }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</View>\n\t\t\t\t\t) }\n\t\t\t\t</View>\n\t\t\t</TouchableWithoutFeedback>\n\t\t);\n\t}\n}\n\nexport default ImageEdit;\n"]}