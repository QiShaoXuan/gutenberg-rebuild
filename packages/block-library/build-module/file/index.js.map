{"version":3,"sources":["@wordpress/block-library/src/file/index.js"],"names":["includes","__","_x","createBlobURL","createBlock","select","RichText","edit","icon","name","settings","title","description","category","keywords","attributes","id","type","href","fileName","source","selector","textLinkHref","attribute","textLinkTarget","showDownloadButton","default","downloadButtonText","supports","align","transforms","from","isMatch","files","length","priority","transform","blocks","forEach","file","blobURL","push","src","caption","url","to","getMedia","media","mime_type","save","isEmpty"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { includes } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __, _x } from '@wordpress/i18n';\nimport { createBlobURL } from '@wordpress/blob';\nimport { createBlock } from '@wordpress/blocks';\nimport { select } from '@wordpress/data';\nimport { RichText } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport edit from './edit';\nimport icon from './icon';\n\nexport const name = 'core/file';\n\nexport const settings = {\n\ttitle: __( 'File' ),\n\n\tdescription: __( 'Add a link to a downloadable file.' ),\n\n\ticon,\n\n\tcategory: 'common',\n\n\tkeywords: [ __( 'document' ), __( 'pdf' ) ],\n\n\tattributes: {\n\t\tid: {\n\t\t\ttype: 'number',\n\t\t},\n\t\thref: {\n\t\t\ttype: 'string',\n\t\t},\n\t\tfileName: {\n\t\t\ttype: 'string',\n\t\t\tsource: 'html',\n\t\t\tselector: 'a:not([download])',\n\t\t},\n\t\t// Differs to the href when the block is configured to link to the attachment page\n\t\ttextLinkHref: {\n\t\t\ttype: 'string',\n\t\t\tsource: 'attribute',\n\t\t\tselector: 'a:not([download])',\n\t\t\tattribute: 'href',\n\t\t},\n\t\t// e.g. `_blank` when the block is configured to open in a new tab\n\t\ttextLinkTarget: {\n\t\t\ttype: 'string',\n\t\t\tsource: 'attribute',\n\t\t\tselector: 'a:not([download])',\n\t\t\tattribute: 'target',\n\t\t},\n\t\tshowDownloadButton: {\n\t\t\ttype: 'boolean',\n\t\t\tdefault: true,\n\t\t},\n\t\tdownloadButtonText: {\n\t\t\ttype: 'string',\n\t\t\tsource: 'html',\n\t\t\tselector: 'a[download]',\n\t\t\tdefault: _x( 'Download', 'button label' ),\n\t\t},\n\t},\n\n\tsupports: {\n\t\talign: true,\n\t},\n\n\ttransforms: {\n\t\tfrom: [\n\t\t\t{\n\t\t\t\ttype: 'files',\n\t\t\t\tisMatch( files ) {\n\t\t\t\t\treturn files.length > 0;\n\t\t\t\t},\n\t\t\t\t// We define a lower priorty (higher number) than the default of 10. This\n\t\t\t\t// ensures that the File block is only created as a fallback.\n\t\t\t\tpriority: 15,\n\t\t\t\ttransform: ( files ) => {\n\t\t\t\t\tconst blocks = [];\n\n\t\t\t\t\tfiles.forEach( ( file ) => {\n\t\t\t\t\t\tconst blobURL = createBlobURL( file );\n\n\t\t\t\t\t\t// File will be uploaded in componentDidMount()\n\t\t\t\t\t\tblocks.push( createBlock( 'core/file', {\n\t\t\t\t\t\t\thref: blobURL,\n\t\t\t\t\t\t\tfileName: file.name,\n\t\t\t\t\t\t\ttextLinkHref: blobURL,\n\t\t\t\t\t\t} ) );\n\t\t\t\t\t} );\n\n\t\t\t\t\treturn blocks;\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'block',\n\t\t\t\tblocks: [ 'core/audio' ],\n\t\t\t\ttransform: ( attributes ) => {\n\t\t\t\t\treturn createBlock( 'core/file', {\n\t\t\t\t\t\thref: attributes.src,\n\t\t\t\t\t\tfileName: attributes.caption,\n\t\t\t\t\t\ttextLinkHref: attributes.src,\n\t\t\t\t\t\tid: attributes.id,\n\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'block',\n\t\t\t\tblocks: [ 'core/video' ],\n\t\t\t\ttransform: ( attributes ) => {\n\t\t\t\t\treturn createBlock( 'core/file', {\n\t\t\t\t\t\thref: attributes.src,\n\t\t\t\t\t\tfileName: attributes.caption,\n\t\t\t\t\t\ttextLinkHref: attributes.src,\n\t\t\t\t\t\tid: attributes.id,\n\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'block',\n\t\t\t\tblocks: [ 'core/image' ],\n\t\t\t\ttransform: ( attributes ) => {\n\t\t\t\t\treturn createBlock( 'core/file', {\n\t\t\t\t\t\thref: attributes.url,\n\t\t\t\t\t\tfileName: attributes.caption,\n\t\t\t\t\t\ttextLinkHref: attributes.url,\n\t\t\t\t\t\tid: attributes.id,\n\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t\tto: [\n\t\t\t{\n\t\t\t\ttype: 'block',\n\t\t\t\tblocks: [ 'core/audio' ],\n\t\t\t\tisMatch: ( { id } ) => {\n\t\t\t\t\tif ( ! id ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tconst { getMedia } = select( 'core' );\n\t\t\t\t\tconst media = getMedia( id );\n\t\t\t\t\treturn !! media && includes( media.mime_type, 'audio' );\n\t\t\t\t},\n\t\t\t\ttransform: ( attributes ) => {\n\t\t\t\t\treturn createBlock( 'core/audio', {\n\t\t\t\t\t\tsrc: attributes.href,\n\t\t\t\t\t\tcaption: attributes.fileName,\n\t\t\t\t\t\tid: attributes.id,\n\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'block',\n\t\t\t\tblocks: [ 'core/video' ],\n\t\t\t\tisMatch: ( { id } ) => {\n\t\t\t\t\tif ( ! id ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tconst { getMedia } = select( 'core' );\n\t\t\t\t\tconst media = getMedia( id );\n\t\t\t\t\treturn !! media && includes( media.mime_type, 'video' );\n\t\t\t\t},\n\t\t\t\ttransform: ( attributes ) => {\n\t\t\t\t\treturn createBlock( 'core/video', {\n\t\t\t\t\t\tsrc: attributes.href,\n\t\t\t\t\t\tcaption: attributes.fileName,\n\t\t\t\t\t\tid: attributes.id,\n\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: 'block',\n\t\t\t\tblocks: [ 'core/image' ],\n\t\t\t\tisMatch: ( { id } ) => {\n\t\t\t\t\tif ( ! id ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tconst { getMedia } = select( 'core' );\n\t\t\t\t\tconst media = getMedia( id );\n\t\t\t\t\treturn !! media && includes( media.mime_type, 'image' );\n\t\t\t\t},\n\t\t\t\ttransform: ( attributes ) => {\n\t\t\t\t\treturn createBlock( 'core/image', {\n\t\t\t\t\t\turl: attributes.href,\n\t\t\t\t\t\tcaption: attributes.fileName,\n\t\t\t\t\t\tid: attributes.id,\n\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t},\n\n\tedit,\n\n\tsave( { attributes } ) {\n\t\tconst {\n\t\t\thref,\n\t\t\tfileName,\n\t\t\ttextLinkHref,\n\t\t\ttextLinkTarget,\n\t\t\tshowDownloadButton,\n\t\t\tdownloadButtonText,\n\t\t} = attributes;\n\n\t\treturn ( href &&\n\t\t\t<div>\n\t\t\t\t{ ! RichText.isEmpty( fileName ) &&\n\t\t\t\t\t<a\n\t\t\t\t\t\thref={ textLinkHref }\n\t\t\t\t\t\ttarget={ textLinkTarget }\n\t\t\t\t\t\trel={ textLinkTarget ? 'noreferrer noopener' : false }\n\t\t\t\t\t>\n\t\t\t\t\t\t<RichText.Content\n\t\t\t\t\t\t\tvalue={ fileName }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</a>\n\t\t\t\t}\n\t\t\t\t{ showDownloadButton &&\n\t\t\t\t\t<a\n\t\t\t\t\t\thref={ href }\n\t\t\t\t\t\tclassName=\"wp-block-file__button\"\n\t\t\t\t\t\tdownload={ true }\n\t\t\t\t\t>\n\t\t\t\t\t\t<RichText.Content\n\t\t\t\t\t\t\tvalue={ downloadButtonText }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</a>\n\t\t\t\t}\n\t\t\t</div>\n\t\t);\n\t},\n\n};\n"]}