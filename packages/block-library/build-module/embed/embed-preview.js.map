{"version":3,"sources":["@wordpress/block-library/src/embed/embed-preview.js"],"names":["HOSTS_NO_PREVIEWS","getPhotoHtml","parse","includes","classnames","__","sprintf","Placeholder","SandBox","RichText","BlockIcon","Component","WpEmbedPreview","EmbedPreview","arguments","hideOverlay","bind","state","interactive","setState","props","preview","url","type","caption","onCaptionChange","isSelected","className","icon","label","scripts","html","parsedHost","host","split","parsedHostBaseUrl","splice","length","join","cannotPreview","iframeTitle","sandboxClassnames","embedWrapper","isEmpty","nextProps"],"mappings":"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","sourcesContent":["/**\n * Internal dependencies\n */\nimport { HOSTS_NO_PREVIEWS } from './constants';\nimport { getPhotoHtml } from './util';\n\n/**\n * External dependencies\n */\nimport { parse } from 'url';\nimport { includes } from 'lodash';\nimport classnames from 'classnames/dedupe';\n\n/**\n * WordPress dependencies\n */\nimport { __, sprintf } from '@wordpress/i18n';\nimport { Placeholder, SandBox } from '@wordpress/components';\nimport { RichText, BlockIcon } from '@wordpress/block-editor';\nimport { Component } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport WpEmbedPreview from './wp-embed-preview';\n\nclass EmbedPreview extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.hideOverlay = this.hideOverlay.bind( this );\n\t\tthis.state = {\n\t\t\tinteractive: false,\n\t\t};\n\t}\n\n\tstatic getDerivedStateFromProps( nextProps, state ) {\n\t\tif ( ! nextProps.isSelected && state.interactive ) {\n\t\t\t// We only want to change this when the block is not selected, because changing it when\n\t\t\t// the block becomes selected makes the overlap disappear too early. Hiding the overlay\n\t\t\t// happens on mouseup when the overlay is clicked.\n\t\t\treturn { interactive: false };\n\t\t}\n\n\t\treturn null;\n\t}\n\n\thideOverlay() {\n\t\t// This is called onMouseUp on the overlay. We can't respond to the `isSelected` prop\n\t\t// changing, because that happens on mouse down, and the overlay immediately disappears,\n\t\t// and the mouse event can end up in the preview content. We can't use onClick on\n\t\t// the overlay to hide it either, because then the editor misses the mouseup event, and\n\t\t// thinks we're multi-selecting blocks.\n\t\tthis.setState( { interactive: true } );\n\t}\n\n\trender() {\n\t\tconst { preview, url, type, caption, onCaptionChange, isSelected, className, icon, label } = this.props;\n\t\tconst { scripts } = preview;\n\t\tconst { interactive } = this.state;\n\n\t\tconst html = 'photo' === type ? getPhotoHtml( preview ) : preview.html;\n\t\tconst parsedHost = parse( url ).host.split( '.' );\n\t\tconst parsedHostBaseUrl = parsedHost.splice( parsedHost.length - 2, parsedHost.length - 1 ).join( '.' );\n\t\tconst cannotPreview = includes( HOSTS_NO_PREVIEWS, parsedHostBaseUrl );\n\t\t// translators: %s: host providing embed content e.g: www.youtube.com\n\t\tconst iframeTitle = sprintf( __( 'Embedded content from %s' ), parsedHostBaseUrl );\n\t\tconst sandboxClassnames = classnames( type, className, 'wp-block-embed__wrapper' );\n\n\t\t// Disabled because the overlay div doesn't actually have a role or functionality\n\t\t// as far as the user is concerned. We're just catching the first click so that\n\t\t// the block can be selected without interacting with the embed preview that the overlay covers.\n\t\t/* eslint-disable jsx-a11y/no-noninteractive-element-interactions */\n\t\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\t\tconst embedWrapper = 'wp-embed' === type ? (\n\t\t\t<WpEmbedPreview\n\t\t\t\thtml={ html }\n\t\t\t/>\n\t\t) : (\n\t\t\t<div className=\"wp-block-embed__wrapper\">\n\t\t\t\t<SandBox\n\t\t\t\t\thtml={ html }\n\t\t\t\t\tscripts={ scripts }\n\t\t\t\t\ttitle={ iframeTitle }\n\t\t\t\t\ttype={ sandboxClassnames }\n\t\t\t\t\tonFocus={ this.hideOverlay }\n\t\t\t\t/>\n\t\t\t\t{ ! interactive && <div\n\t\t\t\t\tclassName=\"block-library-embed__interactive-overlay\"\n\t\t\t\t\tonMouseUp={ this.hideOverlay } /> }\n\t\t\t</div>\n\t\t);\n\t\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n\t\t/* eslint-enable jsx-a11y/no-noninteractive-element-interactions */\n\n\t\treturn (\n\t\t\t<figure className={ classnames( className, 'wp-block-embed', { 'is-type-video': 'video' === type } ) }>\n\t\t\t\t{ ( cannotPreview ) ? (\n\t\t\t\t\t<Placeholder icon={ <BlockIcon icon={ icon } showColors /> } label={ label }>\n\t\t\t\t\t\t<p className=\"components-placeholder__error\"><a href={ url }>{ url }</a></p>\n\t\t\t\t\t\t<p className=\"components-placeholder__error\">\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t/* translators: %s: host providing embed content e.g: www.youtube.com */\n\t\t\t\t\t\t\t\tsprintf( __( \"Embedded content from %s can't be previewed in the editor.\" ), parsedHostBaseUrl )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</Placeholder>\n\t\t\t\t) : embedWrapper }\n\t\t\t\t{ ( ! RichText.isEmpty( caption ) || isSelected ) && (\n\t\t\t\t\t<RichText\n\t\t\t\t\t\ttagName=\"figcaption\"\n\t\t\t\t\t\tplaceholder={ __( 'Write captionâ€¦' ) }\n\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\tonChange={ onCaptionChange }\n\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</figure>\n\t\t);\n\t}\n}\n\nexport default EmbedPreview;\n"]}