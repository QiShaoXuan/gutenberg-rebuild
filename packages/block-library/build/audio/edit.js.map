{"version":3,"sources":["@wordpress/block-library/src/audio/edit.js"],"names":["ALLOWED_MEDIA_TYPES","AudioEdit","arguments","state","editing","props","attributes","src","toggleAttribute","bind","onSelectURL","noticeOperations","setAttributes","id","file","filesList","onFileChange","mediaId","url","onError","e","undefined","setState","createErrorNotice","allowedTypes","attribute","newValue","newSrc","embedBlock","onReplace","autoplay","caption","loop","preload","isSelected","className","noticeUI","switchToEditing","onSelectAudio","media","icon","value","label","RichText","isEmpty","Component"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { getBlobByURL, isBlobURL } from '@wordpress/blob';\nimport {\n\tDisabled,\n\tIconButton,\n\tPanelBody,\n\tSelectControl,\n\tToggleControl,\n\tToolbar,\n\twithNotices,\n} from '@wordpress/components';\nimport {\n\tBlockControls,\n\tBlockIcon,\n\tInspectorControls,\n\tMediaPlaceholder,\n\tRichText,\n} from '@wordpress/block-editor';\nimport { mediaUpload } from '@wordpress/editor';\nimport { Component, Fragment } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport icon from './icon';\n\n/**\n * Internal dependencies\n */\nimport { createUpgradedEmbedBlock } from '../embed/util';\n\nconst ALLOWED_MEDIA_TYPES = [ 'audio' ];\n\nclass AudioEdit extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\t// edit component has its own src in the state so it can be edited\n\t\t// without setting the actual value outside of the edit UI\n\t\tthis.state = {\n\t\t\tediting: ! this.props.attributes.src,\n\t\t};\n\n\t\tthis.toggleAttribute = this.toggleAttribute.bind( this );\n\t\tthis.onSelectURL = this.onSelectURL.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes, noticeOperations, setAttributes } = this.props;\n\t\tconst { id, src = '' } = attributes;\n\n\t\tif ( ! id && isBlobURL( src ) ) {\n\t\t\tconst file = getBlobByURL( src );\n\n\t\t\tif ( file ) {\n\t\t\t\tmediaUpload( {\n\t\t\t\t\tfilesList: [ file ],\n\t\t\t\t\tonFileChange: ( [ { id: mediaId, url } ] ) => {\n\t\t\t\t\t\tsetAttributes( { id: mediaId, src: url } );\n\t\t\t\t\t},\n\t\t\t\t\tonError: ( e ) => {\n\t\t\t\t\t\tsetAttributes( { src: undefined, id: undefined } );\n\t\t\t\t\t\tthis.setState( { editing: true } );\n\t\t\t\t\t\tnoticeOperations.createErrorNotice( e );\n\t\t\t\t\t},\n\t\t\t\t\tallowedTypes: ALLOWED_MEDIA_TYPES,\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t}\n\n\ttoggleAttribute( attribute ) {\n\t\treturn ( newValue ) => {\n\t\t\tthis.props.setAttributes( { [ attribute ]: newValue } );\n\t\t};\n\t}\n\n\tonSelectURL( newSrc ) {\n\t\tconst { attributes, setAttributes } = this.props;\n\t\tconst { src } = attributes;\n\n\t\t// Set the block's src from the edit component's state, and switch off\n\t\t// the editing UI.\n\t\tif ( newSrc !== src ) {\n\t\t\t// Check if there's an embed block that handles this URL.\n\t\t\tconst embedBlock = createUpgradedEmbedBlock(\n\t\t\t\t{ attributes: { url: newSrc } }\n\t\t\t);\n\t\t\tif ( undefined !== embedBlock ) {\n\t\t\t\tthis.props.onReplace( embedBlock );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetAttributes( { src: newSrc, id: undefined } );\n\t\t}\n\n\t\tthis.setState( { editing: false } );\n\t}\n\n\trender() {\n\t\tconst { autoplay, caption, loop, preload, src } = this.props.attributes;\n\t\tconst { setAttributes, isSelected, className, noticeOperations, noticeUI } = this.props;\n\t\tconst { editing } = this.state;\n\t\tconst switchToEditing = () => {\n\t\t\tthis.setState( { editing: true } );\n\t\t};\n\t\tconst onSelectAudio = ( media ) => {\n\t\t\tif ( ! media || ! media.url ) {\n\t\t\t\t// in this case there was an error and we should continue in the editing state\n\t\t\t\t// previous attributes should be removed because they may be temporary blob urls\n\t\t\t\tsetAttributes( { src: undefined, id: undefined } );\n\t\t\t\tswitchToEditing();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// sets the block's attribute and updates the edit component from the\n\t\t\t// selected media, then switches off the editing UI\n\t\t\tsetAttributes( { src: media.url, id: media.id } );\n\t\t\tthis.setState( { src: media.url, editing: false } );\n\t\t};\n\t\tif ( editing ) {\n\t\t\treturn (\n\t\t\t\t<MediaPlaceholder\n\t\t\t\t\ticon={ <BlockIcon icon={ icon } /> }\n\t\t\t\t\tclassName={ className }\n\t\t\t\t\tonSelect={ onSelectAudio }\n\t\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\t\taccept=\"audio/*\"\n\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\tvalue={ this.props.attributes }\n\t\t\t\t\tnotices={ noticeUI }\n\t\t\t\t\tonError={ noticeOperations.createErrorNotice }\n\t\t\t\t/>\n\t\t\t);\n\t\t}\n\n\t\t/* eslint-disable jsx-a11y/no-static-element-interactions, jsx-a11y/onclick-has-role, jsx-a11y/click-events-have-key-events */\n\t\treturn (\n\t\t\t<Fragment>\n\t\t\t\t<BlockControls>\n\t\t\t\t\t<Toolbar>\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tclassName=\"components-icon-button components-toolbar__control\"\n\t\t\t\t\t\t\tlabel={ __( 'Edit audio' ) }\n\t\t\t\t\t\t\tonClick={ switchToEditing }\n\t\t\t\t\t\t\ticon=\"edit\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Toolbar>\n\t\t\t\t</BlockControls>\n\t\t\t\t<InspectorControls>\n\t\t\t\t\t<PanelBody title={ __( 'Audio Settings' ) }>\n\t\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\t\tlabel={ __( 'Autoplay' ) }\n\t\t\t\t\t\t\tonChange={ this.toggleAttribute( 'autoplay' ) }\n\t\t\t\t\t\t\tchecked={ autoplay }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\t\tlabel={ __( 'Loop' ) }\n\t\t\t\t\t\t\tonChange={ this.toggleAttribute( 'loop' ) }\n\t\t\t\t\t\t\tchecked={ loop }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t\tlabel={ __( 'Preload' ) }\n\t\t\t\t\t\t\tvalue={ undefined !== preload ? preload : 'none' }\n\t\t\t\t\t\t\t// `undefined` is required for the preload attribute to be unset.\n\t\t\t\t\t\t\tonChange={ ( value ) => setAttributes( { preload: ( 'none' !== value ) ? value : undefined } ) }\n\t\t\t\t\t\t\toptions={ [\n\t\t\t\t\t\t\t\t{ value: 'auto', label: __( 'Auto' ) },\n\t\t\t\t\t\t\t\t{ value: 'metadata', label: __( 'Metadata' ) },\n\t\t\t\t\t\t\t\t{ value: 'none', label: __( 'None' ) },\n\t\t\t\t\t\t\t] }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</PanelBody>\n\t\t\t\t</InspectorControls>\n\t\t\t\t<figure className={ className }>\n\t\t\t\t\t{ /*\n\t\t\t\t\t\tDisable the audio tag so the user clicking on it won't play the\n\t\t\t\t\t\tfile or change the position slider when the controls are enabled.\n\t\t\t\t\t*/ }\n\t\t\t\t\t<Disabled>\n\t\t\t\t\t\t<audio controls=\"controls\" src={ src } />\n\t\t\t\t\t</Disabled>\n\t\t\t\t\t{ ( ! RichText.isEmpty( caption ) || isSelected ) && (\n\t\t\t\t\t\t<RichText\n\t\t\t\t\t\t\ttagName=\"figcaption\"\n\t\t\t\t\t\t\tplaceholder={ __( 'Write caption…' ) }\n\t\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\t\tonChange={ ( value ) => setAttributes( { caption: value } ) }\n\t\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</figure>\n\t\t\t</Fragment>\n\t\t);\n\t\t/* eslint-enable jsx-a11y/no-static-element-interactions, jsx-a11y/onclick-has-role, jsx-a11y/click-events-have-key-events */\n\t}\n}\n\nexport default withNotices( AudioEdit );\n"]}