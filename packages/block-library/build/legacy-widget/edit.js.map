{"version":3,"sources":["@wordpress/block-library/src/legacy-widget/edit.js"],"names":["LegacyWidgetEdit","arguments","state","isPreview","switchToEdit","bind","switchToPreview","changeWidget","props","attributes","availableLegacyWidgets","hasPermissionsToManageWidgets","setAttributes","identifier","isCallbackWidget","widgetObject","placeholderContent","length","value","instance","label","concat","widget","key","name","inspectorControls","description","renderWidgetPreview","newInstance","undefined","setState","Component","select","editorSettings","getSettings"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { map } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component, Fragment } from '@wordpress/element';\nimport {\n\tButton,\n\tIconButton,\n\tPanelBody,\n\tPlaceholder,\n\tSelectControl,\n\tToolbar,\n} from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { withSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport {\n\tBlockControls,\n\tBlockIcon,\n\tInspectorControls,\n\tServerSideRender,\n} from '@wordpress/editor';\n\nimport WidgetEditHandler from './WidgetEditHandler';\n\nclass LegacyWidgetEdit extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.state = {\n\t\t\tisPreview: false,\n\t\t};\n\t\tthis.switchToEdit = this.switchToEdit.bind( this );\n\t\tthis.switchToPreview = this.switchToPreview.bind( this );\n\t\tthis.changeWidget = this.changeWidget.bind( this );\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tattributes,\n\t\t\tavailableLegacyWidgets,\n\t\t\thasPermissionsToManageWidgets,\n\t\t\tsetAttributes,\n\t\t} = this.props;\n\t\tconst { isPreview } = this.state;\n\t\tconst { identifier, isCallbackWidget } = attributes;\n\t\tconst widgetObject = identifier && availableLegacyWidgets[ identifier ];\n\t\tif ( ! widgetObject ) {\n\t\t\tlet placeholderContent;\n\n\t\t\tif ( ! hasPermissionsToManageWidgets ) {\n\t\t\t\tplaceholderContent = __( 'You don\\'t have permissions to use widgets on this site.' );\n\t\t\t} else if ( availableLegacyWidgets.length === 0 ) {\n\t\t\t\tplaceholderContent = __( 'There are no widgets available.' );\n\t\t\t} else {\n\t\t\t\tplaceholderContent = (\n\t\t\t\t\t<SelectControl\n\t\t\t\t\t\tlabel={ __( 'Select a legacy widget to display:' ) }\n\t\t\t\t\t\tvalue={ identifier || 'none' }\n\t\t\t\t\t\tonChange={ ( value ) => setAttributes( {\n\t\t\t\t\t\t\tinstance: {},\n\t\t\t\t\t\t\tidentifier: value,\n\t\t\t\t\t\t\tisCallbackWidget: availableLegacyWidgets[ value ].isCallbackWidget,\n\t\t\t\t\t\t} ) }\n\t\t\t\t\t\toptions={ [ { value: 'none', label: 'Select widget' } ].concat(\n\t\t\t\t\t\t\tmap( availableLegacyWidgets, ( widget, key ) => {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tvalue: key,\n\t\t\t\t\t\t\t\t\tlabel: widget.name,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t) }\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn (\n\t\t\t\t<Placeholder\n\t\t\t\t\ticon={ <BlockIcon icon=\"admin-customizer\" /> }\n\t\t\t\t\tlabel={ __( 'Legacy Widget' ) }\n\t\t\t\t>\n\t\t\t\t\t{ placeholderContent }\n\t\t\t\t</Placeholder>\n\t\t\t);\n\t\t}\n\n\t\tconst inspectorControls = (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ widgetObject.name }>\n\t\t\t\t\t{ widgetObject.description }\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t);\n\t\tif ( ! hasPermissionsToManageWidgets ) {\n\t\t\treturn (\n\t\t\t\t<Fragment>\n\t\t\t\t\t{ inspectorControls }\n\t\t\t\t\t{ this.renderWidgetPreview() }\n\t\t\t\t</Fragment>\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\t<Fragment>\n\t\t\t\t<BlockControls>\n\t\t\t\t\t<Toolbar>\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tonClick={ this.changeWidget }\n\t\t\t\t\t\t\tlabel={ __( 'Change widget' ) }\n\t\t\t\t\t\t\ticon=\"update\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</IconButton>\n\t\t\t\t\t\t{ ! isCallbackWidget && (\n\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName={ `components-tab-button ${ ! isPreview ? 'is-active' : '' }` }\n\t\t\t\t\t\t\t\t\tonClick={ this.switchToEdit }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<span>{ __( 'Edit' ) }</span>\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName={ `components-tab-button ${ isPreview ? 'is-active' : '' }` }\n\t\t\t\t\t\t\t\t\tonClick={ this.switchToPreview }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<span>{ __( 'Preview' ) }</span>\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</Toolbar>\n\t\t\t\t</BlockControls>\n\t\t\t\t{ inspectorControls }\n\t\t\t\t{ ! isCallbackWidget && (\n\t\t\t\t\t<WidgetEditHandler\n\t\t\t\t\t\tisVisible={ ! isPreview }\n\t\t\t\t\t\tidentifier={ attributes.identifier }\n\t\t\t\t\t\tinstance={ attributes.instance }\n\t\t\t\t\t\tonInstanceChange={\n\t\t\t\t\t\t\t( newInstance ) => {\n\t\t\t\t\t\t\t\tthis.props.setAttributes( {\n\t\t\t\t\t\t\t\t\tinstance: newInstance,\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t{ ( isPreview || isCallbackWidget ) && this.renderWidgetPreview() }\n\t\t\t</Fragment>\n\t\t);\n\t}\n\n\tchangeWidget() {\n\t\tthis.switchToEdit();\n\t\tthis.props.setAttributes( {\n\t\t\tinstance: {},\n\t\t\tidentifier: undefined,\n\t\t} );\n\t}\n\n\tswitchToEdit() {\n\t\tthis.setState( { isPreview: false } );\n\t}\n\n\tswitchToPreview() {\n\t\tthis.setState( { isPreview: true } );\n\t}\n\n\trenderWidgetPreview() {\n\t\tconst { attributes } = this.props;\n\t\treturn (\n\t\t\t<ServerSideRender\n\t\t\t\tclassName=\"wp-block-legacy-widget__preview\"\n\t\t\t\tblock=\"core/legacy-widget\"\n\t\t\t\tattributes={ attributes }\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default withSelect( ( select ) => {\n\tconst editorSettings = select( 'core/block-editor' ).getSettings();\n\tconst {\n\t\tavailableLegacyWidgets,\n\t\thasPermissionsToManageWidgets,\n\t} = editorSettings;\n\treturn {\n\t\thasPermissionsToManageWidgets,\n\t\tavailableLegacyWidgets,\n\t};\n} )( LegacyWidgetEdit );\n"]}