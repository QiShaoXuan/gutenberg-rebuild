{"version":3,"sources":["@wordpress/block-library/src/gallery/gallery-image.js"],"names":["GalleryImage","arguments","onImageClick","bind","onSelectCaption","onKeyDown","bindContainer","state","captionSelected","ref","container","setState","props","isSelected","onSelect","event","document","activeElement","BACKSPACE","DELETE","indexOf","keyCode","stopPropagation","preventDefault","onRemove","prevProps","image","url","setAttributes","source_url","alt","alt_text","id","linkTo","link","caption","ariaLabel","href","img","className","RichText","isEmpty","newCaption","Component","select","ownProps","getMedia"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { Component, Fragment } from '@wordpress/element';\nimport { IconButton, Spinner } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { BACKSPACE, DELETE } from '@wordpress/keycodes';\nimport { withSelect } from '@wordpress/data';\nimport { RichText } from '@wordpress/block-editor';\nimport { isBlobURL } from '@wordpress/blob';\n\nclass GalleryImage extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onImageClick = this.onImageClick.bind( this );\n\t\tthis.onSelectCaption = this.onSelectCaption.bind( this );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.bindContainer = this.bindContainer.bind( this );\n\n\t\tthis.state = {\n\t\t\tcaptionSelected: false,\n\t\t};\n\t}\n\n\tbindContainer( ref ) {\n\t\tthis.container = ref;\n\t}\n\n\tonSelectCaption() {\n\t\tif ( ! this.state.captionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: true,\n\t\t\t} );\n\t\t}\n\n\t\tif ( ! this.props.isSelected ) {\n\t\t\tthis.props.onSelect();\n\t\t}\n\t}\n\n\tonImageClick() {\n\t\tif ( ! this.props.isSelected ) {\n\t\t\tthis.props.onSelect();\n\t\t}\n\n\t\tif ( this.state.captionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonKeyDown( event ) {\n\t\tif (\n\t\t\tthis.container === document.activeElement &&\n\t\t\tthis.props.isSelected && [ BACKSPACE, DELETE ].indexOf( event.keyCode ) !== -1\n\t\t) {\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\t\t\tthis.props.onRemove();\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { isSelected, image, url } = this.props;\n\t\tif ( image && ! url ) {\n\t\t\tthis.props.setAttributes( {\n\t\t\t\turl: image.source_url,\n\t\t\t\talt: image.alt_text,\n\t\t\t} );\n\t\t}\n\n\t\t// unselect the caption so when the user selects other image and comeback\n\t\t// the caption is not immediately selected\n\t\tif ( this.state.captionSelected && ! isSelected && prevProps.isSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst { url, alt, id, linkTo, link, isSelected, caption, onRemove, setAttributes, 'aria-label': ariaLabel } = this.props;\n\n\t\tlet href;\n\n\t\tswitch ( linkTo ) {\n\t\t\tcase 'media':\n\t\t\t\thref = url;\n\t\t\t\tbreak;\n\t\t\tcase 'attachment':\n\t\t\t\thref = link;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tconst img = (\n\t\t\t// Disable reason: Image itself is not meant to be interactive, but should\n\t\t\t// direct image selection and unfocus caption fields.\n\t\t\t/* eslint-disable jsx-a11y/no-noninteractive-element-interactions */\n\t\t\t<Fragment>\n\t\t\t\t<img\n\t\t\t\t\tsrc={ url }\n\t\t\t\t\talt={ alt }\n\t\t\t\t\tdata-id={ id }\n\t\t\t\t\tonClick={ this.onImageClick }\n\t\t\t\t\ttabIndex=\"0\"\n\t\t\t\t\tonKeyDown={ this.onImageClick }\n\t\t\t\t\taria-label={ ariaLabel }\n\t\t\t\t/>\n\t\t\t\t{ isBlobURL( url ) && <Spinner /> }\n\t\t\t</Fragment>\n\t\t\t/* eslint-enable jsx-a11y/no-noninteractive-element-interactions */\n\t\t);\n\n\t\tconst className = classnames( {\n\t\t\t'is-selected': isSelected,\n\t\t\t'is-transient': isBlobURL( url ),\n\t\t} );\n\n\t\t// Disable reason: Each block can be selected by clicking on it and we should keep the same saved markup\n\t\t/* eslint-disable jsx-a11y/no-noninteractive-element-interactions, jsx-a11y/onclick-has-role, jsx-a11y/click-events-have-key-events */\n\t\treturn (\n\t\t\t<figure className={ className } tabIndex=\"-1\" onKeyDown={ this.onKeyDown } ref={ this.bindContainer }>\n\t\t\t\t{ isSelected &&\n\t\t\t\t\t<div className=\"block-library-gallery-item__inline-menu\">\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\ticon=\"no-alt\"\n\t\t\t\t\t\t\tonClick={ onRemove }\n\t\t\t\t\t\t\tclassName=\"blocks-gallery-item__remove\"\n\t\t\t\t\t\t\tlabel={ __( 'Remove Image' ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t}\n\t\t\t\t{ href ? <a href={ href }>{ img }</a> : img }\n\t\t\t\t{ ( ! RichText.isEmpty( caption ) || isSelected ) ? (\n\t\t\t\t\t<RichText\n\t\t\t\t\t\ttagName=\"figcaption\"\n\t\t\t\t\t\tplaceholder={ __( 'Write captionâ€¦' ) }\n\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\tisSelected={ this.state.captionSelected }\n\t\t\t\t\t\tonChange={ ( newCaption ) => setAttributes( { caption: newCaption } ) }\n\t\t\t\t\t\tunstableOnFocus={ this.onSelectCaption }\n\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t/>\n\t\t\t\t) : null }\n\t\t\t</figure>\n\t\t);\n\t\t/* eslint-enable jsx-a11y/no-noninteractive-element-interactions, jsx-a11y/onclick-has-role, jsx-a11y/click-events-have-key-events */\n\t}\n}\n\nexport default withSelect( ( select, ownProps ) => {\n\tconst { getMedia } = select( 'core' );\n\tconst { id } = ownProps;\n\n\treturn {\n\t\timage: id ? getMedia( id ) : null,\n\t};\n} )( GalleryImage );\n"]}