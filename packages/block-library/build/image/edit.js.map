{"version":3,"sources":["@wordpress/block-library/src/image/edit.js"],"names":["MIN_SIZE","LINK_DESTINATION_NONE","LINK_DESTINATION_MEDIA","LINK_DESTINATION_ATTACHMENT","LINK_DESTINATION_CUSTOM","NEW_TAB_REL","ALLOWED_MEDIA_TYPES","pickRelevantMediaFiles","image","imageProps","url","isTemporaryImage","id","isExternalImage","ImageEdit","attributes","arguments","updateAlt","bind","updateAlignment","onFocusCaption","onImageClick","onSelectImage","onSelectURL","updateImageURL","updateWidth","updateHeight","updateDimensions","onSetCustomHref","onSetLinkClass","onSetLinkRel","onSetLinkDestination","onSetNewTab","getFilename","toggleIsEditing","onUploadError","onImageError","state","captionFocused","isEditing","props","setAttributes","noticeOperations","file","filesList","onFileChange","allowedTypes","onError","message","createErrorNotice","setState","prevProps","prevID","prevURL","isSelected","media","undefined","alt","caption","width","height","value","href","source_url","link","linkDestination","newURL","embedBlock","onReplace","linkClass","rel","linkTarget","updatedRel","newAlt","nextAlign","extraUpdatedAttributes","indexOf","align","parseInt","path","split","label","imageSizes","name","slug","sizeUrl","isLargeViewport","className","maxWidth","noticeUI","toggleSelection","isRTL","isExternal","toolbarEditButton","open","controls","src","icon","classes","isResizable","isLinkURLInputReadOnly","imageSizeOptions","getImageSizeOptions","getInspectorControls","imageWidth","imageHeight","map","scale","scaledWidth","Math","round","scaledHeight","isCurrent","getLinkDestinationOptions","sizes","imageWidthWithinContainer","imageHeightWithinContainer","filename","defaultedAlt","img","currentWidth","currentHeight","ratio","minWidth","minHeight","maxWidthBuffer","showRightHandle","showLeftHandle","top","right","bottom","left","event","direction","elt","delta","RichText","isEmpty","Component","select","getMedia","getSettings","withNotices"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport {\n\tcompact,\n\tget,\n\tisEmpty,\n\tmap,\n\tlast,\n\tpick,\n} from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { getBlobByURL, isBlobURL, revokeBlobURL } from '@wordpress/blob';\nimport {\n\tButton,\n\tButtonGroup,\n\tIconButton,\n\tPanelBody,\n\tResizableBox,\n\tSelectControl,\n\tSpinner,\n\tTextareaControl,\n\tTextControl,\n\tToggleControl,\n\tToolbar,\n\twithNotices,\n\tExternalLink,\n} from '@wordpress/components';\nimport { compose } from '@wordpress/compose';\nimport { withSelect } from '@wordpress/data';\nimport {\n\tBlockAlignmentToolbar,\n\tBlockControls,\n\tBlockIcon,\n\tInspectorControls,\n\tMediaPlaceholder,\n\tMediaUpload,\n\tMediaUploadCheck,\n\tRichText,\n} from '@wordpress/block-editor';\nimport { mediaUpload } from '@wordpress/editor';\nimport { Component, Fragment } from '@wordpress/element';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { getPath } from '@wordpress/url';\nimport { withViewportMatch } from '@wordpress/viewport';\n\n/**\n * Internal dependencies\n */\nimport { createUpgradedEmbedBlock } from '../embed/util';\nimport icon from './icon';\nimport ImageSize from './image-size';\n\n/**\n * Module constants\n */\nconst MIN_SIZE = 20;\nconst LINK_DESTINATION_NONE = 'none';\nconst LINK_DESTINATION_MEDIA = 'media';\nconst LINK_DESTINATION_ATTACHMENT = 'attachment';\nconst LINK_DESTINATION_CUSTOM = 'custom';\nconst NEW_TAB_REL = 'noreferrer noopener';\nconst ALLOWED_MEDIA_TYPES = [ 'image' ];\n\nexport const pickRelevantMediaFiles = ( image ) => {\n\tconst imageProps = pick( image, [ 'alt', 'id', 'link', 'caption' ] );\n\timageProps.url = get( image, [ 'sizes', 'large', 'url' ] ) || get( image, [ 'media_details', 'sizes', 'large', 'source_url' ] ) || image.url;\n\treturn imageProps;\n};\n\n/**\n * Is the URL a temporary blob URL? A blob URL is one that is used temporarily\n * while the image is being uploaded and will not have an id yet allocated.\n *\n * @param {number=} id The id of the image.\n * @param {string=} url The url of the image.\n *\n * @return {boolean} Is the URL a Blob URL\n */\nconst isTemporaryImage = ( id, url ) => ! id && isBlobURL( url );\n\n/**\n * Is the url for the image hosted externally. An externally hosted image has no id\n * and is not a blob url.\n *\n * @param {number=} id  The id of the image.\n * @param {string=} url The url of the image.\n *\n * @return {boolean} Is the url an externally hosted url?\n */\nconst isExternalImage = ( id, url ) => url && ! id && ! isBlobURL( url );\n\nclass ImageEdit extends Component {\n\tconstructor( { attributes } ) {\n\t\tsuper( ...arguments );\n\t\tthis.updateAlt = this.updateAlt.bind( this );\n\t\tthis.updateAlignment = this.updateAlignment.bind( this );\n\t\tthis.onFocusCaption = this.onFocusCaption.bind( this );\n\t\tthis.onImageClick = this.onImageClick.bind( this );\n\t\tthis.onSelectImage = this.onSelectImage.bind( this );\n\t\tthis.onSelectURL = this.onSelectURL.bind( this );\n\t\tthis.updateImageURL = this.updateImageURL.bind( this );\n\t\tthis.updateWidth = this.updateWidth.bind( this );\n\t\tthis.updateHeight = this.updateHeight.bind( this );\n\t\tthis.updateDimensions = this.updateDimensions.bind( this );\n\t\tthis.onSetCustomHref = this.onSetCustomHref.bind( this );\n\t\tthis.onSetLinkClass = this.onSetLinkClass.bind( this );\n\t\tthis.onSetLinkRel = this.onSetLinkRel.bind( this );\n\t\tthis.onSetLinkDestination = this.onSetLinkDestination.bind( this );\n\t\tthis.onSetNewTab = this.onSetNewTab.bind( this );\n\t\tthis.getFilename = this.getFilename.bind( this );\n\t\tthis.toggleIsEditing = this.toggleIsEditing.bind( this );\n\t\tthis.onUploadError = this.onUploadError.bind( this );\n\t\tthis.onImageError = this.onImageError.bind( this );\n\n\t\tthis.state = {\n\t\t\tcaptionFocused: false,\n\t\t\tisEditing: ! attributes.url,\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes, setAttributes, noticeOperations } = this.props;\n\t\tconst { id, url = '' } = attributes;\n\n\t\tif ( isTemporaryImage( id, url ) ) {\n\t\t\tconst file = getBlobByURL( url );\n\n\t\t\tif ( file ) {\n\t\t\t\tmediaUpload( {\n\t\t\t\t\tfilesList: [ file ],\n\t\t\t\t\tonFileChange: ( [ image ] ) => {\n\t\t\t\t\t\tsetAttributes( pickRelevantMediaFiles( image ) );\n\t\t\t\t\t},\n\t\t\t\t\tallowedTypes: ALLOWED_MEDIA_TYPES,\n\t\t\t\t\tonError: ( message ) => {\n\t\t\t\t\t\tnoticeOperations.createErrorNotice( message );\n\t\t\t\t\t\tthis.setState( { isEditing: true } );\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { id: prevID, url: prevURL = '' } = prevProps.attributes;\n\t\tconst { id, url = '' } = this.props.attributes;\n\n\t\tif ( isTemporaryImage( prevID, prevURL ) && ! isTemporaryImage( id, url ) ) {\n\t\t\trevokeBlobURL( url );\n\t\t}\n\n\t\tif ( ! this.props.isSelected && prevProps.isSelected && this.state.captionFocused ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionFocused: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonUploadError( message ) {\n\t\tconst { noticeOperations } = this.props;\n\t\tnoticeOperations.createErrorNotice( message );\n\t\tthis.setState( {\n\t\t\tisEditing: true,\n\t\t} );\n\t}\n\n\tonSelectImage( media ) {\n\t\tif ( ! media || ! media.url ) {\n\t\t\tthis.props.setAttributes( {\n\t\t\t\turl: undefined,\n\t\t\t\talt: undefined,\n\t\t\t\tid: undefined,\n\t\t\t\tcaption: undefined,\n\t\t\t} );\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tisEditing: false,\n\t\t} );\n\n\t\tthis.props.setAttributes( {\n\t\t\t...pickRelevantMediaFiles( media ),\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t} );\n\t}\n\n\tonSetLinkDestination( value ) {\n\t\tlet href;\n\n\t\tif ( value === LINK_DESTINATION_NONE ) {\n\t\t\thref = undefined;\n\t\t} else if ( value === LINK_DESTINATION_MEDIA ) {\n\t\t\thref = ( this.props.image && this.props.image.source_url ) || this.props.attributes.url;\n\t\t} else if ( value === LINK_DESTINATION_ATTACHMENT ) {\n\t\t\thref = this.props.image && this.props.image.link;\n\t\t} else {\n\t\t\thref = this.props.attributes.href;\n\t\t}\n\n\t\tthis.props.setAttributes( {\n\t\t\tlinkDestination: value,\n\t\t\thref,\n\t\t} );\n\t}\n\n\tonSelectURL( newURL ) {\n\t\tconst { url } = this.props.attributes;\n\n\t\tif ( newURL !== url ) {\n\t\t\tthis.props.setAttributes( {\n\t\t\t\turl: newURL,\n\t\t\t\tid: undefined,\n\t\t\t} );\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tisEditing: false,\n\t\t} );\n\t}\n\n\tonImageError( url ) {\n\t\t// Check if there's an embed block that handles this URL.\n\t\tconst embedBlock = createUpgradedEmbedBlock(\n\t\t\t{ attributes: { url } }\n\t\t);\n\t\tif ( undefined !== embedBlock ) {\n\t\t\tthis.props.onReplace( embedBlock );\n\t\t}\n\t}\n\n\tonSetCustomHref( value ) {\n\t\tthis.props.setAttributes( { href: value } );\n\t}\n\n\tonSetLinkClass( value ) {\n\t\tthis.props.setAttributes( { linkClass: value } );\n\t}\n\n\tonSetLinkRel( value ) {\n\t\tthis.props.setAttributes( { rel: value } );\n\t}\n\n\tonSetNewTab( value ) {\n\t\tconst { rel } = this.props.attributes;\n\t\tconst linkTarget = value ? '_blank' : undefined;\n\n\t\tlet updatedRel = rel;\n\t\tif ( linkTarget && ! rel ) {\n\t\t\tupdatedRel = NEW_TAB_REL;\n\t\t} else if ( ! linkTarget && rel === NEW_TAB_REL ) {\n\t\t\tupdatedRel = undefined;\n\t\t}\n\n\t\tthis.props.setAttributes( {\n\t\t\tlinkTarget,\n\t\t\trel: updatedRel,\n\t\t} );\n\t}\n\n\tonFocusCaption() {\n\t\tif ( ! this.state.captionFocused ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionFocused: true,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonImageClick() {\n\t\tif ( this.state.captionFocused ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionFocused: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tupdateAlt( newAlt ) {\n\t\tthis.props.setAttributes( { alt: newAlt } );\n\t}\n\n\tupdateAlignment( nextAlign ) {\n\t\tconst extraUpdatedAttributes = [ 'wide', 'full' ].indexOf( nextAlign ) !== -1 ?\n\t\t\t{ width: undefined, height: undefined } :\n\t\t\t{};\n\t\tthis.props.setAttributes( { ...extraUpdatedAttributes, align: nextAlign } );\n\t}\n\n\tupdateImageURL( url ) {\n\t\tthis.props.setAttributes( { url, width: undefined, height: undefined } );\n\t}\n\n\tupdateWidth( width ) {\n\t\tthis.props.setAttributes( { width: parseInt( width, 10 ) } );\n\t}\n\n\tupdateHeight( height ) {\n\t\tthis.props.setAttributes( { height: parseInt( height, 10 ) } );\n\t}\n\n\tupdateDimensions( width = undefined, height = undefined ) {\n\t\treturn () => {\n\t\t\tthis.props.setAttributes( { width, height } );\n\t\t};\n\t}\n\n\tgetFilename( url ) {\n\t\tconst path = getPath( url );\n\t\tif ( path ) {\n\t\t\treturn last( path.split( '/' ) );\n\t\t}\n\t}\n\n\tgetLinkDestinationOptions() {\n\t\treturn [\n\t\t\t{ value: LINK_DESTINATION_NONE, label: __( 'None' ) },\n\t\t\t{ value: LINK_DESTINATION_MEDIA, label: __( 'Media File' ) },\n\t\t\t{ value: LINK_DESTINATION_ATTACHMENT, label: __( 'Attachment Page' ) },\n\t\t\t{ value: LINK_DESTINATION_CUSTOM, label: __( 'Custom URL' ) },\n\t\t];\n\t}\n\n\ttoggleIsEditing() {\n\t\tthis.setState( {\n\t\t\tisEditing: ! this.state.isEditing,\n\t\t} );\n\t}\n\n\tgetImageSizeOptions() {\n\t\tconst { imageSizes, image } = this.props;\n\t\treturn compact( map( imageSizes, ( { name, slug } ) => {\n\t\t\tconst sizeUrl = get( image, [ 'media_details', 'sizes', slug, 'source_url' ] );\n\t\t\tif ( ! sizeUrl ) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tvalue: sizeUrl,\n\t\t\t\tlabel: name,\n\t\t\t};\n\t\t} ) );\n\t}\n\n\trender() {\n\t\tconst { isEditing } = this.state;\n\t\tconst {\n\t\t\tattributes,\n\t\t\tsetAttributes,\n\t\t\tisLargeViewport,\n\t\t\tisSelected,\n\t\t\tclassName,\n\t\t\tmaxWidth,\n\t\t\tnoticeUI,\n\t\t\ttoggleSelection,\n\t\t\tisRTL,\n\t\t} = this.props;\n\t\tconst {\n\t\t\turl,\n\t\t\talt,\n\t\t\tcaption,\n\t\t\talign,\n\t\t\tid,\n\t\t\thref,\n\t\t\trel,\n\t\t\tlinkClass,\n\t\t\tlinkDestination,\n\t\t\twidth,\n\t\t\theight,\n\t\t\tlinkTarget,\n\t\t} = attributes;\n\t\tconst isExternal = isExternalImage( id, url );\n\n\t\tlet toolbarEditButton;\n\t\tif ( url ) {\n\t\t\tif ( isExternal ) {\n\t\t\t\ttoolbarEditButton = (\n\t\t\t\t\t<Toolbar>\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tclassName=\"components-icon-button components-toolbar__control\"\n\t\t\t\t\t\t\tlabel={ __( 'Edit image' ) }\n\t\t\t\t\t\t\tonClick={ this.toggleIsEditing }\n\t\t\t\t\t\t\ticon=\"edit\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Toolbar>\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\ttoolbarEditButton = (\n\t\t\t\t\t<MediaUploadCheck>\n\t\t\t\t\t\t<Toolbar>\n\t\t\t\t\t\t\t<MediaUpload\n\t\t\t\t\t\t\t\tonSelect={ this.onSelectImage }\n\t\t\t\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\t\t\t\tvalue={ id }\n\t\t\t\t\t\t\t\trender={ ( { open } ) => (\n\t\t\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\t\t\tclassName=\"components-toolbar__control\"\n\t\t\t\t\t\t\t\t\t\tlabel={ __( 'Edit image' ) }\n\t\t\t\t\t\t\t\t\t\ticon=\"edit\"\n\t\t\t\t\t\t\t\t\t\tonClick={ open }\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Toolbar>\n\t\t\t\t\t</MediaUploadCheck>\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tconst controls = (\n\t\t\t<BlockControls>\n\t\t\t\t<BlockAlignmentToolbar\n\t\t\t\t\tvalue={ align }\n\t\t\t\t\tonChange={ this.updateAlignment }\n\t\t\t\t/>\n\t\t\t\t{ toolbarEditButton }\n\t\t\t</BlockControls>\n\t\t);\n\n\t\tif ( isEditing || ! url ) {\n\t\t\tconst src = isExternal ? url : undefined;\n\t\t\treturn (\n\t\t\t\t<Fragment>\n\t\t\t\t\t{ controls }\n\t\t\t\t\t<MediaPlaceholder\n\t\t\t\t\t\ticon={ <BlockIcon icon={ icon } /> }\n\t\t\t\t\t\tclassName={ className }\n\t\t\t\t\t\tonSelect={ this.onSelectImage }\n\t\t\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\t\t\tnotices={ noticeUI }\n\t\t\t\t\t\tonError={ this.onUploadError }\n\t\t\t\t\t\taccept=\"image/*\"\n\t\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\t\tvalue={ { id, src } }\n\t\t\t\t\t/>\n\t\t\t\t</Fragment>\n\t\t\t);\n\t\t}\n\n\t\tconst classes = classnames( className, {\n\t\t\t'is-transient': isBlobURL( url ),\n\t\t\t'is-resized': !! width || !! height,\n\t\t\t'is-focused': isSelected,\n\t\t} );\n\n\t\tconst isResizable = [ 'wide', 'full' ].indexOf( align ) === -1 && isLargeViewport;\n\t\tconst isLinkURLInputReadOnly = linkDestination !== LINK_DESTINATION_CUSTOM;\n\t\tconst imageSizeOptions = this.getImageSizeOptions();\n\n\t\tconst getInspectorControls = ( imageWidth, imageHeight ) => (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Image Settings' ) }>\n\t\t\t\t\t<TextareaControl\n\t\t\t\t\t\tlabel={ __( 'Alt Text (Alternative Text)' ) }\n\t\t\t\t\t\tvalue={ alt }\n\t\t\t\t\t\tonChange={ this.updateAlt }\n\t\t\t\t\t\thelp={\n\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t<ExternalLink href=\"https://www.w3.org/WAI/tutorials/images/decision-tree\">\n\t\t\t\t\t\t\t\t\t{ __( 'Describe the purpose of the image' ) }\n\t\t\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\t\t\t{ __( 'Leave empty if the image is purely decorative.' ) }\n\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t\t{ ! isEmpty( imageSizeOptions ) && (\n\t\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t\tlabel={ __( 'Image Size' ) }\n\t\t\t\t\t\t\tvalue={ url }\n\t\t\t\t\t\t\toptions={ imageSizeOptions }\n\t\t\t\t\t\t\tonChange={ this.updateImageURL }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ isResizable && (\n\t\t\t\t\t\t<div className=\"block-library-image__dimensions\">\n\t\t\t\t\t\t\t<p className=\"block-library-image__dimensions__row\">\n\t\t\t\t\t\t\t\t{ __( 'Image Dimensions' ) }\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<div className=\"block-library-image__dimensions__row\">\n\t\t\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tclassName=\"block-library-image__dimensions__width\"\n\t\t\t\t\t\t\t\t\tlabel={ __( 'Width' ) }\n\t\t\t\t\t\t\t\t\tvalue={ width !== undefined ? width : imageWidth }\n\t\t\t\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\t\t\t\tonChange={ this.updateWidth }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tclassName=\"block-library-image__dimensions__height\"\n\t\t\t\t\t\t\t\t\tlabel={ __( 'Height' ) }\n\t\t\t\t\t\t\t\t\tvalue={ height !== undefined ? height : imageHeight }\n\t\t\t\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\t\t\t\tonChange={ this.updateHeight }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"block-library-image__dimensions__row\">\n\t\t\t\t\t\t\t\t<ButtonGroup aria-label={ __( 'Image Size' ) }>\n\t\t\t\t\t\t\t\t\t{ [ 25, 50, 75, 100 ].map( ( scale ) => {\n\t\t\t\t\t\t\t\t\t\tconst scaledWidth = Math.round( imageWidth * ( scale / 100 ) );\n\t\t\t\t\t\t\t\t\t\tconst scaledHeight = Math.round( imageHeight * ( scale / 100 ) );\n\n\t\t\t\t\t\t\t\t\t\tconst isCurrent = width === scaledWidth && height === scaledHeight;\n\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tkey={ scale }\n\t\t\t\t\t\t\t\t\t\t\t\tisSmall\n\t\t\t\t\t\t\t\t\t\t\t\tisPrimary={ isCurrent }\n\t\t\t\t\t\t\t\t\t\t\t\taria-pressed={ isCurrent }\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={ this.updateDimensions( scaledWidth, scaledHeight ) }\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{ scale }%\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t} ) }\n\t\t\t\t\t\t\t\t</ButtonGroup>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tisSmall\n\t\t\t\t\t\t\t\t\tonClick={ this.updateDimensions() }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ __( 'Reset' ) }\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) }\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody title={ __( 'Link Settings' ) }>\n\t\t\t\t\t<SelectControl\n\t\t\t\t\t\tlabel={ __( 'Link To' ) }\n\t\t\t\t\t\tvalue={ linkDestination }\n\t\t\t\t\t\toptions={ this.getLinkDestinationOptions() }\n\t\t\t\t\t\tonChange={ this.onSetLinkDestination }\n\t\t\t\t\t/>\n\t\t\t\t\t{ linkDestination !== LINK_DESTINATION_NONE && (\n\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\t\tlabel={ __( 'Link URL' ) }\n\t\t\t\t\t\t\t\tvalue={ href || '' }\n\t\t\t\t\t\t\t\tonChange={ this.onSetCustomHref }\n\t\t\t\t\t\t\t\tplaceholder={ ! isLinkURLInputReadOnly ? 'https://' : undefined }\n\t\t\t\t\t\t\t\treadOnly={ isLinkURLInputReadOnly }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\t\t\tlabel={ __( 'Open in New Tab' ) }\n\t\t\t\t\t\t\t\tonChange={ this.onSetNewTab }\n\t\t\t\t\t\t\t\tchecked={ linkTarget === '_blank' } />\n\t\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\t\tlabel={ __( 'Link CSS Class' ) }\n\t\t\t\t\t\t\t\tvalue={ linkClass || '' }\n\t\t\t\t\t\t\t\tonChange={ this.onSetLinkClass }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\t\tlabel={ __( 'Link Rel' ) }\n\t\t\t\t\t\t\t\tvalue={ rel || '' }\n\t\t\t\t\t\t\t\tonChange={ this.onSetLinkRel }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t) }\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t);\n\n\t\t// Disable reason: Each block can be selected by clicking on it\n\t\t/* eslint-disable jsx-a11y/no-static-element-interactions, jsx-a11y/onclick-has-role, jsx-a11y/click-events-have-key-events */\n\t\treturn (\n\t\t\t<Fragment>\n\t\t\t\t{ controls }\n\t\t\t\t<figure className={ classes }>\n\t\t\t\t\t<ImageSize src={ url } dirtynessTrigger={ align }>\n\t\t\t\t\t\t{ ( sizes ) => {\n\t\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\t\timageWidthWithinContainer,\n\t\t\t\t\t\t\t\timageHeightWithinContainer,\n\t\t\t\t\t\t\t\timageWidth,\n\t\t\t\t\t\t\t\timageHeight,\n\t\t\t\t\t\t\t} = sizes;\n\n\t\t\t\t\t\t\tconst filename = this.getFilename( url );\n\t\t\t\t\t\t\tlet defaultedAlt;\n\t\t\t\t\t\t\tif ( alt ) {\n\t\t\t\t\t\t\t\tdefaultedAlt = alt;\n\t\t\t\t\t\t\t} else if ( filename ) {\n\t\t\t\t\t\t\t\tdefaultedAlt = sprintf( __( 'This image has an empty alt attribute; its file name is %s' ), filename );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdefaultedAlt = __( 'This image has an empty alt attribute' );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst img = (\n\t\t\t\t\t\t\t\t// Disable reason: Image itself is not meant to be interactive, but\n\t\t\t\t\t\t\t\t// should direct focus to block.\n\t\t\t\t\t\t\t\t/* eslint-disable jsx-a11y/no-noninteractive-element-interactions */\n\t\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t\t<img src={ url } alt={ defaultedAlt } onClick={ this.onImageClick } onError={ () => this.onImageError( url ) } />\n\t\t\t\t\t\t\t\t\t{ isBlobURL( url ) && <Spinner /> }\n\t\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t\t\t/* eslint-enable jsx-a11y/no-noninteractive-element-interactions */\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif ( ! isResizable || ! imageWidthWithinContainer ) {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t\t\t{ getInspectorControls( imageWidth, imageHeight ) }\n\t\t\t\t\t\t\t\t\t\t<div style={ { width, height } }>\n\t\t\t\t\t\t\t\t\t\t\t{ img }\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst currentWidth = width || imageWidthWithinContainer;\n\t\t\t\t\t\t\tconst currentHeight = height || imageHeightWithinContainer;\n\n\t\t\t\t\t\t\tconst ratio = imageWidth / imageHeight;\n\t\t\t\t\t\t\tconst minWidth = imageWidth < imageHeight ? MIN_SIZE : MIN_SIZE * ratio;\n\t\t\t\t\t\t\tconst minHeight = imageHeight < imageWidth ? MIN_SIZE : MIN_SIZE / ratio;\n\n\t\t\t\t\t\t\t// With the current implementation of ResizableBox, an image needs an explicit pixel value for the max-width.\n\t\t\t\t\t\t\t// In absence of being able to set the content-width, this max-width is currently dictated by the vanilla editor style.\n\t\t\t\t\t\t\t// The following variable adds a buffer to this vanilla style, so 3rd party themes have some wiggleroom.\n\t\t\t\t\t\t\t// This does, in most cases, allow you to scale the image beyond the width of the main column, though not infinitely.\n\t\t\t\t\t\t\t// @todo It would be good to revisit this once a content-width variable becomes available.\n\t\t\t\t\t\t\tconst maxWidthBuffer = maxWidth * 2.5;\n\n\t\t\t\t\t\t\tlet showRightHandle = false;\n\t\t\t\t\t\t\tlet showLeftHandle = false;\n\n\t\t\t\t\t\t\t/* eslint-disable no-lonely-if */\n\t\t\t\t\t\t\t// See https://github.com/WordPress/gutenberg/issues/7584.\n\t\t\t\t\t\t\tif ( align === 'center' ) {\n\t\t\t\t\t\t\t\t// When the image is centered, show both handles.\n\t\t\t\t\t\t\t\tshowRightHandle = true;\n\t\t\t\t\t\t\t\tshowLeftHandle = true;\n\t\t\t\t\t\t\t} else if ( isRTL ) {\n\t\t\t\t\t\t\t\t// In RTL mode the image is on the right by default.\n\t\t\t\t\t\t\t\t// Show the right handle and hide the left handle only when it is aligned left.\n\t\t\t\t\t\t\t\t// Otherwise always show the left handle.\n\t\t\t\t\t\t\t\tif ( align === 'left' ) {\n\t\t\t\t\t\t\t\t\tshowRightHandle = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tshowLeftHandle = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Show the left handle and hide the right handle only when the image is aligned right.\n\t\t\t\t\t\t\t\t// Otherwise always show the right handle.\n\t\t\t\t\t\t\t\tif ( align === 'right' ) {\n\t\t\t\t\t\t\t\t\tshowLeftHandle = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tshowRightHandle = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/* eslint-enable no-lonely-if */\n\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<Fragment>\n\t\t\t\t\t\t\t\t\t{ getInspectorControls( imageWidth, imageHeight ) }\n\t\t\t\t\t\t\t\t\t<ResizableBox\n\t\t\t\t\t\t\t\t\t\tsize={\n\t\t\t\t\t\t\t\t\t\t\twidth && height ? {\n\t\t\t\t\t\t\t\t\t\t\t\twidth,\n\t\t\t\t\t\t\t\t\t\t\t\theight,\n\t\t\t\t\t\t\t\t\t\t\t} : undefined\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tminWidth={ minWidth }\n\t\t\t\t\t\t\t\t\t\tmaxWidth={ maxWidthBuffer }\n\t\t\t\t\t\t\t\t\t\tminHeight={ minHeight }\n\t\t\t\t\t\t\t\t\t\tmaxHeight={ maxWidthBuffer / ratio }\n\t\t\t\t\t\t\t\t\t\tlockAspectRatio\n\t\t\t\t\t\t\t\t\t\tenable={ {\n\t\t\t\t\t\t\t\t\t\t\ttop: false,\n\t\t\t\t\t\t\t\t\t\t\tright: showRightHandle,\n\t\t\t\t\t\t\t\t\t\t\tbottom: true,\n\t\t\t\t\t\t\t\t\t\t\tleft: showLeftHandle,\n\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\tonResizeStart={ () => {\n\t\t\t\t\t\t\t\t\t\t\ttoggleSelection( false );\n\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\tonResizeStop={ ( event, direction, elt, delta ) => {\n\t\t\t\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\t\t\t\twidth: parseInt( currentWidth + delta.width, 10 ),\n\t\t\t\t\t\t\t\t\t\t\t\theight: parseInt( currentHeight + delta.height, 10 ),\n\t\t\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t\t\t\ttoggleSelection( true );\n\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ img }\n\t\t\t\t\t\t\t\t\t</ResizableBox>\n\t\t\t\t\t\t\t\t</Fragment>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} }\n\t\t\t\t\t</ImageSize>\n\t\t\t\t\t{ ( ! RichText.isEmpty( caption ) || isSelected ) && (\n\t\t\t\t\t\t<RichText\n\t\t\t\t\t\t\ttagName=\"figcaption\"\n\t\t\t\t\t\t\tplaceholder={ __( 'Write caption…' ) }\n\t\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\t\tunstableOnFocus={ this.onFocusCaption }\n\t\t\t\t\t\t\tonChange={ ( value ) => setAttributes( { caption: value } ) }\n\t\t\t\t\t\t\tisSelected={ this.state.captionFocused }\n\t\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</figure>\n\t\t\t</Fragment>\n\t\t);\n\t\t/* eslint-enable jsx-a11y/no-static-element-interactions, jsx-a11y/onclick-has-role, jsx-a11y/click-events-have-key-events */\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, props ) => {\n\t\tconst { getMedia } = select( 'core' );\n\t\tconst { getSettings } = select( 'core/block-editor' );\n\t\tconst { id } = props.attributes;\n\t\tconst { maxWidth, isRTL, imageSizes } = getSettings();\n\n\t\treturn {\n\t\t\timage: id ? getMedia( id ) : null,\n\t\t\tmaxWidth,\n\t\t\tisRTL,\n\t\t\timageSizes,\n\t\t};\n\t} ),\n\twithViewportMatch( { isLargeViewport: 'medium' } ),\n\twithNotices,\n] )( ImageEdit );\n"]}