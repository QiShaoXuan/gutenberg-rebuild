{"version":3,"sources":["@wordpress/api-fetch/src/index.js"],"names":["DEFAULT_HEADERS","Accept","DEFAULT_OPTIONS","credentials","middlewares","userLocaleMiddleware","namespaceEndpointMiddleware","httpV1Middleware","fetchAllMiddleware","registerMiddleware","middleware","unshift","defaultFetchHandler","nextOptions","url","path","data","parse","remainingOptions","body","headers","JSON","stringify","responsePromise","window","fetch","checkStatus","response","status","parseResponse","json","Promise","reject","then","catch","invalidJsonError","code","message","error","unknownError","fetchHandler","setFetchHandler","newFetchHandler","apiFetch","options","steps","createRunStep","index","workingOptions","step","length","next","use","createNonceMiddleware","createPreloadingMiddleware","createRootURLMiddleware"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport createNonceMiddleware from './middlewares/nonce';\nimport createRootURLMiddleware from './middlewares/root-url';\nimport createPreloadingMiddleware from './middlewares/preloading';\nimport fetchAllMiddleware from './middlewares/fetch-all-middleware';\nimport namespaceEndpointMiddleware from './middlewares/namespace-endpoint';\nimport httpV1Middleware from './middlewares/http-v1';\nimport userLocaleMiddleware from './middlewares/user-locale';\n\n/**\n * Default set of header values which should be sent with every request unless\n * explicitly provided through apiFetch options.\n *\n * @type {Object}\n */\nconst DEFAULT_HEADERS = {\n\t// The backend uses the Accept header as a condition for considering an\n\t// incoming request as a REST request.\n\t//\n\t// See: https://core.trac.wordpress.org/ticket/44534\n\tAccept: 'application/json, */*;q=0.1',\n};\n\n/**\n * Default set of fetch option values which should be sent with every request\n * unless explicitly provided through apiFetch options.\n *\n * @type {Object}\n */\nconst DEFAULT_OPTIONS = {\n\tcredentials: 'include',\n};\n\nconst middlewares = [\n\tuserLocaleMiddleware,\n\tnamespaceEndpointMiddleware,\n\thttpV1Middleware,\n\tfetchAllMiddleware,\n];\n\nfunction registerMiddleware( middleware ) {\n\tmiddlewares.unshift( middleware );\n}\n\nconst defaultFetchHandler = ( nextOptions ) => {\n\tconst { url, path, data, parse = true, ...remainingOptions } = nextOptions;\n\tlet { body, headers } = nextOptions;\n\n\t// Merge explicitly-provided headers with default values.\n\theaders = { ...DEFAULT_HEADERS, ...headers };\n\n\t// The `data` property is a shorthand for sending a JSON body.\n\tif ( data ) {\n\t\tbody = JSON.stringify( data );\n\t\theaders[ 'Content-Type' ] = 'application/json';\n\t}\n\n\tconst responsePromise = window.fetch(\n\t\turl || path,\n\t\t{\n\t\t\t...DEFAULT_OPTIONS,\n\t\t\t...remainingOptions,\n\t\t\tbody,\n\t\t\theaders,\n\t\t}\n\t);\n\tconst checkStatus = ( response ) => {\n\t\tif ( response.status >= 200 && response.status < 300 ) {\n\t\t\treturn response;\n\t\t}\n\n\t\tthrow response;\n\t};\n\n\tconst parseResponse = ( response ) => {\n\t\tif ( parse ) {\n\t\t\tif ( response.status === 204 ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn response.json ? response.json() : Promise.reject( response );\n\t\t}\n\n\t\treturn response;\n\t};\n\n\treturn responsePromise\n\t\t.then( checkStatus )\n\t\t.then( parseResponse )\n\t\t.catch( ( response ) => {\n\t\t\tif ( ! parse ) {\n\t\t\t\tthrow response;\n\t\t\t}\n\n\t\t\tconst invalidJsonError = {\n\t\t\t\tcode: 'invalid_json',\n\t\t\t\tmessage: __( 'The response is not a valid JSON response.' ),\n\t\t\t};\n\n\t\t\tif ( ! response || ! response.json ) {\n\t\t\t\tthrow invalidJsonError;\n\t\t\t}\n\n\t\t\treturn response.json()\n\t\t\t\t.catch( () => {\n\t\t\t\t\tthrow invalidJsonError;\n\t\t\t\t} )\n\t\t\t\t.then( ( error ) => {\n\t\t\t\t\tconst unknownError = {\n\t\t\t\t\t\tcode: 'unknown_error',\n\t\t\t\t\t\tmessage: __( 'An unknown error occurred.' ),\n\t\t\t\t\t};\n\n\t\t\t\t\tthrow error || unknownError;\n\t\t\t\t} );\n\t\t} );\n};\n\nlet fetchHandler = defaultFetchHandler;\n\n/**\n * Defines a custom fetch handler for making the requests that will override\n * the default one using window.fetch\n *\n * @param {Function} newFetchHandler The new fetch handler\n */\nfunction setFetchHandler( newFetchHandler ) {\n\tfetchHandler = newFetchHandler;\n}\n\nfunction apiFetch( options ) {\n\tconst steps = [ ...middlewares, fetchHandler ];\n\n\tconst createRunStep = ( index ) => ( workingOptions ) => {\n\t\tconst step = steps[ index ];\n\t\tif ( index === steps.length - 1 ) {\n\t\t\treturn step( workingOptions );\n\t\t}\n\n\t\tconst next = createRunStep( index + 1 );\n\t\treturn step( workingOptions, next );\n\t};\n\n\treturn createRunStep( 0 )( options );\n}\n\napiFetch.use = registerMiddleware;\napiFetch.setFetchHandler = setFetchHandler;\n\napiFetch.createNonceMiddleware = createNonceMiddleware;\napiFetch.createPreloadingMiddleware = createPreloadingMiddleware;\napiFetch.createRootURLMiddleware = createRootURLMiddleware;\napiFetch.fetchAllMiddleware = fetchAllMiddleware;\n\nexport default apiFetch;\n"]}