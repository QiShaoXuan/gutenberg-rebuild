{"version":3,"sources":["@wordpress/components/src/higher-order/with-focus-return/index.js"],"names":["stubTrue","without","Component","createHigherOrderComponent","Provider","Consumer","isComponentLike","object","withFocusReturn","options","WrappedComponent","onFocusReturn","FocusReturn","arguments","ownFocusedElements","Set","activeElementOnMount","document","activeElement","setIsFocusedFalse","isFocused","setIsFocusedTrue","event","add","target","stack","props","focusHistory","candidate","pop","body","contains","focus","context"],"mappings":";;;;;;;;;AAAA;;;AAGA,SAASA,QAAT,EAAmBC,OAAnB,QAAkC,QAAlC;AAEA;;;;AAGA,SAASC,SAAT,QAA0B,oBAA1B;AACA,SAASC,0BAAT,QAA2C,oBAA3C;AAEA;;;;AAGA,OAAOC,QAAP,IAAmBC,QAAnB,QAAmC,WAAnC;AAEA;;;;;;;;;AAQA,SAASC,eAAT,CAA0BC,MAA1B,EAAmC;AAClC,SACCA,MAAM,YAAYL,SAAlB,IACA,OAAOK,MAAP,KAAkB,UAFnB;AAIA;AAED;;;;;;;;;;;;;;;AAaA,SAASC,eAAT,CAA0BC,OAA1B,EAAoC;AACnC;AACA;AACA,MAAKH,eAAe,CAAEG,OAAF,CAApB,EAAkC;AACjC,QAAMC,gBAAgB,GAAGD,OAAzB;AACA,WAAOD,eAAe,CAAE,EAAF,CAAf,CAAuBE,gBAAvB,CAAP;AACA;;AANkC,8BAQED,OARF,CAQ3BE,aAR2B;AAAA,MAQ3BA,aAR2B,sCAQXX,QARW;AAUnC,SAAO,UAAUU,gBAAV,EAA6B;AAAA,QAC7BE,WAD6B;AAAA;AAAA;AAAA;;AAElC,6BAAc;AAAA;;AAAA;;AACb,0FAAUC,SAAV;AAEA,cAAKC,kBAAL,GAA0B,IAAIC,GAAJ,EAA1B;AACA,cAAKC,oBAAL,GAA4BC,QAAQ,CAACC,aAArC;;AACA,cAAKC,iBAAL,GAAyB;AAAA,iBAAM,MAAKC,SAAL,GAAiB,KAAvB;AAAA,SAAzB;;AACA,cAAKC,gBAAL,GAAwB,UAAEC,KAAF,EAAa;AACpC,gBAAKR,kBAAL,CAAwBS,GAAxB,CAA6BD,KAAK,CAACE,MAAnC;;AACA,gBAAKJ,SAAL,GAAiB,IAAjB;AACA,SAHD;;AANa;AAUb;;AAZiC;AAAA;AAAA,+CAcX;AAAA,cAErBJ,oBAFqB,GAKlB,IALkB,CAErBA,oBAFqB;AAAA,cAGrBI,SAHqB,GAKlB,IALkB,CAGrBA,SAHqB;AAAA,cAIrBN,kBAJqB,GAKlB,IALkB,CAIrBA,kBAJqB;;AAOtB,cAAK,CAAEM,SAAP,EAAmB;AAClB;AACA,WATqB,CAWtB;AACA;AACA;AACA;AACA;;;AACA,cAAKT,aAAa,OAAO,KAAzB,EAAiC;AAChC;AACA;;AAED,cAAMc,KAAK,gCACPxB,OAAO,MAAP,UACF,KAAKyB,KAAL,CAAWC,YADT,4BAECb,kBAFD,GADO,IAKVE,oBALU,EAAX;AAQA,cAAIY,SAAJ;;AACA,iBAAUA,SAAS,GAAGH,KAAK,CAACI,GAAN,EAAtB,EAAsC;AACrC,gBAAKZ,QAAQ,CAACa,IAAT,CAAcC,QAAd,CAAwBH,SAAxB,CAAL,EAA2C;AAC1CA,cAAAA,SAAS,CAACI,KAAV;AACA;AACA;AACD;AACD;AAjDiC;AAAA;AAAA,iCAmDzB;AACR,iBACC;AACC,YAAA,OAAO,EAAG,KAAKX,gBADhB;AAEC,YAAA,MAAM,EAAG,KAAKF;AAFf,aAIC,cAAC,gBAAD,EAAuB,KAAKO,KAA5B,CAJD,CADD;AAQA;AA5DiC;;AAAA;AAAA,MACTxB,SADS;;AA+DnC,WAAO,UAAEwB,KAAF;AAAA,aACN,cAAC,QAAD,QACG,UAAEO,OAAF;AAAA,eAAe,cAAC,WAAD,eAAkBP,KAAlB,EAA+BO,OAA/B,EAAf;AAAA,OADH,CADM;AAAA,KAAP;AAKA,GApED;AAqEA;;AAED,eAAe9B,0BAA0B,CAAEK,eAAF,EAAmB,iBAAnB,CAAzC;AACA,SAASJ,QAAT","sourcesContent":["/**\n * External dependencies\n */\nimport { stubTrue, without } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { createHigherOrderComponent } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport Provider, { Consumer } from './context';\n\n/**\n * Returns true if the given object is component-like. An object is component-\n * like if it is an instance of wp.element.Component, or is a function.\n *\n * @param {*} object Object to test.\n *\n * @return {boolean} Whether object is component-like.\n */\nfunction isComponentLike( object ) {\n\treturn (\n\t\tobject instanceof Component ||\n\t\ttypeof object === 'function'\n\t);\n}\n\n/**\n * Higher Order Component used to be used to wrap disposable elements like\n * sidebars, modals, dropdowns. When mounting the wrapped component, we track a\n * reference to the current active element so we know where to restore focus\n * when the component is unmounted.\n *\n * @param {(WPComponent|Object)} options The component to be enhanced with\n *                                       focus return behavior, or an object\n *                                       describing the component and the\n *                                       focus return characteristics.\n *\n * @return {Component} Component with the focus restauration behaviour.\n */\nfunction withFocusReturn( options ) {\n\t// Normalize as overloaded form `withFocusReturn( options )( Component )`\n\t// or as `withFocusReturn( Component )`.\n\tif ( isComponentLike( options ) ) {\n\t\tconst WrappedComponent = options;\n\t\treturn withFocusReturn( {} )( WrappedComponent );\n\t}\n\n\tconst { onFocusReturn = stubTrue } = options;\n\n\treturn function( WrappedComponent ) {\n\t\tclass FocusReturn extends Component {\n\t\t\tconstructor() {\n\t\t\t\tsuper( ...arguments );\n\n\t\t\t\tthis.ownFocusedElements = new Set;\n\t\t\t\tthis.activeElementOnMount = document.activeElement;\n\t\t\t\tthis.setIsFocusedFalse = () => this.isFocused = false;\n\t\t\t\tthis.setIsFocusedTrue = ( event ) => {\n\t\t\t\t\tthis.ownFocusedElements.add( event.target );\n\t\t\t\t\tthis.isFocused = true;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tcomponentWillUnmount() {\n\t\t\t\tconst {\n\t\t\t\t\tactiveElementOnMount,\n\t\t\t\t\tisFocused,\n\t\t\t\t\townFocusedElements,\n\t\t\t\t} = this;\n\n\t\t\t\tif ( ! isFocused ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Defer to the component's own explicit focus return behavior,\n\t\t\t\t// if specified. The function should return `false` to prevent\n\t\t\t\t// the default behavior otherwise occurring here. This allows\n\t\t\t\t// for support that the `onFocusReturn` decides to allow the\n\t\t\t\t// default behavior to occur under some conditions.\n\t\t\t\tif ( onFocusReturn() === false ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst stack = [\n\t\t\t\t\t...without(\n\t\t\t\t\t\tthis.props.focusHistory,\n\t\t\t\t\t\t...ownFocusedElements\n\t\t\t\t\t),\n\t\t\t\t\tactiveElementOnMount,\n\t\t\t\t];\n\n\t\t\t\tlet candidate;\n\t\t\t\twhile ( ( candidate = stack.pop() ) ) {\n\t\t\t\t\tif ( document.body.contains( candidate ) ) {\n\t\t\t\t\t\tcandidate.focus();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trender() {\n\t\t\t\treturn (\n\t\t\t\t\t<div\n\t\t\t\t\t\tonFocus={ this.setIsFocusedTrue }\n\t\t\t\t\t\tonBlur={ this.setIsFocusedFalse }\n\t\t\t\t\t>\n\t\t\t\t\t\t<WrappedComponent { ...this.props } />\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn ( props ) => (\n\t\t\t<Consumer>\n\t\t\t\t{ ( context ) => <FocusReturn { ...props } { ...context } /> }\n\t\t\t</Consumer>\n\t\t);\n\t};\n}\n\nexport default createHigherOrderComponent( withFocusReturn, 'withFocusReturn' );\nexport { Provider };\n"]}