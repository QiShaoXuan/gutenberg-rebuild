{"version":3,"sources":["@wordpress/components/src/positioned-at-selection/index.js"],"names":["getCurrentCaretPositionStyle","selection","window","getSelection","rangeCount","rect","getRangeAt","top","height","left","width","offsetParent","anchorNode","parentRect","getBoundingClientRect","PositionedAtSelection","arguments","state","style","children","props","Component"],"mappings":";;;;;;;;;AAGA;;;;;;;;;;;;AACA;;AAJA;;;;AAMA;;;;;;;AAOA,SAASA,4BAAT,GAAwC;AACvC,MAAMC,SAAS,GAAGC,MAAM,CAACC,YAAP,EAAlB,CADuC,CAGvC;AACA;;AACA,MAAKF,SAAS,CAACG,UAAV,KAAyB,CAA9B,EAAkC;AACjC,WAAO,EAAP;AACA,GAPsC,CASvC;;;AACA,MAAMC,IAAI,GAAG,gCAAuBJ,SAAS,CAACK,UAAV,CAAsB,CAAtB,CAAvB,CAAb;AACA,MAAIC,GAAG,GAAGF,IAAI,CAACE,GAAL,GAAWF,IAAI,CAACG,MAA1B;AACA,MAAIC,IAAI,GAAGJ,IAAI,CAACI,IAAL,GAAcJ,IAAI,CAACK,KAAL,GAAa,CAAtC,CAZuC,CAcvC;;AACA,MAAMC,YAAY,GAAG,0BAAiBV,SAAS,CAACW,UAA3B,CAArB;;AACA,MAAKD,YAAL,EAAoB;AACnB,QAAME,UAAU,GAAGF,YAAY,CAACG,qBAAb,EAAnB;AACAP,IAAAA,GAAG,IAAIM,UAAU,CAACN,GAAlB;AACAE,IAAAA,IAAI,IAAII,UAAU,CAACJ,IAAnB;AACA;;AAED,SAAO;AAAEF,IAAAA,GAAG,EAAHA,GAAF;AAAOE,IAAAA,IAAI,EAAJA;AAAP,GAAP;AACA;AAED;;;;;;;;;IAOqBM,qB;;;;;AACpB,mCAAc;AAAA;;AAAA;AACb,4HAAUC,SAAV;AAEA,UAAKC,KAAL,GAAa;AACZC,MAAAA,KAAK,EAAElB,4BAA4B;AADvB,KAAb;AAHa;AAMb;;;;6BAEQ;AAAA,UACAmB,QADA,GACa,KAAKC,KADlB,CACAD,QADA;AAAA,UAEAD,KAFA,GAEU,KAAKD,KAFf,CAEAC,KAFA;AAIR,aACC;AAAK,QAAA,SAAS,EAAC,2FAAf;AAA2G,QAAA,KAAK,EAAGA;AAAnH,SACGC,QADH,CADD;AAKA;;;EAlBiDE,kB","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { getOffsetParent, getRectangleFromRange } from '@wordpress/dom';\n\n/**\n * Returns a style object for applying as `position: absolute` for an element\n * relative to the bottom-center of the current selection. Includes `top` and\n * `left` style properties.\n *\n * @return {Object} Style object.\n */\nfunction getCurrentCaretPositionStyle() {\n\tconst selection = window.getSelection();\n\n\t// Unlikely, but in the case there is no selection, return empty styles so\n\t// as to avoid a thrown error by `Selection#getRangeAt` on invalid index.\n\tif ( selection.rangeCount === 0 ) {\n\t\treturn {};\n\t}\n\n\t// Get position relative viewport.\n\tconst rect = getRectangleFromRange( selection.getRangeAt( 0 ) );\n\tlet top = rect.top + rect.height;\n\tlet left = rect.left + ( rect.width / 2 );\n\n\t// Offset by positioned parent, if one exists.\n\tconst offsetParent = getOffsetParent( selection.anchorNode );\n\tif ( offsetParent ) {\n\t\tconst parentRect = offsetParent.getBoundingClientRect();\n\t\ttop -= parentRect.top;\n\t\tleft -= parentRect.left;\n\t}\n\n\treturn { top, left };\n}\n\n/**\n * Component which renders itself positioned under the current caret selection.\n * The position is calculated at the time of the component being mounted, so it\n * should only be mounted after the desired selection has been made.\n *\n * @type {WPComponent}\n */\nexport default class PositionedAtSelection extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.state = {\n\t\t\tstyle: getCurrentCaretPositionStyle(),\n\t\t};\n\t}\n\n\trender() {\n\t\tconst { children } = this.props;\n\t\tconst { style } = this.state;\n\n\t\treturn (\n\t\t\t<div className=\"editor-format-toolbar__selection-position block-editor-format-toolbar__selection-position\" style={ style }>\n\t\t\t\t{ children }\n\t\t\t</div>\n\t\t);\n\t}\n}\n"]}